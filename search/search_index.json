{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Open Management","text":""},{"location":"#welcome","title":"Welcome","text":"<p>This site is a collection of notes, examples, and documentation regarding the use of various network management protocols with Arista EOS devices. This is not a replacement for the official Arista EOS documentation but should be considered something of a cookbook for getting started with the management technologies available in EOS.</p> <p>The source for this site is on github. If you see something amiss or you're interested in a particular topic that isn't being covered, please feel free to open an issue or submit a pull request.</p> <p>N.B.: This is a continuous work in progress.</p>"},{"location":"#arista-resources","title":"Arista Resources","text":"<ul> <li>Arista Product Documentation - EOS and Hardware   documentation (Arista login required)</li> <li>Arista Software Downloads - EOS downloads (Arista login required)</li> <li>Arista TOIs - Transfer of Information documents. Release specific new feature documentation. (Arista login required)</li> </ul>"},{"location":"configuration/mtls/","title":"EOS mTLS Configuration","text":""},{"location":"configuration/mtls/#overview","title":"Overview","text":"<p>EOS supports the use of mutual TLS (mTLS) for gRPC, RESTCONF and eAPI services. This allows the use of certificates, signed by a recognized and trusted CA, for authentication to gNMI and other gRPC based services.</p> <p>By default only certificates signed with Arista's CA are trusted. In order to generate and sign certificates for mTLS authentication, an operator will need to install and configure a certifying authority (CA) that is used for signing certificates that are generated on network elements as well as the servers that will be interacting with the gRPC services. The necessary certificates for establishing the chain of trust will need to be imported into the switches and tools interacting with the switches.</p> <p>This document outlines the necessary steps to generate certificate signing requests (CSR) on arista devices, sign the certificates and import these into the switches.</p>"},{"location":"configuration/mtls/#process-overview","title":"Process Overview","text":"<ul> <li>Setup a private certificate authority (CA). This document uses easy-rsa</li> <li>Generate CSRs from the switch as well as for the host that will be initiating connections to the switch using mTLS as   the authentication mechanism.</li> <li>Sign the CSRs using the CA tools.</li> <li>Copy the relevant elements to the switch (signed server certificate and CA certificate).</li> <li>Configure the switch to use the certificates and the associated CA certificate to perform mTLS authentication.</li> <li>Initiate connections from the clients to the switch to execute gNMI RPCs.</li> </ul>"},{"location":"configuration/mtls/#easy-rsa-setup","title":"Easy-RSA Setup","text":"<p>The simple installation of Easy-RSA is well documented in the Easy RSA quick start guide. For a more durable installation you're encouraged to review the Easy-RSA documentation and customize the settings to your environment.</p>"},{"location":"configuration/mtls/#easy-rsa-ca-parameters","title":"Easy-RSA CA parameters","text":"<p>easy RSA version: 3.0.8</p> <p>As of this writing EOS only supports RSA certificates, this differs from the default configuration of Easy-RSA. The following variable in the <code>vars</code> file will need to be set in order to generate the appropriate certificate type.</p> <pre><code>set_var EASYRSA_ALGO \"rsa\"\n</code></pre> <p>Use the <code>easyrsa build-ca</code> command to create the necessary certificate signing infrastructure within easyrsa. This will generate a <code>ca.crt</code> certificate which can be imported into the PKI validation chain of the switches and other hosts in your PKI domain. This can also be used in a standalone manner with most gnmi clients.</p> <p>In our case, this CA certificate resides in: <code>${HOME}/easy-rsa/pki/ca.crt</code></p> <p>This will need to be imported into the network elements where you're using mTLS for authentication.</p>"},{"location":"configuration/mtls/#generate-a-local-client-certificate","title":"Generate a Local Client Certificate","text":"<p>This will be used by local clients (gnmi, gnoi, gribi, etc.) connecting to the switches in order to authenticate.</p> <p>Note the <code>gnmi-client.cnf</code> configuration file provided in the following <code>openssl</code> command is used to create the Subject Alternate Name IP address entry associated with the client certificate. This is optional and is not required for certificates.</p> <pre><code>mkdir ~/gnmi-client-cert\ncd ~/gnmi-client-cert\nopenssl req -out gnmi-client.csr -newkey rsa:2048 -nodes -keyout gnmi-client.key -config gnmi-client.cnf\n</code></pre> <p>The above commands will generate a private key as well as the Certificate Signing Request (CSR)</p>"},{"location":"configuration/mtls/#sign-the-local-client-certificate-with-easy-rsa","title":"Sign the Local Client Certificate with Easy-RSA","text":"<p>Note, that this is going to be a client certificate. As our gnmi client will be talking to the gnmi server on the switch.</p> <pre><code>cd ~/easy-rsa\n./easyrsa import-req ../gnmi-client-cert gnmi-client.csr gnmi-client\n./easyrsa sign-req client gnmi-client\n</code></pre> <p>The <code>sign-req</code> command generates the following output.</p> <pre><code>Using SSL: openssl OpenSSL 1.1.1f  31 Mar 2020\n\n... snipped ...\n\nsubject=\n    countryName               = us\n    stateOrProvinceName       = mn\n    localityName              = minneapolis\n    organizationName          = arista-lab\n    commonName                = sulrich@arista.com\n\nX509v3 Subject Alternative Name:\n    IP:192.168.1.11\n\nType the word 'yes' to continue, or any other input to abort.\n  Confirm request details: yes\nUsing configuration from /home/sulrich/easy-rsa/pki/easy-rsa-3625384.5yQThV/tmp.kaJhk0\nCheck that the request matches the signature\nSignature ok\nThe Subject's Distinguished Name is as follows\ncountryName           :PRINTABLE:'us'\nstateOrProvinceName   :ASN.1 12:'mn'\nlocalityName          :ASN.1 12:'minneapolis'\norganizationName      :ASN.1 12:'arista-lab'\ncommonName            :ASN.1 12:'sulrich@arista.com'\nCertificate is to be certified until Oct 10 19:45:42 2023 GMT (825 days)\n\nWrite out database with 1 new entries\nData Base Updated\n\nCertificate created at: /home/sulrich/easy-rsa/pki/issued/gnmi-client.crt\n</code></pre>"},{"location":"configuration/mtls/#switch-side-actions","title":"Switch Side Actions","text":"<ul> <li>Generate a key pair on the switch the key will be named <code>v1.key</code></li> </ul> <pre><code>security pki key generate rsa 4096 v1.key\n</code></pre> <ul> <li>Generate the CSR</li> </ul> <pre><code>security pki certificate generate signing-request key v1.key\n</code></pre> <ul> <li>Capture the CSR text into a file and copy this to the CA server.</li> </ul>"},{"location":"configuration/mtls/#sign-the-switch-csr-with-easy-rsa","title":"Sign the Switch CSR with Easy-RSA","text":"<p>Note that in this case we're generating a server certificate.</p> <pre><code>cd ~/easy-rsa\n./easyrsa import-req ../v1.csr v1\n./easyrsa sign-req server v1\n</code></pre> <p>This will generate the signed certificate and place it into the easy-rsa local store.</p> <p><code>${HOME}/easy-rsa/pki/issued/v1.crt</code></p> <ul> <li>Copy this to the switch and import it into the switch's certificate store.</li> </ul> <p><code>copy file:/mnt/flash/v1.crt certificate:v1.crt</code></p>"},{"location":"configuration/mtls/#copy-the-private-ca-certificate-to-the-switch","title":"Copy the Private CA Certificate to the Switch","text":"<p>You will need to copy the <code>CA.crt</code> (commonly in <code>&lt;easyrsa_root&gt;/pki/ca.crt</code>) to the switch and add it to the list of certificates. In the following example the file has been copied to the switch as <code>demo-ca.crt</code>.</p> <pre><code>copy flash:demo-ca.crt certificate:\n</code></pre>"},{"location":"configuration/mtls/#ssl-profile-configuration","title":"SSL Profile Configuration","text":"<p>Configure the necessary <code>ssl profile</code> and include the <code>demo-ca.crt</code> in the list of trusted CAs.</p> <pre><code>management security\n   ssl profile test-arista\n      certificate v1.crt key v1.key\n      trust certificate demo-ca.crt\n!\n</code></pre>"},{"location":"configuration/mtls/#gnmi-configuration","title":"gNMI Configuration","text":"<p>The following configuration associates the gnmi service with the associated ssl profile and enables it for use with mTLS for authentication.</p> <pre><code>management api gnmi\n   transport grpc default\n      ssl profile test-arista\n   provider eos-native\n!\n</code></pre> <p>At this point the switch is configured to accept connections from clients with valid, signed certificates.</p>"},{"location":"configuration/mtls/#useful-troubleshooting-commands","title":"Useful Troubleshooting Commands","text":"<p><code>show management api gnmi</code></p> <p>This command enables you to determine the operational state of the gnmi process as well as whether or not the ssl profile is considered valid.</p> <p><code>show management security ssl profile</code></p> <p>This command enables you to see the state of the ssl profiles and whether there are issues with the validation chain.</p>"},{"location":"configuration/mtls/#clocks-and-certificate-lifetime","title":"Clocks and Certificate Lifetime","text":"<p>Certificates should be created with a finite lifetime and rotated within that lifetime. However, if the clocks on the switch are grossly off this may impact certificate operation. Make sure that the clock on the switch is set correctly and synchronized to a reliable time source.</p>"},{"location":"configuration/mtls/#client-examples","title":"Client Examples","text":""},{"location":"configuration/mtls/#gnmi-arista-client","title":"gnmi (Arista Client)","text":"<pre><code>gnmi -addr 192.168.1.21:6030                    \\\n-username admin -password arista              \\\n-cafile easy-rsa/pki/ca.crt                   \\\n-certfile easy-rsa/pki/issued/gnmi-client.crt \\\n-keyfile gnmi-client/gnmi-client.key capabilities\n</code></pre>"},{"location":"configuration/mtls/#gnmic","title":"gnmic","text":"<pre><code>gnmic -a 192.168.1.21:6030 -u admin -p arista    \\\n--tls-ca easy-rsa/pki/ca.crt                   \\\n--tls-cert easy-rsa/pki/issued/gnmi-client.crt \\\n--tls-key gnmi-client/gnmi-client.key capabilities\n</code></pre>"},{"location":"configuration/mtls/#additional-references","title":"Additional References","text":"<ul> <li>Aritsa Community Central: Working with Certificates</li> </ul>"},{"location":"configuration/netconf/","title":"NETCONF Device Configuration","text":""},{"location":"configuration/netconf/#overview","title":"Overview","text":"<p>EOS provides support for managing the switch via NETCONF.</p>"},{"location":"configuration/netconf/#netconf","title":"NETCONF","text":"<p>Currently supported NETCONF operations: get, get-config, get-schema, edit-config, lock, unlock, close-session, kill-session.</p> <p>To configure NETCONF in default VRF we can enable the ssh transport under <code>management api netconf</code>:</p> <p>Default VRF</p> <pre><code>management api netconf\n   transport ssh test\n</code></pre> <p>Non-default VRF</p> <pre><code>management api netconf\n   transport ssh test\n      vrf management\n</code></pre> <p>Changing the port:</p> <pre><code>management api netconf\n   transport ssh test\n      port 830\n</code></pre> <p>Apply ACL</p> <pre><code>management api netconf\n   transport ssh test\n      ip access-group ACCESS_GROUP\n</code></pre> <p>Note The ACL should be a standard ACL allowing hosts or subnets.</p> <p>Status check:</p> <pre><code>#show management api netconf\n\nEnabled:            Yes\nServer:             running on port 830, in management VRF\n</code></pre>"},{"location":"configuration/openconfig/","title":"OpenConfig Configuration","text":""},{"location":"configuration/openconfig/#overview","title":"Overview","text":"<p>EOS supports the OpenConfig gNMI interface for device management.</p>"},{"location":"configuration/openconfig/#platform-compatibility","title":"Platform compatibility","text":"<p>All EOS flavors support OpenConfig (physical, virtual, containerized, cloud).</p>"},{"location":"configuration/openconfig/#gnmi","title":"gNMI","text":"<p>To start the gNMI server, which listens by default on TCP/6030 configure the gRPC transport under <code>management api gnmi</code> in the global config mode:</p> <p>Default VRF</p> <pre><code>management api gnmi\n  transport grpc openmgmt\n</code></pre> <p>Non-default VRF</p> <pre><code>management api gnmi\n   transport grpc openmgmt\n     vrf management\n</code></pre> <p>Changing the port:</p> <pre><code>management api gnmi\n   transport grpc openmgmt\n      port 5900\n</code></pre> <p>Apply ACL</p> <pre><code>management api gnmi\n   transport grpc openmgmt\n      ip access-group ACCESS_GROUP\n</code></pre> <p>Note, the ACL should be a standard ACL allowing hosts or subnets.</p> <p>Authenticate the connection with TLS</p> <pre><code>management api gnmi\n   transport grpc openmgmt\n      ssl profile PROFILE\n</code></pre> <p>Enable authorization of incoming requests</p> <pre><code>management api gnmi\n   transport grpc openmgmt\n      authorization requests\n</code></pre> <p>Status check</p> <pre><code>#show management api gnmi\nOcta:               No\nEnabled:            Yes\nServer:             running on port 6030, in default VRF\nSSL Profile:        none\nQoS DSCP:           none\n</code></pre>"},{"location":"configuration/openconfig/#octa","title":"OCTA","text":"<p>The OpenConfig agent (gNMI API) can leverage the EOS state streaming agent's (TerminAttr) libraries, thus exposing EOS native paths. If Octa (OpenConfig + TerminAttr) is enabled then OpenConfig, in addition to accepting OpenConfig paths in gNMI get/subscribe requests, will also support EOS native paths (for example, Sysdb/Smash paths). This feature was introduced in <code>4.22.1F</code>.</p> <p>gNMI requests received by Octa are interpreted as either OpenConfig or TerminAttr requests, as follows.</p> <ul> <li>gNMI requests containing an origin of <code>eos_native</code> are processed as as native path requests.</li> <li>Requests lacking an origin of <code>eos_native</code> are treated as OpenConfig requests.</li> </ul> <p>A gNMI client that supports specification of an origin as part of the associated RPC is a requirement.</p> <p>Note support for sending GET/SUBSCRIBE requests to both an openconfig and an eos-native path in the same call is not yet supported.</p>"},{"location":"configuration/openconfig/#how-to-enable-octa","title":"How to enable Octa","text":"<p>Octa can be enable by adding <code>provider eos-native</code> under <code>management api gnmi</code></p> <p><code>SW(config-mgmt-api-gnmi)#provider eos-native</code></p> <p>Status check</p> <pre><code>#show management api gnmi\nOcta:               enabled\nEnabled:            Yes\nServer:             running on port 6030, in default VRF\nSSL Profile:        none\nQoS DSCP:           none\n</code></pre>"},{"location":"configuration/openconfig/#api-models","title":"API models","text":"<p>Starting in EOS <code>4.24.0F</code> it is possible to configure the Smash paths that Octa has access to. Under the <code>management api models</code> mode, the provider smash sub-mode allows for enabling or disabling a Smash path with the <code>[no] path smash_path_here [disabled]</code> command.</p> <pre><code>management api models\n   provider smash\n      path forwarding/status\n      path routing/status disabled\n      path routing/isis/lsdb\n</code></pre> <p>Note that every time a new path is added the Octa agent has to be restarted. EOS CLI:</p> <pre><code>management api gnmi\n   transport grpc &lt;NAME&gt;\n   shutdown\n   no shutdown\n</code></pre> <p>Bash: <code>$ sudo killall Octa</code></p> <p>Alternatively <code>agent Octa terminate</code> can be used from EOS CLI as well.</p> <p><code>show management api models</code> will list the Smash paths enabled/disabled</p> <p>e.g.:</p> <pre><code>#show management api models\nprovider smash\n  path /Smash/bridging\n  path /Smash/forwarding/status\n  path /Smash/routing/isis/lsdb\n  path /Smash/routing\n  path /Smash/routing/status disabled\nprovider sysdb\n</code></pre>"},{"location":"configuration/openconfig/#aaa-accounting-for-gnmiopenconfig","title":"AAA Accounting for gNMI/OpenConfig","text":"<p>Starting with EOS 4.27.2F <code>accounting requests</code> can be enabled to account records for gNMI/gNOI RPCs:</p> <pre><code>management api gnmi\n   transport grpc default\n      authorization requests\n      accounting requests\n   provider eos-native\n!\naaa accounting commands all default start-stop logging\n</code></pre> <p>we can also use these commands to log to tacacs+ or radius and syslog too</p> <pre><code>aaa accounting commands all default start-stop group tacacs+\naaa accounting commands all default start-stop group radius\n</code></pre> <pre><code>spine1# sh management api gnmi\nOcta: enabled\n\nTransport: default\nEnabled: yes\nServer: running on port 6030, in default VRF\nSSL profile: none\nQoS DSCP: none\nAuthorization required: yes\nAccounting requests: yes\nCertificate username authentication: no\nNotification timestamp: last change time\nListen addresses: ::\nspine1#\n</code></pre> <p>Configuration change using OpenConfig and gNMI:</p> <pre><code>$ gnmic -a 192.168.0.10:6030 -u arista -p arista77rx --insecure set --update-path \"/interfaces/interface[name=Ethernet1]/config/description\" --update-value \"test\"\n{\n  \"source\": \"192.168.0.10:6030\",\n  \"timestamp\": 1663615213475353999,\n  \"time\": \"2022-09-19T19:20:13.475353999Z\",\n  \"results\": [\n    {\n      \"operation\": \"UPDATE\",\n      \"path\": \"interfaces/interface[name=Ethernet1]/config/description\"\n    }\n  ]\n}\n</code></pre> <pre><code>$ gnmic -a 192.168.0.10:6030 -u arista -p arista77rx --insecure get --path \"/interfaces/interface[name=Ethernet1]/config/description\"\n[\n  {\n    \"source\": \"192.168.0.10:6030\",\n    \"timestamp\": 1663615224964145128,\n    \"time\": \"2022-09-19T19:20:24.964145128Z\",\n    \"updates\": [\n      {\n        \"Path\": \"interfaces/interface[name=Ethernet1]/config/description\",\n        \"values\": {\n          \"interfaces/interface/config/description\": \"test\"\n        }\n      }\n    ]\n  }\n]\n</code></pre> <p>Syslog messages on the device:</p> <pre><code>spine1#sh logging last 5 minutes\nSep 19 19:20:13 spine1 Aaa: %ACCOUNTING-6-CMD: arista unknown unknown stop task_id=34 start_time=1663615213.48 timezone=UTC service=shell priv-lvl=15 cmd=OpenConfig.Set addr=192.168.0.1:57388 rpc=/gnmi.gNMI/Set request={\"update\":[{\"path\":\"/interfaces/interface[name=Ethernet1]/config/description\",\"val\":\"\\\\\"test\\\\\"\"}]} &lt;cr&gt;\nSep 19 19:20:13 spine1 ConfigAgent: %SYS-5-CONFIG_SESSION_ENTERED: User arista entered configuration session session11521733719371 on GNMI (192.168.0.1:57388)\nSep 19 19:20:13 spine1 ConfigAgent: %SYS-5-CONFIG_SESSION_COMMIT_SUCCESS: User arista committed configuration session session11521733719371 successfully on GNMI (192.168.0.1:57388)\nSep 19 19:20:13 spine1 ConfigAgent: %SYS-5-CONFIG_SESSION_EXITED: User arista exited configuration session session11521733719371 on GNMI (192.168.0.1:57388)\nSep 19 19:20:24 spine1 Aaa: %ACCOUNTING-6-CMD: arista unknown unknown stop task_id=35 start_time=1663615224.96 timezone=UTC service=shell priv-lvl=15 cmd=OpenConfig.Get addr=192.168.0.1:57428 rpc=/gnmi.gNMI/Get request={\"path\":[{\"path\":\"/interfaces/interface[name=Ethernet1]/config/description\"}]} &lt;cr&gt;\n</code></pre> <pre><code>spine1#trace monitor octa\n--- Monitoring /var/log/agents/Octa-3748 ---\nI0919 19:20:13.715618    3748 router.go:234] Cli commands:\nconfigure session session11521733719371\ninterface Ethernet1\ndescription test\nexit\nconfigure session session11521733719371 commit\n^Cspine1#\n</code></pre> <pre><code>spine1#bash ps -ef | grep Octa\nroot      3748   480  2 16:51 ?        00:03:20 /usr/bin/Octa --agenttitle=Octa\n</code></pre> <pre><code>spine1#bash  more /var/log/agents/Octa-3748 | tail -4\ninterface Ethernet1\ndescription test\nexit\nconfigure session session11521733719371 commit\nspine1#\n</code></pre>"},{"location":"configuration/openconfig/#limitations","title":"Limitations","text":"<p>An accounting record is limited to a maximum of 8098 characters. The record will be truncated if it exceeds the maximum character length.</p>"},{"location":"configuration/openconfig/#gnmi-per-rpc-role-authorizations","title":"gNMI per-RPC role authorizations","text":"<p>Starting in EOS <code>4.24.1F</code> it is possible to perform authorization of each RPC (that is, GET, SET, SUBSCRIBE), if authorization requests is supplied as described above.</p> <p>During authorization, the OpenConfig agent will communicate with the AAA agent, allowing authorization policies or roles to permit or deny the new tokens <code>OpenConfig.Get</code> and <code>OpenConfig.Set</code>.</p> <p>For example, a role may be defined such as:</p> <pre><code>role oc-read\n   10 permit command OpenConfig.Get\n</code></pre> <p>A user which is assigned to this role would be allowed to issue a gNMI GET or SUBSCRIBE request, but not a SET request.</p> <p>Note that this is only available for gNMI.</p>"},{"location":"configuration/openconfig/#enable-aft-mapping","title":"Enable AFT mapping","text":"<p>By default, mapping of the FIB (forwarding information base) to the OpenConfig AFT (abstract forwarding table) model is disabled, as the volume of data can be large.</p> <p>Starting in EOS <code>4.25.1F</code> it is possible to enable these mappings, for IPV4, IPV6, or both, as described below:</p> <pre><code>management api models\n   provider aft\n      ipv4-unicast\n      ipv6-unicast\n</code></pre> <p>Note that prior to EOS 4.27 a restart of the gNMI agent is required, e.g.: <code>agent Octa terminate</code> or <code>agent OpenConfig terminate</code> (in case the eos-native provider is not enabled).</p>"},{"location":"configuration/openconfig/#telemetry-timestamps","title":"Telemetry Timestamps","text":"<p>Per the GNMI specification, the default timestamp field of a notification message is set to be the time at which the value of the underlying data source changes or when the reported event takes place. In order to facilitate integration in legacy environments oriented around polling style operations, an option to support overriding the timestamp field to the send-time is available. (as of 4.27.0F)</p> <p>Overriding the timestamp to <code>send-time</code> is applicable to all STREAM and POLL subscriptions.</p> <p>Configuration is outlined below.</p> <pre><code>management api gnmi\n   transport grpc &lt;NAME&gt;\n      notification timestamp send-time\n</code></pre> <p>If there's a need to return to the standards-oriented operation, the following mechanisms can be used to reset the behavior.</p> <pre><code>no notification timestamp send-time\ndefault notification timestamp\nnotification timestamp last-change-time\n</code></pre> Validation <p> <pre><code>#show management api gnmi\nOcta: enabled\nSet persistence: enabled\n\nTransport: default\nEnabled: yes\nServer: running on port 6030, in default VRF\nSSL profile: none\nQoS DSCP: none\nAuthorization required: no\nAccounting requests: no\nCertificate username authentication: no\nNotification timestamp: send time  !! note: timestamp mode\nListen addresses: ::\n</code></pre> </p>"},{"location":"configuration/openconfig/#configuration-persistence","title":"Configuration Persistence","text":"<p>By default, within EOS, the application of gNMI <code>Set</code> RPCs are not persisted to the <code>startup-config</code>.  A <code>copy running-config startup-config</code> is required in order to save configuration updates imposed via gNMI.</p> <p>As of EOS 4.28.0F, if the operator desires to be able to save gNMI-driven configuration automatically, persistence can be enabled by adding the following configuration. With this option, all gnmi <code>Set</code> operations will be saved to the <code>startup-config</code>. Note, the configuration is saved using Arista's EOS configuration syntax and there is no corresponding presentation of the OpenConfig syntax.</p> <pre><code>management api gnmi\n   transport grpc &lt;NAME&gt;\n   operation set persistence\n</code></pre> <p>If there is a need to return to the default mode of gNMI configuration non-persistence, this can be disabled using the following commands.</p> <pre><code>no operation set persistence\ndefault operation set persistence\n</code></pre> Validation <p> <pre><code>#show management api gnmi\nOcta: enabled\nSet persistence: enabled  !! note: persistence state\n\nTransport: default\nEnabled: yes\nServer: running on port 6030, in default VRF\nSSL profile: none\nQoS DSCP: none\nAuthorization required: no\nAccounting requests: no\nCertificate username authentication: no\nNotification timestamp: last change time\nListen addresses: ::\n</code></pre> </p>"},{"location":"configuration/openconfig/#troubleshooting","title":"Troubleshooting","text":"<p>The OpenConfig agent handles all transports described above: gNMI, RESTCONF, and NETCONF. The agent log file is present at <code>/var/log/agents/OpenConfig-{PID}</code>. Lines that begin with <code>E</code> are errors. Debug logging can be enabled with a regular trace command. Here are a couple of examples:</p> <p><code>(config)#trace OpenConfig setting server/9</code> - For server (gNMI) traces</p> <p><code>(config)#trace OpenConfig setting */9</code> - For all traces with verbose setting</p> <p>similarly if Octa is enabled:</p> <p><code>(config)#trace Octa setting server/9</code> - For server (gNMI) traces</p> <p><code>(config)#trace Octa setting */9</code> - For all traces with verbose setting</p>"},{"location":"configuration/openconfig/#limitations_1","title":"Limitations","text":"<ul> <li>In EOS versions prior to <code>4.24.0F</code>, not all Smash paths were accessible via Octa.</li> <li>Starting in EOS <code>4.24.0F</code> configuring the Smash paths that Octa has access to will also affect OpenConfig. Enabling a   Smash path for Octa can result in extra YANG paths being populated in OpenConfig. Disabling a Smash path can result in   having some YANG paths missing in OpenConfig.</li> <li>The <code>%&lt;zone-id&gt;</code> optional suffix in YANG <code>ietf:ipv4-address</code>, and <code>ietf:ipv6-address</code> types are not supported.</li> <li>An OpenConfig client update/merge/replace request can erase config that is not modified by the incoming request. This   happens if a config that is part of a certain mount point but not supported by OpenConfig is configured via CLI prior   to the OpenConfig client update/merge/replace request is processed.</li> </ul>"},{"location":"configuration/openconfig/#supported-openconfig-paths","title":"Supported OpenConfig paths","text":"<p>Please refer to the EOS Central TOIs to see the new list of paths supported per release.</p> <p>For convenience, supported paths may be found at: https://eos.arista.com/path-report.</p>"},{"location":"configuration/openconfig/#references-resources","title":"References / Resources","text":"<ul> <li>The OpenConfig working group: http://openconfig.net/</li> <li>Repository of gNMI specifications: https://github.com/openconfig/reference/</li> </ul>"},{"location":"configuration/restconf/","title":"RESTCONF Configuration","text":""},{"location":"configuration/restconf/#overview","title":"Overview","text":"<p>EOS provides support for RESTCONF and the necessary transport services to support it.</p> <p>The RESTCONF server is in the EOS device.</p>"},{"location":"configuration/restconf/#restconf-configuration-on-eos","title":"RESTCONF configuration on EOS","text":""},{"location":"configuration/restconf/#certificate","title":"Certificate","text":"<p>Certificate-based authentication is required for RESTCONF to operate. You should follow the instructions in the Certificate Authentication section in order to generate and install a certificate to support RESTCONF in your environment. Alternately, a self-signed certificate may be generated on the switch and certificate validation can be handled appropriately by remote RESTCONF clients.</p> <p>The following Cli command generates a self-signed cert:</p> <pre><code>security pki certificate generate self-signed restconf.crt key restconf.key generate rsa 2048 parameters common-name restconf\n</code></pre> <p>Create ssl profile:</p> <pre><code>management security\n   ssl profile restconf\n   certificate restconf.crt key restconf.key\n</code></pre>"},{"location":"configuration/restconf/#restconf-api","title":"RESTCONF API","text":"<p>Configure RESTCONF:</p> <p>Default VRF:</p> <pre><code>management api restconf\n   transport https test\n   ssl profile restconf\n</code></pre> <p>Non-default VRF</p> <pre><code>management api restconf\n   transport https test\n   ssl profile restconf\n   vrf management\n</code></pre> <p>Changing the port:</p> <pre><code>management api restconf\n   transport https test\n      port 5900\n</code></pre> <p>Apply ACL</p> <pre><code>management api restconf\n   transport https test\n      ip access-group ACCESS_GROUP\n</code></pre> <p>Note The ACL should be a standard ACL allowing hosts or subnets.</p>"},{"location":"configuration/restconf/#control-plane-acl","title":"Control-plane ACL","text":"<p>The default RESTCONF port on Arista devices is TCP 6020.</p> <p>We need to change the default control-plane ACL on EOS in order to allow TCP 6020 (or to allow the configured RESTCONF port).</p> <p>Please refer to this link</p>"},{"location":"configuration/restconf/#status-check","title":"Status check","text":"<pre><code>#show management api restconf\nEnabled:            Yes\nServer:             running on port 6020, in management VRF\nSSL Profile:        restconf\nQoS DSCP:           none\n</code></pre>"},{"location":"configuration/security/","title":"Securing Management Services","text":""},{"location":"configuration/security/#changing-default-service-ports","title":"Changing Default Service Ports","text":"<p>When changing the default ports one has to make sure they are also allowed in the control-plane ACL. The default control-plane ACL cannot be modified, so a new one has to be created and applied under <code>system control-plane</code> (EOS <code>4.23+</code>) or <code>control-plane</code> (pre-EOS <code>4.23</code>). The fastest way to do this is to clone the existing control-plane and add new permit rules.</p>"},{"location":"configuration/security/#example","title":"Example","text":"<p>1. Reading the default CP ACL can be done with <code>show ip access-lists default-control-plane-acl</code></p> <pre><code>#show ip access-lists default-control-plane-acl\nIP Access List default-control-plane-acl [readonly]\n        counters per-entry\n        10 permit icmp any any [match 7172 packets, 1 day, 20:46:09 ago]\n        20 permit ip any any tracked [match 98544013 packets, 0:00:36 ago]\n        30 permit udp any any eq bfd ttl eq 255\n        40 permit udp any any eq bfd-echo ttl eq 254\n        50 permit udp any any eq multihop-bfd\n        60 permit udp any any eq micro-bfd\n        70 permit udp any any eq sbfd\n        80 permit udp any eq sbfd any eq sbfd-initiator\n        90 permit ospf any any\n        100 permit tcp any any eq ssh telnet www snmp bgp https msdp ldp netconf-ssh gnmi [match 873 packets, 1 day, 20:43:39 ago]\n        110 permit udp any any eq bootps bootpc snmp rip ntp ldp [match 970 packets, 1:43:38 ago]\n        120 permit tcp any any eq mlag ttl eq 255\n        130 permit udp any any eq mlag ttl eq 255\n        140 permit vrrp any any\n        150 permit ahp any any\n        160 permit pim any any\n        170 permit igmp any any\n        180 permit tcp any any range 5900 5910\n        190 permit tcp any any range 50000 50100 [match 1480505 packets, 1 day, 20:43:16 ago]\n        200 permit udp any any range 51000 51100\n        210 permit tcp any any eq 3333\n        220 permit tcp any any eq nat ttl eq 255\n        230 permit tcp any eq bgp any\n        240 permit rsvp any any\n        250 permit tcp any any eq 6040\n        260 permit tcp any any eq 5541 ttl eq 255\n        270 permit tcp any any eq 5542 ttl eq 255\n</code></pre> <p>2. There are multiple ways to quickly edit and remove the unnecessary match    outputs, in this example we'll use <code>sed</code> on EOS. Save the file to <code>/mnt/flash</code>:</p> <pre><code>show ip access-lists  default-control-plane-acl | redirect flash:cpacl.txt\n</code></pre> <p>3. Enter bash: <code>#bash</code></p> <p>4. Go to <code>/mnt/flash</code> and remove the match outputs</p> <pre><code>cd /mnt/flash\nsudo sed -i  \"s/\\[.*//g\" cpacl.txt\n</code></pre> <p>5. Reading the file now should be clean without all the match counter outputs like below:</p> <pre><code>IP Access List default-control-plane-acl\n        counters per-entry\n        10 permit icmp any any\n        20 permit ip any any tracked\n        30 permit udp any any eq bfd ttl eq 255\n        40 permit udp any any eq bfd-echo ttl eq 254\n        50 permit udp any any eq multihop-bfd\n        60 permit udp any any eq micro-bfd\n        70 permit udp any any eq sbfd\n        80 permit udp any eq sbfd any eq sbfd-initiator\n        90 permit ospf any any\n        100 permit tcp any any eq ssh telnet www snmp bgp https msdp ldp netconf-ssh gnmi\n        110 permit udp any any eq bootps bootpc snmp rip ntp ldp\n        120 permit tcp any any eq mlag ttl eq 255\n        130 permit udp any any eq mlag ttl eq 255\n        140 permit vrrp any any\n        150 permit ahp any any\n        160 permit pim any any\n        170 permit igmp any any\n        180 permit tcp any any range 5900 5910\n        190 permit tcp any any range 50000 50100\n        200 permit udp any any range 51000 51100\n        210 permit tcp any any eq 3333\n        220 permit tcp any any eq nat ttl eq 255\n        230 permit tcp any eq bgp any\n        240 permit rsvp any any\n        250 permit tcp any any eq 6040\n        260 permit tcp any any eq 5541 ttl eq 255\n        270 permit tcp any any eq 5542 ttl eq 255\n</code></pre> <p>6. Now we can just copy that ACLs content into a new ACL, add our new rules and apply it on the control-plane.</p> <p>From config mode:</p> <pre><code>ip access-list custom-cp\n   &lt;paste the content of the default CP from the file created&gt;\n   280 permit tcp any any eq 5900\n</code></pre> <p>7. Apply the new ACL</p> <p>Default VRF</p> <pre><code>system control-plane\n   ip access-group custom-cp in\n</code></pre> <p>Non-default VRF</p> <pre><code>system control-plane\n   ip access-group custom-cp vrf management in\n</code></pre>"},{"location":"examples/","title":"examples","text":""},{"location":"examples/#overview","title":"Overview","text":"<p>In the examples folder we provide a variety of examples that will show how to use some of the many third party tools to interact with one of the GRPC interfaces(gNMI,gNOI and gRIBI) within Arista EOS.</p>"},{"location":"examples/#tools","title":"Tools","text":"<ul> <li>arista gnmi client</li> <li>gnmic</li> <li>gnmi-gateway</li> <li>gnoic</li> <li>grpcurl</li> <li>golang</li> <li>pygnmi</li> <li>pyang</li> <li>pyangbind</li> <li>WiFi</li> </ul>"},{"location":"examples/WiFi/","title":"WiFi","text":""},{"location":"examples/WiFi/#overview","title":"Overview","text":"<p>Arista APs include an agent module (ocagent) that implements the OpenConfig interfaces. The agent module interacts with the rest of the AP modules for applying changes, fetching data, etc. For mor information on OpenConfig implementation in Arista WiFi, see OpenConfig for Arista WiFi.</p> <p>This page lists a few examples of the AP using gNMI. For more information on gNxI, refer to gNxI Tools.</p>"},{"location":"examples/WiFi/#get-ap","title":"Get AP","text":"<pre><code>python py_gnmicli.py -m\nget -t &lt;AP-IP&gt; -x /provision-aps -user &lt;username&gt; -pass &lt;password&gt; -p &lt;port&gt; -g -o openconfig.mojonetworks.com\n</code></pre> Reveal output <p> <pre><code>{\n\"openconfig-ap-manager:provision-ap\": [\n{\n\"mac\": \"30:86:2D:B0:0F:EF\",\n\"config\": {\n\"country-code\": \"IN\",\n\"hostname\": \"arista\"\n},\n\"state\": {\n\"country-code\": \"IN\",\n\"hostname\": \"arista\"\n}\n}\n]\n}\n</code></pre> </p>"},{"location":"examples/WiFi/#get-operating-frequencies-bands-of-ssid","title":"Get operating frequencies (bands) of SSID","text":"<pre><code>python py_gnmicli.py -m\nget -t &lt;AP-IP&gt;  -user &lt;username&gt; -pass &lt;password&gt; -p &lt;port&gt; -g -o openconfig.mojonetworks.com -x access-points/access-point[hostname=&lt;host&gt;]/ssids/ssid[name=&lt;ssid-name&gt;]/state/operating-frequency\n</code></pre> Reveal output <p> <pre><code>FREQ_2_5_GHZ\n</code></pre> </p>"},{"location":"examples/WiFi/#get-ssid-configuration","title":"Get SSID Configuration","text":"<pre><code>python py_gnmicli.py -m\nget -t &lt;AP-IP&gt;  -user &lt;username&gt; -pass &lt;password&gt; -p &lt;port&gt; -g -o openconfig.mojonetworks.com -x access-points/access-point[hostname=&lt;host&gt;]/ssids/ssid[name=&lt;ssid-name&gt;]/config\n</code></pre> Reveal output <p> <pre><code>{\n\"openconfig-access-points:dva\": true,\n\"openconfig-access-points:supported-data-rates-5g\": [\n\"openconfig-wifi-types:RATE_11MB\",\n\"openconfig-wifi-types:RATE_12MB\",\n\"openconfig-wifi-types:RATE_18MB\",\n\"openconfig-wifi-types:RATE_24MB\",\n\"openconfig-wifi-types:RATE_36MB\",\n\"openconfig-wifi-types:RATE_48MB\",\n\"openconfig-wifi-types:RATE_54MB\"\n],\n\"openconfig-access-points:opmode\": \"WPA2_PERSONAL\",\n\"openconfig-access-points:okc\": true,\n\"openconfig-access-points:supported-data-rates-2g\": [\n\"openconfig-wifi-types:RATE_11MB\",\n\"openconfig-wifi-types:RATE_12MB\",\n\"openconfig-wifi-types:RATE_18MB\",\n\"openconfig-wifi-types:RATE_24MB\",\n\"openconfig-wifi-types:RATE_36MB\",\n\"openconfig-wifi-types:RATE_48MB\",\n\"openconfig-wifi-types:RATE_54MB\"\n],\n\"openconfig-access-points:name\": \"OCWiFi1\",\n\"openconfig-access-points:basic-data-rates-2g\": [\n\"openconfig-wifi-types:RATE_11MB\",\n\"openconfig-wifi-types:RATE_12MB\",\n\"openconfig-wifi-types:RATE_18MB\",\n\"openconfig-wifi-types:RATE_24MB\",\n\"openconfig-wifi-types:RATE_36MB\",\n\"openconfig-wifi-types:RATE_48MB\",\n\"openconfig-wifi-types:RATE_54MB\"\n],\n\"openconfig-access-points:wpa2-psk\": \"0123456789\",\n\"openconfig-access-points:basic-data-rates-5g\": [\n\"openconfig-wifi-types:RATE_11MB\",\n\"openconfig-wifi-types:RATE_12MB\",\n\"openconfig-wifi-types:RATE_18MB\",\n\"openconfig-wifi-types:RATE_24MB\",\n\"openconfig-wifi-types:RATE_36MB\",\n\"openconfig-wifi-types:RATE_48MB\",\n\"openconfig-wifi-types:RATE_54MB\"\n]\n}\n</code></pre> </p>"},{"location":"examples/WiFi/#get-clients-for-ssid","title":"Get clients for SSID","text":"<pre><code>python py_gnmicli.py -m\nget -t &lt;AP-IP&gt;  -user &lt;username&gt; -pass &lt;password&gt; -p &lt;port&gt; -g -o openconfig.mojonetworks.com -x access-points/access-point[hostname=&lt;host&gt;]/ssids/ssid[name=&lt;ssid-name&gt;]/clients\n</code></pre> Reveal output <p> <pre><code>{\n\"openconfig-access-points:client\": [\n{\n\"mac\": \"C2:2F:42:79:CB:BA\",\n\"client-rf\": {\n\"state\": {\n\"phy-rate\": 0,\n\"rssi\": -52,\n\"frequency\": 0,\n\"snr\": 42,\n\"ss\": 0\n}\n},\n\"state\": {\n\"mac\": \"C2:2F:42:79:CB:BA\",\n\"counters\": {\n\"tx-bytes\": \"34707\",\n\"tx-retries\": \"0\",\n\"rx-bytes\": \"19705\",\n\"rx-retries\": \"18\"\n}\n},\n\"client-connection\": {\n\"state\": {\n\"username\": \"\",\n\"client-state\": \"openconfig-wifi-types:AUTHENTICATED\",\n\"hostname\": \"\",\n\"operating-system\": \"\",\n\"ipv6-addresses\": [\n\"fe80::c02f:42ff:fe79:cbba\"\n],\n\"ipv4-address\": [\n\"192.168.29.250\"\n],\n\"connection-time\": \"1628849487411018113\"\n}\n}\n}\n]\n}\n</code></pre> </p>"},{"location":"examples/WiFi/#get-operating-channel-of-radio","title":"Get operating channel of radio","text":"<pre><code>python py_gnmicli.py -m\nget -t &lt;AP-IP&gt;  -user &lt;username&gt; -pass &lt;password&gt; -p &lt;port&gt; -g -o openconfig.mojonetworks.com -x access-points/access-point[hostname=&lt;host&gt;]/radios/radio[id=1][operating-frequency=FREQ_5GHZ]/state/channel\n</code></pre> Reveal output <p> <pre><code>{\ntimestamp: 1628855017049472718\nupdate {\npath {\nelem {\nname: \"access-points\"\n}\nelem {\nname: \"access-point\"\nkey {\nkey: \"hostname\"\nvalue: \"arista\"\n}\n}\nelem {\nname: \"radios\"\n}\nelem {\nname: \"radio\"\nkey {\nkey: \"id\"\nvalue: \"1\"\n}\nkey {\nkey: \"operating-frequency\"\nvalue: \"FREQ_5GHZ\"\n}\n}\nelem {\nname: \"state\"\n}\nelem {\nname: \"channel\"\n}\n}\nval {\nuint_val: 36\n}\n}\n}\n</code></pre> </p>"},{"location":"examples/WiFi/#get-operating-eirp-of-radio","title":"Get operating EIRP of radio","text":"<pre><code>python py_gnmicli.py -m\nget -t &lt;AP-IP&gt;  -user &lt;username&gt; -pass &lt;password&gt; -p &lt;port&gt; -g -o openconfig.mojonetworks.com -x access-points/access-point[hostname=&lt;host&gt;]/radios/radio[id=1][operating-frequency=FREQ_5GHZ]/state/transmit-eirp\n</code></pre> Reveal output <p> <pre><code>{\ntimestamp: 1628855017049472718\nupdate {\npath {\nelem {\nname: \"access-points\"\n}\nelem {\nname: \"access-point\"\nkey {\nkey: \"hostname\"\nvalue: \"arista\"\n}\n}\nelem {\nname: \"radios\"\n}\nelem {\nname: \"radio\"\nkey {\nkey: \"id\"\nvalue: \"1\"\n}\nkey {\nkey: \"operating-frequency\"\nvalue: \"FREQ_5GHZ\"\n}\n}\nelem {\nname: \"state\"\n}\nelem {\nname: \"transmit-eirp\"\n}\n}\nval {\nuint_val: 28\n}\n}\n}\n</code></pre> </p>"},{"location":"examples/WiFi/#set-operating-channel-of-radio","title":"Set operating channel of radio","text":"<pre><code>python py_gnmicli.py -m\nset-replace-t &lt;AP-IP&gt;  -user &lt;username&gt; -pass &lt;password&gt; -p &lt;port&gt; -g -o openconfig.mojonetworks.com -x access-points/access-point[hostname=&lt;host&gt;]/radios/radio[id=1][operating-frequency=FREQ_5GHZ]/config/channel -val 169\n</code></pre> Reveal output <p> <pre><code>response {\npath {\nelem {\nname: \"access-points\"\n}\nelem {\nname: \"access-point\"\nkey {\nkey: \"hostname\"\nvalue: \"arista\"\n}\n}\nelem {\nname: \"radios\"\n}\nelem {\nname: \"radio\"\nkey {\nkey: \"id\"\nvalue: \"1\"\n}\nkey {\nkey: \"operating-frequency\"\nvalue: \"FREQ_5GHZ\"\n}\n}\nelem {\nname: \"config\"\n}\nelem {\nname: \"channel\"\n}\n}\nop: REPLACE\n}\n</code></pre> </p>"},{"location":"examples/ansible/","title":"Ansible playbook example demo","text":""},{"location":"examples/ansible/#overview","title":"overview","text":"<p>In this ansible collection we show how to use ansible to find all the available modules within an Arista EOS device using the capabilities method within gNMI.</p>"},{"location":"examples/ansible/#edit-the-inventory-file-to-match-your-environment","title":"Edit the inventory file to match your environment","text":"<pre><code>[leaf]\n127.0.0.1 ansible_user=admin ansible_password=admin\n\n[all:vars]\nansible_user=admin\nansible_password=admin\nansible_become_pass=admin\nansible_python_interpreter=/usr/bin/python3\nansible_port=6030\nansible_connection=nokia.grpc.gnmi\nansible_gnmi_encoding=JSON\n</code></pre>"},{"location":"examples/ansible/#gnmi-collection","title":"gNMI collection","text":"<pre><code>ansible-galaxy collection install nokia.openconfig\n</code></pre>"},{"location":"examples/ansible/#run-the-playbook","title":"Run the playbook","text":"<pre><code>ansible-playbook -i inventory capabilities.yaml\n</code></pre>"},{"location":"examples/ansible/#output-of-playbook","title":"output of playbook","text":"<pre><code>ok: [10.20.30.67] =&gt; {\n    \"msg\": {\n        \"gNMIVersion\": \"0.7.0\",\n        \"supportedEncodings\": [\n            \"JSON\",\n            \"JSON_IETF\",\n            \"ASCII\"\n        ],\n        \"supportedModels\": [\n            {\n                \"name\": \"arista-exp-eos-multicast\",\n                \"organization\": \"Arista Networks &lt;http://arista.com/&gt;\"\n            },\n            {\n                \"name\": \"arista-exp-eos-evpn\",\n                \"organization\": \"Arista Networks, Inc.\"\n            },\n</code></pre>"},{"location":"examples/gnmi-clients/arista-gnmi/","title":"Arista gNMI client examples","text":""},{"location":"examples/gnmi-clients/arista-gnmi/#gnmi-get-rpc-examples","title":"gNMI GET RPC Examples","text":""},{"location":"examples/gnmi-clients/arista-gnmi/#openconfig-paths","title":"OpenConfig paths","text":""},{"location":"examples/gnmi-clients/arista-gnmi/#get-all-information","title":"Get all information","text":"<pre><code>gnmi -addr 192.0.2.139:6030 -username admin -password arista get /\n</code></pre>"},{"location":"examples/gnmi-clients/arista-gnmi/#get-the-bgp-configuration-in-the-default-vrf","title":"Get the BGP configuration in the default VRF","text":"<pre><code>gnmi -addr 198.51.100.219:6030 -username admin -password arista \\\nget '/network-instances/network-instance[name=default]/protocols/protocol[identifier=BGP][name=BGP]/bgp'`\n</code></pre> Reveal output <p> <pre><code>/network-instances/network-instance[name=default]/protocols/protocol[identifier=BGP][name=BGP]/bgp:\n{\n\"openconfig-network-instance:global\": {\n\"confederation\": {\n\"config\": {\n\"identifier\": 0\n},\n\"state\": {p\n\"identifier\": 0\n}\n},\n\"config\": {\n\"as\": 4206000022,\n\"router-id\": \"0.0.0.0\"\n},\n\"default-route-distance\": {\n\"config\": {\n\"external-route-distance\": 200,\n\"internal-route-distance\": 200\n},\n\"state\": {\n\"external-route-distance\": 200,\n\"internal-route-distance\": 200\n}\n},\n\"graceful-restart\": {\n\"config\": {\n\"restart-time\": 0\n},\n\"state\": {\n\"restart-time\": 0\n}\n},\n\"route-selection-options\": {\n\"config\": {},\n\"state\": {}\n},\n\"state\": {\n\"as\": 4206000022,\n\"router-id\": \"4.4.4.4\"\n}\n},\n\"openconfig-network-instance:neighbors\": {\n\"neighbor\": [\n{\n\"afi-safis\": {\n\"afi-safi\": [\n{\n\"afi-safi-name\": \"IPV4_UNICAST\",\n\"config\": {\n\"afi-safi-name\": \"IPV4_UNICAST\",\n\"enabled\": false\n},\n\"graceful-restart\": {\n\"config\": {\n\"enabled\": false\n},\n\"state\": {\n\"enabled\": false\n}\n},\n\"state\": {\n\"afi-safi-name\": \"IPV4_UNICAST\",\n\"enabled\": false\n}\n},\n{\n\"afi-safi-name\": \"IPV6_UNICAST\",\n\"config\": {\n\"afi-safi-name\": \"IPV6_UNICAST\",\n\"enabled\": false\n},\n\"graceful-restart\": {\n\"config\": {\n\"enabled\": false\n},\n\"state\": {\n\"enabled\": false\n}\n},\n\"state\": {\n\"afi-safi-name\": \"IPV6_UNICAST\",\n\"enabled\": false\n}\n}\n]\n},\n\"config\": {\n\"auth-password\": \"\",\n\"description\": \"\",\n\"local-as\": 0,\n\"neighbor-address\": \"3.4.5.6\",\n\"peer-as\": 1,\n\"send-community\": \"NONE\"\n},\n\"ebgp-multihop\": {\n\"config\": {\n\"multihop-ttl\": 0\n},\n\"state\": {\n\"multihop-ttl\": 0\n}\n},\n\"neighbor-address\": \"3.4.5.6\",\n\"route-reflector\": {\n\"config\": {\n\"route-reflector-client\": false\n},\n\"state\": {\n\"route-reflector-client\": false\n}\n},\n\"state\": {\n\"auth-password\": \"\",\n\"description\": \"\",\n\"local-as\": 0,\n\"peer-as\": 1,\n\"send-community\": \"NONE\"\n},\n\"timers\": {\n\"config\": {\n\"hold-time\": \"180.0\",\n\"keepalive-interval\": \"60.0\"\n},\n\"state\": {\n\"hold-time\": \"180.0\",\n\"keepalive-interval\": \"60.0\"\n}\n},\n\"transport\": {\n\"config\": {\n\"passive-mode\": false\n},\n\"state\": {\n\"passive-mode\": false\n}\n}\n},\n{\n\"afi-safis\": {\n\"afi-safi\": [\n{\n\"afi-safi-name\": \"IPV4_UNICAST\",\n\"config\": {\n\"afi-safi-name\": \"IPV4_UNICAST\",\n\"enabled\": false\n},\n\"graceful-restart\": {\n\"config\": {\n\"enabled\": false\n},\n\"state\": {\n\"enabled\": false\n}\n},\n\"state\": {\n\"afi-safi-name\": \"IPV4_UNICAST\",\n\"enabled\": false\n}\n},\n{\n\"afi-safi-name\": \"IPV6_UNICAST\",\n\"config\": {\n\"afi-safi-name\": \"IPV6_UNICAST\",\n\"enabled\": false\n},\n\"graceful-restart\": {\n\"config\": {\n\"enabled\": false\n},\n\"state\": {\n\"enabled\": false\n}\n},\n\"state\": {\n\"afi-safi-name\": \"IPV6_UNICAST\",\n\"enabled\": false\n}\n}\n]\n},\n\"config\": {\n\"auth-password\": \"\",\n\"description\": \"\",\n\"local-as\": 0,\n\"neighbor-address\": \"20.1.1.1\",\n\"peer-as\": 65001,\n\"send-community\": \"NONE\"\n},\n\"ebgp-multihop\": {\n\"config\": {\n\"multihop-ttl\": 0\n},\n\"state\": {\n\"multihop-ttl\": 0\n}\n},\n\"neighbor-address\": \"20.1.1.1\",\n\"route-reflector\": {\n\"config\": {\n\"route-reflector-client\": false\n},\n\"state\": {\n\"route-reflector-client\": false\n}\n},\n\"state\": {\n\"auth-password\": \"\",\n\"description\": \"\",\n\"local-as\": 0,\n\"peer-as\": 65001,\n\"send-community\": \"NONE\"\n},\n\"timers\": {\n\"config\": {\n\"hold-time\": \"180.0\",\n\"keepalive-interval\": \"60.0\"\n},\n\"state\": {\n\"hold-time\": \"180.0\",\n\"keepalive-interval\": \"60.0\"\n}\n},\n\"transport\": {\n\"config\": {\n\"passive-mode\": false\n},\n\"state\": {\n\"passive-mode\": false\n}\n}\n}\n]\n}\n</code></pre> </p>"},{"location":"examples/gnmi-clients/arista-gnmi/#get-bgp-neighbors","title":"Get BGP neighbors","text":"<pre><code>gnmi -addr 192.0.2.139 -username admin \\\nget '/network-instances/network-instance[name=default]/protocols/protocol[name=BGP]/bgp/neighbors'\n</code></pre>  Reveal output <p> <pre><code>/network-instances/network-instance[name=default]/protocols/protocol[identifier=BGP][name=BGP]/bgp/neighbors:\n{\n\"openconfig-network-instance:neighbor\": [\n{\n\"afi-safis\": {\n\"afi-safi\": [\n{\n\"afi-safi-name\": \"openconfig-bgp-types:IPV6_UNICAST\",\n\"config\": {\n\"afi-safi-name\": \"openconfig-bgp-types:IPV6_UNICAST\"\n},\n\"state\": {\n\"afi-safi-name\": \"openconfig-bgp-types:IPV6_UNICAST\",\n\"prefixes\": {\n\"arista-bgp-augments:best-ecmp-paths\": 0,\n\"arista-bgp-augments:best-paths\": 0,\n\"installed\": 0,\n\"received\": 0,\n\"sent\": 0\n}\n}\n},\n{\n\"afi-safi-name\": \"openconfig-bgp-types:L2VPN_EVPN\",\n\"config\": {\n\"afi-safi-name\": \"openconfig-bgp-types:L2VPN_EVPN\"\n},\n\"state\": {\n\"afi-safi-name\": \"openconfig-bgp-types:L2VPN_EVPN\",\n\"prefixes\": {\n\"arista-bgp-augments:best-ecmp-paths\": 0,\n\"arista-bgp-augments:best-paths\": 0,\n\"installed\": 0,\n\"received\": 0,\n\"sent\": 0\n}\n}\n},\n{\n\"afi-safi-name\": \"openconfig-bgp-types:IPV4_UNICAST\",\n\"config\": {\n\"afi-safi-name\": \"openconfig-bgp-types:IPV4_UNICAST\"\n},\n\"state\": {\n\"afi-safi-name\": \"openconfig-bgp-types:IPV4_UNICAST\",\n\"prefixes\": {\n\"arista-bgp-augments:best-ecmp-paths\": 0,\n\"arista-bgp-augments:best-paths\": 0,\n\"installed\": 0,\n\"received\": 0,\n\"sent\": 0\n}\n}\n}\n]\n},\n\"apply-policy\": {\n\"config\": {\n\"default-export-policy\": \"REJECT_ROUTE\",\n\"default-import-policy\": \"REJECT_ROUTE\"\n},\n\"state\": {\n\"default-export-policy\": \"REJECT_ROUTE\",\n\"default-import-policy\": \"REJECT_ROUTE\"\n}\n},\n\"as-path-options\": {\n\"config\": {\n\"replace-peer-as\": false\n},\n\"state\": {\n\"replace-peer-as\": false\n}\n},\n\"config\": {\n\"enabled\": true,\n\"neighbor-address\": \"172.168.14.2\",\n\"peer-as\": 65002,\n\"send-community\": \"NONE\"\n},\n\"ebgp-multihop\": {\n\"config\": {\n\"enabled\": false,\n\"multihop-ttl\": 0\n},\n\"state\": {\n\"enabled\": false,\n\"multihop-ttl\": 0\n}\n},\n\"neighbor-address\": \"172.168.14.2\",\n\"state\": {\n\"enabled\": true,\n\"established-transitions\": \"2\",\n\"last-established\": \"1614170027122047488\",\n\"messages\": {\n\"received\": {\n\"UPDATE\": \"2\"\n},\n\"sent\": {\n\"UPDATE\": \"2\"\n}\n},\n\"neighbor-address\": \"172.168.14.2\",\n\"peer-as\": 65002,\n\"send-community\": \"NONE\",\n\"session-state\": \"ESTABLISHED\"\n},\n\"transport\": {\n\"config\": {\n\"mtu-discovery\": true\n},\n\"state\": {\n\"mtu-discovery\": true,\n\"remote-address\": \"172.168.14.2\",\n\"remote-port\": 0\n}\n}\n}\n]\n}\n</code></pre> </p>"},{"location":"examples/gnmi-clients/arista-gnmi/#get-all-interface-descriptions","title":"Get all interface descriptions","text":"<pre><code>gnmi -addr 192.0.2.139:6030 -username admin -password arista \\\nget '/interfaces/interface/subinterfaces/subinterface/state/description'\n</code></pre> <pre><code>/interfaces/interface[name=Ethernet3]/subinterfaces/subinterface[index=0]/state/description: SRV01\n/interfaces/interface[name=Ethernet1]/subinterfaces/subinterface[index=0]/state/description: DCI\n/interfaces/interface[name=Ethernet2]/subinterfaces/subinterface[index=0]/state/description: To Spines\n</code></pre>"},{"location":"examples/gnmi-clients/arista-gnmi/#get-an-interfaces-description","title":"Get an interface's description","text":"<pre><code>gnmi -addr 198.51.100.100:6030 -username admin -password arista \\\nget 'interfaces/interface[name=Ethernet1/1]/subinterfaces/subinterface/state/description'\n</code></pre> <pre><code>/interfaces/interface[name=Ethernet1/1]/subinterfaces/subinterface[index=0]/state/description: \"Tyrion\"\n</code></pre>"},{"location":"examples/gnmi-clients/arista-gnmi/#get-the-operational-status-of-all-interfaces","title":"Get the operational status of all interfaces","text":"<pre><code>gnmi -addr 192.0.2.139:6030 -username admin -password arista \\\nget 'interfaces/interface/state/oper-status'`\n</code></pre>"},{"location":"examples/gnmi-clients/arista-gnmi/#get-all-states-of-an-interface","title":"Get all states of an interface","text":"<pre><code>gnmi -addr 192.0.2.139:6030 -username cvpadmin -password arista \\\nget 'interfaces/interface[name=Ethernet24]/state/'`\n</code></pre> Reveal output <p> <pre><code>/interfaces/interface[name=Ethernet24]/state:\n{\n\"openconfig-interfaces:admin-status\": \"UP\",\n\"openconfig-interfaces:counters\": {\n\"in-broadcast-pkts\": \"1\",\n\"in-discards\": \"0\",\n\"in-errors\": \"0\",\n\"in-fcs-errors\": \"0\",\n\"in-multicast-pkts\": \"70143\",\n\"in-octets\": \"570132503174\",\n\"in-unicast-pkts\": \"376128549\",\n\"out-broadcast-pkts\": \"2\",\n\"out-discards\": \"0\",\n\"out-errors\": \"0\",\n\"out-multicast-pkts\": \"169207\",\n\"out-octets\": \"569979193348\",\n\"out-unicast-pkts\": \"376049116\"\n},\n\"openconfig-interfaces:description\": \"\",\n\"openconfig-interfaces:enabled\": true,\n\"openconfig-platform-port:hardware-port\": \"Port24\",\n\"openconfig-interfaces:ifindex\": 24,\n\"arista-intf-augments:inactive\": false,\n\"openconfig-interfaces:last-change\": \"1614001155863084032\",\n\"openconfig-interfaces:loopback-mode\": false,\n\"openconfig-interfaces:mtu\": 0,\n\"openconfig-interfaces:name\": \"Ethernet24\",\n\"openconfig-interfaces:oper-status\": \"UP\",\n\"openconfig-vlan:tpid\": \"openconfig-vlan-types:TPID_0X8100\",\n\"openconfig-interfaces:type\": \"iana-if-type:ethernetCsmacd\"\n}\n</code></pre> </p>"},{"location":"examples/gnmi-clients/arista-gnmi/#get-an-interfaces-operational-status","title":"Get an interface's operational status","text":"<pre><code>gnmi -addr 192.0.2.139:6030 -username cvpadmin -password arista \\\nget 'interfaces/interface[name=Ethernet24]/state/oper-status'\n</code></pre> <p>Output:</p> <pre><code>/interfaces/interface[name=Ethernet24]/state/oper-status: UP\n</code></pre>"},{"location":"examples/gnmi-clients/arista-gnmi/#get-an-interfaces-admin-status","title":"Get an interface's admin status","text":"<pre><code>gnmi -addr 192.0.2.139:6030 -username cvpadmin -password arista \\\nget 'interfaces/interface[name=Ethernet24]/state/admin-status'`\n</code></pre> <p>Output:</p> <pre><code>/interfaces/interface[name=Ethernet24]/state/admin-status: UP\n</code></pre>"},{"location":"examples/gnmi-clients/arista-gnmi/#get-the-dom-metrics-of-all-interfaces","title":"Get the DOM metrics of all interfaces","text":"<pre><code>gnmi -addr 192.0.2.139:6030 -username cvpadmin -password arista \\\nget \"components/component/transceiver/physical-channels/channel/state/\"\n</code></pre>"},{"location":"examples/gnmi-clients/arista-gnmi/#get-the-dom-metrics-of-an-interface","title":"Get the DOM metrics of an interface","text":"<pre><code>gnmi -addr 192.0.2.139:6030 -username cvpadmin -password arista \\\nget \"components/component[name=Ethernet24  transceiver]/transceiver/physical-channels/channel/state/\"\n</code></pre>  Reveal output <p> <pre><code>/components/component[name=Ethernet24 transceiver]/transceiver/physical-channels/channel[index=0]/state:\n{\n\"openconfig-platform-transceiver:index\": 0,\n\"openconfig-platform-transceiver:input-power\": {\n\"instant\": \"-0.26\"\n},\n\"openconfig-platform-transceiver:laser-bias-current\": {\n\"instant\": \"7.49\"\n},\n\"openconfig-platform-transceiver:output-power\": {\n\"instant\": \"0.32\"\n}\n}\n</code></pre> </p>"},{"location":"examples/gnmi-clients/arista-gnmi/#get-per-core-cpu-utilization","title":"Get per core CPU utilization","text":"<pre><code>gnmi -addr 192.0.2.139:6030 -username cvpadmin -password arista \\\nget 'components/component/cpu'\n</code></pre> Reveal output <p> <pre><code>/components/component[name=CPU3]/cpu:\n{\n\"openconfig-platform-cpu:utilization\": {\n\"state\": {\n\"avg\": 18,\n\"instant\": 16,\n\"interval\": \"1000000000000\",\n\"max\": 28,\n\"max-time\": \"3230106984172745216\",\n\"min\": 13,\n\"min-time\": \"3230106514174602752\"\n}\n}\n}\n/components/component[name=CPU0]/cpu:\n{\n\"openconfig-platform-cpu:utilization\": {\n\"state\": {\n\"avg\": 17,\n\"instant\": 16,\n\"interval\": \"1000000000000\",\n\"max\": 25,\n\"max-time\": \"3230106564173730816\",\n\"min\": 12,\n\"min-time\": \"3230106394175068672\"\n}\n}\n}\n/components/component[name=CPU1]/cpu:\n{\n\"openconfig-platform-cpu:utilization\": {\n\"state\": {\n\"avg\": 18,\n\"instant\": 17,\n\"interval\": \"1000000000000\",\n\"max\": 27,\n\"max-time\": \"3230107464174793728\",\n\"min\": 13,\n\"min-time\": \"3230107334172570624\"\n}\n}\n}\n/components/component[name=CPU2]/cpu:\n{\n\"openconfig-platform-cpu:utilization\": {\n\"state\": {\n\"avg\": 17,\n\"instant\": 21,\n\"interval\": \"1000000000000\",\n\"max\": 24,\n\"max-time\": \"3230106924173756928\",\n\"min\": 11,\n\"min-time\": \"3230107394173572608\"\n}\n}\n}\n</code></pre> </p>"},{"location":"examples/gnmi-clients/arista-gnmi/#get-the-availableutilized-memory","title":"Get the available/utilized memory","text":"<pre><code>gnmi -addr 192.0.2.139:6030 -username cvpadmin -password arista \\\nget 'components/component/state/memory/'\n</code></pre> <p>Output:</p> <pre><code>/components/component[name=Chassis]/state/memory:\n{\n  \"openconfig-platform:available\": \"8298774528\",\n  \"openconfig-platform:utilized\": \"7706267648\"\n}\n</code></pre>"},{"location":"examples/gnmi-clients/arista-gnmi/#get-the-system-environment-temperatures","title":"Get the system environment temperatures","text":"<pre><code>gnmi -addr 192.0.2.139:6030 -username cvpadmin -password arista \\\nget 'components/component/state/temperature/instant'\n</code></pre> Reveal output <p> <pre><code>/components/component[name=DomTemperatureSensor49]/state/temperature/instant: 30.49609375\n/components/component[name=DomTemperatureSensor25]/state/temperature/instant: 24.69921875\n/components/component[name=DomTemperatureSensor40]/state/temperature/instant: 25.5078125\n/components/component[name=TempSensorP2/2]/state/temperature/instant: 0.0\n/components/component[name=TempSensorP1/3]/state/temperature/instant: 40.0\n/components/component[name=TempSensorP2/1]/state/temperature/instant: 0.0\n/components/component[name=TempSensorP2/3]/state/temperature/instant: 0.0\n/components/component[name=DomTemperatureSensor24]/state/temperature/instant: 24.5\n/components/component[name=DomTemperatureSensor26]/state/temperature/instant: 23.73046875\n/components/component[name=DomTemperatureSensor54]/state/temperature/instant: 27.26953125\n/components/component[name=TempSensorP1/1]/state/temperature/instant: 34.0\n/components/component[name=DomTemperatureSensor50]/state/temperature/instant: 27.453125\n/components/component[name=TempSensorP1/2]/state/temperature/instant: 25.0\n/components/component[name=TempSensor1]/state/temperature/instant: 45.84278576588521\n/components/component[name=TempSensor15]/state/temperature/instant: 33.875\n/components/component[name=TempSensor18]/state/temperature/instant: 44.625\n/components/component[name=TempSensor16]/state/temperature/instant: 22.75\n/components/component[name=TempSensor17]/state/temperature/instant: 37.0\n/components/component[name=TempSensor14]/state/temperature/instant: 37.0\n</code></pre> </p>"},{"location":"examples/gnmi-clients/arista-gnmi/#eos-native-paths","title":"EOS Native paths","text":"<p>To get EOS native paths, OCTA has to be enabled as mentioned in the configuration section. Performing GET/SUBSCRIBE actions using EOS native paths require changing the origin to <code>eos_native</code>.</p>"},{"location":"examples/gnmi-clients/arista-gnmi/#commonly-used-paths","title":"Commonly used paths","text":"<ul> <li>MAC table: <code>/Smash/bridging/status/smashFdbStatus</code></li> <li>ARP table: <code>/Smash/arp/status/arpEntry</code></li> <li>Neighbor table: <code>/Smash/arp/status/neighborEntry</code></li> <li>IPv4 RIB: <code>/Smash/routing/status/route</code></li> <li>IPv6 RIB: <code>/Smash/routing6/status/route</code></li> <li>IPv4 next-hop table: <code>/Smash/routing/status/nexthop</code></li> <li>IPv6 next-hop table: <code>/Smash/routing6/status/nexthop</code></li> <li>CPU info: <code>/Kernel/proc/cpu</code></li> <li>Process statistics: <code>/Kernel/proc/stat</code></li> <li>System info: <code>/Kernel/sysinfo</code></li> <li>EOS version: <code>/Eos/image</code></li> <li>Interface counters: <code>/Smash/counters/ethIntf/&lt;agent&gt;/current/counter</code></li> <li>Values for <code>&lt;agent&gt;</code> are:<ul> <li>7500-family, 7280-family, 7020-family (Arad/Jericho ASICs): <code>SandCounters</code></li> <li>7300-family, 7250-family, 7050-family, 7010 products, 720-family (Trident   ASICs): <code>StrataCounters</code></li> <li>For 7060-family, 7260-family (Tomahawk): <code>Strata-FixedSystem</code> or   <code>StrataCounters</code> from 4.22+</li> <li>7150-family products (Alta ASICs): <code>FocalPointV2</code></li> <li>7160-family products (Cavium/Xpliant ASICs): <code>XpCounters</code></li> <li>7170-family products (Barefoot ASIC): <code>BfnCounters</code></li> </ul> </li> </ul>"},{"location":"examples/gnmi-clients/arista-gnmi/#get-cpu-utilization","title":"Get CPU utilization","text":"<pre><code>gnmi -addr 192.0.2.130:6030 -username admin \\\nget origin=eos_native '/Kernel/proc/cpu/utilization/total'\n</code></pre> <p>Output:</p> <pre><code>/Kernel/proc/cpu/utilization/total/nice:\n38446\n/Kernel/proc/cpu/utilization/total/system:\n2347714\n/Kernel/proc/cpu/utilization/total/idle:\n247720286\n/Kernel/proc/cpu/utilization/total/name:\ntotal\n/Kernel/proc/cpu/utilization/total/util:\n7\n/Kernel/proc/cpu/utilization/total/user:\n16984784\n</code></pre>"},{"location":"examples/gnmi-clients/arista-gnmi/#get-transceiver-dom-temperature","title":"Get transceiver DOM temperature","text":"<pre><code>gnmi -addr 192.0.2.130:6030 -username admin  get origin=eos_native \\\n'Sysdb/environment/archer/temperature/status/system/DomTemperatureSensor32'`\n</code></pre> Reveal output <p> <pre><code>/Sysdb/environment/archer/temperature/status/system/DomTemperatureSensor32/temperature:\n{\n  \"value\": 32.5\n}\n/Sysdb/environment/archer/temperature/status/system/DomTemperatureSensor32/maxTemperature:\n{\n  \"value\": 34.88671875\n}\n/Sysdb/environment/archer/temperature/status/system/DomTemperatureSensor32/maxTemperatureTime: 1564757444.339129\n/Sysdb/environment/archer/temperature/status/system/DomTemperatureSensor32/name: DomTemperatureSensor32\n/Sysdb/environment/archer/temperature/status/system/DomTemperatureSensor32/generationId: 0\n/Sysdb/environment/archer/temperature/status/system/DomTemperatureSensor32/hwStatus: ok\n/Sysdb/environment/archer/temperature/status/system/DomTemperatureSensor32/alertRaised: false\n/Sysdb/environment/archer/temperature/status/system/DomTemperatureSensor32/alertRaisedCount: 0\n/Sysdb/environment/archer/temperature/status/system/DomTemperatureSensor32/lastAlertRaisedTime: 1564194739.259879\n</code></pre> </p>"},{"location":"examples/gnmi-clients/arista-gnmi/#get-connectivity-monitor-host-stats","title":"Get connectivity monitor host stats","text":"<pre><code>gnmi -addr 192.0.2.139:6030 -username admin get origin=eos_native '/Sysdb/connectivityMonitor/status/hostStatus/'\n</code></pre>  Reveal output <p> <pre><code>/Sysdb/connectivityMonitor/status/hostStatus/wls100_default/key/hostName: wls100\n/Sysdb/connectivityMonitor/status/hostStatus/wls100_default/key/vrfName:\n{\n  \"value\": \"default\"\n}\n/Sysdb/connectivityMonitor/status/hostStatus/wls100_default/name: wls100_default\n/Sysdb/connectivityMonitor/status/hostStatus/wls100_default/defaultStats/packetLoss: 0\n/Sysdb/connectivityMonitor/status/hostStatus/wls100_default/defaultStats/httpResponseTime: 0\n/Sysdb/connectivityMonitor/status/hostStatus/wls100_default/defaultStats/interfaceName:\n/Sysdb/connectivityMonitor/status/hostStatus/wls100_default/defaultStats/jitter: 0\n/Sysdb/connectivityMonitor/status/hostStatus/wls100_default/defaultStats/latency: 0\n/Sysdb/connectivityMonitor/status/hostStatus/wls100_default/ipAddr: \"192.0.2.140\"\n/Sysdb/connectivityMonitor/status/hostStatus/ats323_management/key/hostName: ats323\n/Sysdb/connectivityMonitor/status/hostStatus/ats323_management/key/vrfName:\n{\n  \"value\": \"management\"\n}\n/Sysdb/connectivityMonitor/status/hostStatus/ats323_management/name: ats323_management\n/Sysdb/connectivityMonitor/status/hostStatus/ats323_management/ipAddr: \"192.0.2.138\"\n/Sysdb/connectivityMonitor/status/hostStatus/ats323_management/defaultStats/latency: 0.127\n/Sysdb/connectivityMonitor/status/hostStatus/ats323_management/defaultStats/jitter: 0.033\n/Sysdb/connectivityMonitor/status/hostStatus/ats323_management/defaultStats/packetLoss: 0\n/Sysdb/connectivityMonitor/status/hostStatus/ats323_management/defaultStats/httpResponseTime: 21.860306\n/Sysdb/connectivityMonitor/status/hostStatus/ats323_management/defaultStats/interfaceName:\n</code></pre> </p>"},{"location":"examples/gnmi-clients/arista-gnmi/#gnmi-set-rpc-examples","title":"gNMI SET RPC Examples","text":""},{"location":"examples/gnmi-clients/arista-gnmi/#openconfig-paths_1","title":"OpenConfig paths","text":""},{"location":"examples/gnmi-clients/arista-gnmi/#configure-bgp-neighbor","title":"Configure BGP neighbor","text":""},{"location":"examples/gnmi-clients/arista-gnmi/#configure-neighbor-address-and-peer-as","title":"Configure neighbor address and peer AS","text":"<pre><code>gnmi -addr 192.0.2.139:6030 -username cvpadmin -password arista \\\nupdate '/network-instances/network-instance[name=default]/protocols/protocol[name=BGP][identifier=BGP]/bgp/neighbors/neighbor[neighbor-address=198.51.100.43]' \\\n'{\"config\": {\"neighbor-address\":\"198.51.100.43\", \"peer-as\": 123}}'\n</code></pre>"},{"location":"examples/gnmi-clients/arista-gnmi/#configure-neighbor-address-peer-as-and-send-community","title":"Configure neighbor address, peer AS and send-community","text":"<pre><code>gnmi -addr 192.0.2.203:6030 -username arista -password arista\n  update '/network-instances/network-instance[name=default]/protocols/protocol[name=BGP][identifier=BGP]/bgp/neighbors/neighbor[neighbor-address=198.51.100.43]' \\\n{\"config\": {\"neighbor-address\":\"198.51.100.43\", \"peer-as\": 123, \"enabled\": true, \"send-community\": \"EXTENDED\"}}'\n</code></pre>"},{"location":"examples/gnmi-clients/arista-gnmi/#create-peer-group","title":"Create peer group","text":"<pre><code>gnmi -addr 192.0.2.203 -username arista -password arista update \\\n'/network-instances/network-instance[name=default]/protocols/protocol[name=BGP][identifier=BGP]/bgp/peer-groups/peer-group[peer-group-name=XYZ]' \\\n'{\"config\": {\"peer-group-name\":\"XYZ\", \"local-as\": 114}}'\n</code></pre>"},{"location":"examples/gnmi-clients/arista-gnmi/#update-the-peer-as","title":"Update the peer AS","text":"<pre><code>gnmi -addr 192.0.2.203:6030 -username arista -password arista \\\nupdate '/network-instances/network-instance[name=default]/protocols/protocol[name=BGP][identifier=BGP]/bgp/neighbors/neighbor[neighbor-address=198.51.100.0]/config/peer-as' \\\n'110'\n</code></pre> <pre><code>gnmi -addr 192.0.2.203:6030 -username arista -password arista \\\nupdate '/network-instances/network-instance[name=default]/protocols/protocol[name=BGP][identifier=BGP]/bgp/neighbors/neighbor[neighbor-address=198.51.100.0]' \\\n'{\"config\": {\"peer-as\": 110}}'\n</code></pre>"},{"location":"examples/gnmi-clients/arista-gnmi/#update-the-peer-group","title":"Update the peer group","text":"<pre><code>gnmi -addr 192.0.2.203:6030 -username arista -password arista \\\nupdate '/network-instances/network-instance[name=default]/protocols/protocol[name=BGP][identifier=BGP]/bgp/neighbors/neighbor[neighbor-address=198.51.100.43]/config/peer-group' \\\n'XYZ'\n</code></pre> <pre><code>gnmi -addr 192.0.2.203:6030 -username arista -password arista \\\nupdate '/network-instances/network-instance[name=default]/protocols/protocol[name=BGP][identifier=BGP]/bgp/neighbors/neighbor[neighbor-address=198.51.100.0]' \\\n'{\"config\": {\"peer-group\": \"XYZ\",\"peer-as\": 143}}'\n</code></pre>"},{"location":"examples/gnmi-clients/arista-gnmi/#update-bgp-config-using-json-file","title":"Update BGP config using json file","text":"<pre><code>gnmi -addr 192.0.2.203:6030 -username arista -password arista \\\nupdate '/network-instances/network-instance[name=default]/protocols/protocol[name=BGP][identifier=BGP]/bgp' bgp.json\n</code></pre> <pre><code>cat bgp.json\n</code></pre>  Reveal output <p> <pre><code>{\n\"neighbors\": {\n\"neighbor\": [\n{\n\"config\": {\n\"enabled\": true,\n\"neighbor-address\": \"10.10.10.154\",\n\"peer-group\": \"XYZ\"\n},\n\"neighbor-address\": \"10.10.10.154\"\n},\n{\n\"config\": {\n\"enabled\": true,\n\"neighbor-address\": \"10.10.10.157\",\n\"peer-group\": \"XYZ\"\n},\n\"neighbor-address\": \"10.10.10.157\"\n}\n]\n},\n\"peer-groups\": {\n\"peer-group\": [\n{\n\"config\": {\n\"peer-as\": 65002,\n\"peer-group-name\": \"ABC\"\n},\n\"peer-group-name\": \"ABC\"\n}\n]\n}\n}\n</code></pre> </p>"},{"location":"examples/gnmi-clients/arista-gnmi/#create-an-acl","title":"Create an ACL","text":"<pre><code>gnmi -addr 192.0.2.203:6030 -username admin -password arista \\\nupdate /acl/acl-sets acl2.json\n</code></pre> <pre><code>cat acl2.json\n</code></pre> Reveal output <p> <pre><code>{\n\"acl-set\": [\n{\n\"config\": {\n\"name\": \"test\",\n\"type\": \"ACL_IPV4\"\n},\n\"name\": \"test\",\n\"type\": \"ACL_IPV4\",\n\"acl-entries\": {\n\"acl-entry\": [\n{\n\"sequence-id\": 10,\n\"actions\": {\n\"config\": {\n\"forwarding-action\": \"DROP\"\n}\n},\n\"config\": {\n\"sequence-id\": 10\n},\n\"ipv4\": {\n\"config\": {\n\"destination-address\": \"192.0.2.1/32\",\n\"source-address\": \"0.0.0.0/0\"\n}\n}\n}\n]\n}\n}\n]\n}\n</code></pre> </p> <p>This creates</p> <pre><code>ip access-list test\n   10 deny ip any 1.0.0.0/12\n</code></pre>"},{"location":"examples/gnmi-clients/arista-gnmi/#shutdown-an-interface","title":"Shutdown an interface","text":"<pre><code>gnmi -addr 192.0.2.139:6030 -username arista -password arista  \\\nupdate '/interfaces/interface[name=Ethernet1]/config/enabled' \\\n'false'\n</code></pre>"},{"location":"examples/gnmi-clients/arista-gnmi/#bring-up-an-interface","title":"Bring up an interface","text":"<pre><code>gnmi -addr 192.0.2.139:6030 -username arista -password arista  \\\nupdate '/interfaces/interface[name=Ethernet1]/config/enabled' \\\n'true'\n</code></pre>"},{"location":"examples/gnmi-clients/arista-gnmi/#gnmi-subscribe-rpc-examples","title":"gNMI SUBSCRIBE RPC Examples","text":""},{"location":"examples/gnmi-clients/arista-gnmi/#openconfig-paths_2","title":"OpenConfig paths","text":""},{"location":"examples/gnmi-clients/arista-gnmi/#subscribe-to-all-bgp-neighbor-states","title":"Subscribe to all BGP neighbor states","text":"<pre><code>gnmi -addr 192.0.2.203 -username arista -password arista \\\nsubscribe '/network-instances/network-instance/protocols/protocol/bgp/neighbors/neighbor/state'\n</code></pre>"},{"location":"examples/gnmi-clients/arista-gnmi/#subscribe-to-specific-bgp-neighbor-state","title":"Subscribe to specific BGP neighbor state","text":"<pre><code>gnmi -addr 192.0.2.203 -username arista -password arista \\\nsubscribe '/network-instances/network-instance/protocols/protocol/bgp/neighbors/neighbor[neighbor-address=198.51.100.5]/state'\n</code></pre>"},{"location":"examples/gnmi-clients/arista-gnmi/#subscribe-with-stream-mode-sample-and-interval","title":"Subscribe with stream mode sample and interval","text":"<pre><code>gnmi -addr 192.0.2.214:6030 -username admin -password arista \\\n-sample_interval 5s -stream_mode sample                     \\\nsubscribe                                                   \\\n'/network-instances/network-instance[name=Tenant_A_WEB_Zone]/protocols/protocol[identifier=BGP][name=BGP]/bgp/neighbors/neighbor[neighbor-address=198.51.100.1]/afi-safis/afi-safi[afi-safi-name=openconfig-bgp-types:IPV4_UNICAST]/state/prefixes/received'\n</code></pre>"},{"location":"examples/gnmi-clients/arista-gnmi/#cli-origin","title":"CLI origin","text":""},{"location":"examples/gnmi-clients/arista-gnmi/#changing-the-maximum-routes-for-a-bgp-neighbor","title":"Changing the maximum-routes for a BGP neighbor","text":"<pre><code>gnmi -addr 192.0.2.214:6030 -username arista -password arista \\\nupdate origin=cli \"\" \"router bgp 65101\n    neighbor IPv4-UNDERLAY-PEERS maximum-routes 12500\"\n</code></pre> <p>NOTE the <code>neighbor</code> command has to be on a new line, so the previous line should not end in <code>\\</code>.</p>"},{"location":"examples/gnmi-clients/arista-gnmi/#show-version","title":"show version","text":"<pre><code>gnmi -addr 192.0.2.214:6030 -username cvpadmin -password arista \\\nget  origin=cli \"show version\"\n</code></pre>  Reveal output <p> <pre><code>/show version:\n{\n\"architecture\": \"i686\",\n\"bootupTimestamp\": 1626291561.0,\n\"configMacAddress\": \"00:00:00:00:00:00\",\n\"hardwareRevision\": \"\",\n\"hwMacAddress\": \"00:00:00:00:00:00\",\n\"imageFormatVersion\": \"1.0\",\n\"internalBuildId\": \"ed275a6c-1771-482d-829b-125e9c6ba677\",\n\"internalVersion\": \"4.26.2F-23035564.riorel\",\n\"isIntlVersion\": false,\n\"memFree\": 2422124,\n\"memTotal\": 4002356,\n\"mfgName\": \"Arista\",\n\"modelName\": \"vEOS-lab\",\n\"serialNumber\": \"BAD032986065E8DC14CBB6472EC314A6\",\n\"systemMacAddress\": \"50:08:00:a7:ca:c3\",\n\"uptime\": 1814877.63,\n\"version\": \"4.26.2F-23035564.riorel (engineering build)\"\n}\n</code></pre> </p>"},{"location":"examples/gnmi-clients/arista-gnmi/#running-unconverted-show-commands-that-use-text-format","title":"Running unconverted show commands that use 'text' format","text":"<p>To run show commands that are not converted to JSON and require <code>format=\"text\"</code> the <code>ASCII</code> encoding can be used from EOS 4.29.2F or newer.</p>"},{"location":"examples/gnmi-clients/arista-gnmi/#show-platform-fap-interrupts","title":"show platform fap interrupts","text":"<pre><code>gnmi -addr 192.0.2.214:6030 -username cvpadmin -password arista get encoding=ascii origin=cli \"show platform fap interrupts\"\n</code></pre>  Reveal output <p> <pre><code>/show platform fap interrupts:\nJericho0\n--------------------------------------------------------------------------------------------------------------\n| Interrupt Bit                                                         | Count | First Occurrence    | Last Occurrence     |\n--------------------------------------------------------------------------------------------------------------\n| NBIH_LINK_STATUS_CHANGE_LinkStatusChangeInterruptRegister_12[0]       |    55 | 2023-10-05 00:02:22 | 2023-10-20 10:29:21 |\n| NBIH_LINK_STATUS_CHANGE_LinkStatusChangeInterruptRegister_13[0]       |    39 | 2023-10-05 00:02:21 | 2023-10-16 19:00:15 |\n| NBIH_LINK_STATUS_CHANGE_LinkStatusChangeInterruptRegister_14[0]       |    39 | 2023-10-05 00:02:23 | 2023-10-16 19:00:15 |\n| NBIH_LINK_STATUS_CHANGE_LinkStatusChangeInterruptRegister_15[0]       |    39 | 2023-10-05 00:02:22 | 2023-10-16 19:00:15 |\n| NBIH_LINK_STATUS_CHANGE_LinkStatusChangeInterruptRegister_20[0]       |    67 | 2023-10-05 00:02:26 | 2023-10-24 00:44:24 |\n| NBIH_LINK_STATUS_CHANGE_LinkStatusChangeInterruptRegister_21[0]       |    56 | 2023-10-05 00:02:25 | 2023-10-24 00:44:24 |\n| NBIH_LINK_STATUS_CHANGE_LinkStatusChangeInterruptRegister_22[0]       |    53 | 2023-10-05 00:02:25 | 2023-10-24 00:45:15 |\n| NBIH_LINK_STATUS_CHANGE_LinkStatusChangeInterruptRegister_23[0]       |    55 | 2023-10-05 00:02:24 | 2023-10-24 00:45:15 |\n| IPS_QueueEnteredDel[1]                                                |     6 | 2023-10-11 14:00:20 | 2023-10-11 14:12:02 |\n| EPNI_PP_NewDaErr[0]                                                   | 255206 | 2023-10-05 15:06:43 | 2023-10-25 21:42:04 |\n| EPNI_PP_VsiMembershipDeny[1]                                          |     2 | 2023-10-11 02:27:16 | 2023-10-11 14:11:46 |\n| EPNI_PP_EesLastActionNotAc[0]                                         | 255206 | 2023-10-05 15:06:43 | 2023-10-25 21:42:04 |\n| EPNI_PP_EesLastActionNotAc[1]                                         | 47299 | 2023-10-05 13:33:12 | 2023-10-23 16:16:04 |\n| FMAC_FMAC_2_RxLostOfSync_0[32]                                        | 883547 | 2023-10-05 00:02:34 | 2023-10-25 21:42:08 |\n&lt;ommitted&gt;\n}\n</code></pre> </p>"},{"location":"examples/gnmi-clients/gnmic/","title":"gNMIC examples","text":""},{"location":"examples/gnmi-clients/gnmic/#overview","title":"overview","text":"<p>The following examples are used to find openconfig paths within Arista EOS using the gNMIC binary. There will be some commands which will specify one liners which will have the address of the gNMI target and some commands which will use the <code>.gnmic.yaml</code> file which will have the target information inside declared. All outputs will be redirected to the outputs file with the .json extension so they are easier to view within a text editor.</p>"},{"location":"examples/gnmi-clients/gnmic/#download-install-gnmic","title":"Download &amp;&amp; install gnmic","text":"<p>To install run:</p> <pre><code>bash -c \"$(curl -sL https://get-gnmic.openconfig.net)\"\n</code></pre> <p>To get the version run:</p> <pre><code>gnmi_stuff$ gnmic version\n</code></pre> <p>Output:</p> <pre><code>version : 0.27.0\n commit : cc5759c\n   date : 2022-10-10T06:40:26Z\n gitURL : https://github.com/openconfig/gnmic\n   docs : https://gnmic.openconfig.net\n</code></pre>"},{"location":"examples/gnmi-clients/gnmic/#device-config","title":"Device config","text":"<pre><code>management api gnmi\n   transport grpc default\n       no shutdown\n   provider eos-native\n\nceos3#                show management api gnmi\nOcta:               enabled\nEnabled:            Yes\nServer:             running on port 6030\nSSL Profile:        none\nQoS DSCP:           none\nAuthorization Required:No\n</code></pre> <pre><code>gnmic -a 192.0.2.1:6030 -u admin -p admin --insecure capabilities  \\\n&gt;&gt; outputs/capabilities.json\n</code></pre>"},{"location":"examples/gnmi-clients/gnmic/#gnmi-get-rpc-examples","title":"gNMI GET RPC Examples","text":""},{"location":"examples/gnmi-clients/gnmic/#openconfig-paths","title":"OpenConfig paths","text":""},{"location":"examples/gnmi-clients/gnmic/#get-all-information","title":"Get all information","text":"<pre><code>gnmic -a 192.0.2.214:6030 -u cvpadmin -p arista --insecure --gzip get --path \"/\"\n</code></pre>"},{"location":"examples/gnmi-clients/gnmic/#get-the-bgp-configuration-in-the-default-vrf","title":"Get the BGP configuration in the default VRF","text":"<pre><code>gnmic -a 192.0.2.214:6030 -u cvpadmin -p arista --insecure --gzip get --path  \\\n'/network-instances/network-instance[name=default]/protocols/protocol[identifier=BGP][name=BGP]/bgp'\n</code></pre>"},{"location":"examples/gnmi-clients/gnmic/#get-bgp-neighbors","title":"Get BGP neighbors","text":"<pre><code>gnmic -a 192.0.2.139:6030 -u cvpadmin -p arista --insecure get --path  \\\n'/network-instances/network-instance[name=default]/protocols/protocol[name=BGP]/bgp/neighbors'\n</code></pre>"},{"location":"examples/gnmi-clients/gnmic/#get-all-interface-descriptions","title":"Get all interface descriptions","text":"<pre><code>gnmic -a 192.0.2.214:6030 -u cvpadmin -p arista --insecure --gzip get --path  \\\n'/interfaces/interface/subinterfaces/subinterface/state/description'\n</code></pre>"},{"location":"examples/gnmi-clients/gnmic/#get-an-interfaces-description","title":"Get an interface's description","text":"<pre><code>gnmic -a 192.0.2.214:6030 -u cvpadmin -p arista --insecure --gzip get --path  \\\n'interfaces/interface[name=Ethernet1]/subinterfaces/subinterface/state/description'\n</code></pre> <pre><code>[\n{\n\"timestamp\": 1626293671204274106,\n\"time\": \"2021-07-14T21:14:31.204274106+01:00\",\n\"updates\": [\n{\n\"Path\": \"interfaces/interface[name=Ethernet1]/subinterfaces/subinterface[index=0]/state/description\",\n\"values\": {\n\"interfaces/interface/subinterfaces/subinterface/state/description\": \"To-SPINE1\"\n}\n}\n]\n}\n]\n</code></pre>"},{"location":"examples/gnmi-clients/gnmic/#get-the-operational-status-of-all-interfaces","title":"Get the operational status of all interfaces","text":"<pre><code>gnmic -a 192.0.2.214:6030 -u cvpadmin -p arista --insecure --gzip get --path  \\\n'interfaces/interface/state/oper-status'\n</code></pre>  Reveal output <p> <pre><code>[\n{\n\"timestamp\": 1626293641102904713,\n\"time\": \"2021-07-14T21:14:01.102904713+01:00\",\n\"updates\": [\n{\n\"Path\": \"interfaces/interface[name=Management1]/state/oper-status\",\n\"values\": {\n\"interfaces/interface/state/oper-status\": \"UP\"\n}\n},\n{\n\"Path\": \"interfaces/interface[name=Ethernet1]/state/oper-status\",\n\"values\": {\n\"interfaces/interface/state/oper-status\": \"UP\"\n}\n},\n{\n\"Path\": \"interfaces/interface[name=Ethernet5]/state/oper-status\",\n\"values\": {\n\"interfaces/interface/state/oper-status\": \"UP\"\n}\n},\n{\n\"Path\": \"interfaces/interface[name=Ethernet4]/state/oper-status\",\n\"values\": {\n\"interfaces/interface/state/oper-status\": \"UP\"\n}\n},\n{\n\"Path\": \"interfaces/interface[name=Ethernet3]/state/oper-status\",\n\"values\": {\n\"interfaces/interface/state/oper-status\": \"UP\"\n}\n},\n{\n\"Path\": \"interfaces/interface[name=Ethernet2]/state/oper-status\",\n\"values\": {\n\"interfaces/interface/state/oper-status\": \"UP\"\n}\n},\n{\n\"Path\": \"interfaces/interface[name=Port-Channel4]/state/oper-status\",\n\"values\": {\n\"interfaces/interface/state/oper-status\": \"UP\"\n}\n},\n{\n\"Path\": \"interfaces/interface[name=Port-Channel3]/state/oper-status\",\n\"values\": {\n\"interfaces/interface/state/oper-status\": \"UP\"\n}\n}\n]\n}\n]\n</code></pre> </p>"},{"location":"examples/gnmi-clients/gnmic/#get-all-states-of-an-interface","title":"Get all states of an interface","text":"<pre><code>gnmic -a 192.0.2.214:6030 -u cvpadmin -p arista --insecure --gzip get --path  \\\n'interfaces/interface[name=Ethernet1]/state/'\n</code></pre>  Reveal output <p> <pre><code>[[\n{\n\"timestamp\": 1626293429376469348,\n\"time\": \"2021-07-14T21:10:29.376469348+01:00\",\n\"updates\": [\n{\n\"Path\": \"interfaces/interface[name=Ethernet1]/state\",\n\"values\": {\n\"interfaces/interface/state\": {\n\"arista-intf-augments:inactive\": false,\n\"openconfig-interfaces:admin-status\": \"UP\",\n\"openconfig-interfaces:counters\": {\n\"in-broadcast-pkts\": \"0\",\n\"in-discards\": \"0\",\n\"in-errors\": \"0\",\n\"in-fcs-errors\": \"0\",\n\"in-multicast-pkts\": \"48\",\n\"in-octets\": \"111398\",\n\"in-unicast-pkts\": \"1460\",\n\"out-broadcast-pkts\": \"1\",\n\"out-discards\": \"0\",\n\"out-errors\": \"0\",\n\"out-multicast-pkts\": \"49\",\n\"out-octets\": \"117389\",\n\"out-unicast-pkts\": \"1457\"\n},\n\"openconfig-interfaces:description\": \"To-SPINE1\",\n\"openconfig-interfaces:ifindex\": 1,\n\"openconfig-interfaces:last-change\": \"1626292006733589760\",\n\"openconfig-interfaces:mtu\": 0,\n\"openconfig-interfaces:name\": \"Ethernet1\",\n\"openconfig-interfaces:oper-status\": \"UP\",\n\"openconfig-interfaces:type\": \"iana-if-type:ethernetCsmacd\",\n\"openconfig-platform-port:hardware-port\": \"Port1\"\n}\n}\n}\n]\n}\n]\n</code></pre> </p>"},{"location":"examples/gnmi-clients/gnmic/#get-an-interfaces-operational-status","title":"Get an interface's operational status","text":"<pre><code>gnmic -a 192.0.2.214:6030 -u cvpadmin -p arista --insecure --gzip get --path  \\\n'interfaces/interface[name=Ethernet24]/state/oper-status'\n</code></pre> <pre><code>[\n  {\n    \"timestamp\": 1626293414057239130,\n    \"time\": \"2021-07-14T21:10:14.05723913+01:00\",\n    \"updates\": [\n      {\n        \"Path\": \"interfaces/interface[name=Ethernet2]/state/oper-status\",\n        \"values\": {\n          \"interfaces/interface/state/oper-status\": \"UP\"\n        }\n      }\n    ]\n  }\n]\n</code></pre>"},{"location":"examples/gnmi-clients/gnmic/#get-an-interfaces-admin-status","title":"Get an interface's admin status","text":"<pre><code>gnmic -a 192.0.2.214:6030 -u cvpadmin -p arista --insecure --gzip get --path  \\\n'interfaces/interface[name=Ethernet1]/state/admin-status'\n</code></pre> <pre><code>[\n  {\n    \"timestamp\": 1626293085257457373,\n    \"time\": \"2021-07-14T21:04:45.257457373+01:00\",\n    \"updates\": [\n      {\n        \"Path\": \"interfaces/interface[name=Ethernet1]/state/admin-status\",\n        \"values\": {\n          \"interfaces/interface/state/admin-status\": \"UP\"\n        }\n      }\n    ]\n  }\n]\n</code></pre>"},{"location":"examples/gnmi-clients/gnmic/#get-the-dom-metrics-of-all-interfaces","title":"Get the DOM metrics of all interfaces","text":"<pre><code>gnmic -a 192.0.2.214:6030 -u cvpadmin -p arista --insecure --gzip get --path  \\\n\"components/component/transceiver/physical-channels/channel/state/\"\n</code></pre>  Reveal output <p> <pre><code>[\n{\n\"timestamp\": 1626293085257457373,\n\"time\": \"2021-07-14T21:04:45.257457373+01:00\",\n\"updates\": [\n{\n\"Path\": \"components/component[name=Ethernet49 transceiver]/transceiver/physical-channels/channel[index=0]/state\",\n\"values\": {\n\"components/component/transceiver/physical-channels/channel/state\": {\n\"openconfig-platform-transceiver:index\": 0,\n\"openconfig-platform-transceiver:input-power\": {\n\"instant\": \"1.15\"\n},\n\"openconfig-platform-transceiver:laser-bias-current\": {\n\"instant\": \"0.0\"\n},\n\"openconfig-platform-transceiver:output-power\": {}\n}\n}\n},\n{\n\"Path\": \"components/component[name=Ethernet50 transceiver]/transceiver/physical-channels/channel[index=0]/state\",\n\"values\": {\n\"components/component/transceiver/physical-channels/channel/state\": {\n\"openconfig-platform-transceiver:index\": 0,\n\"openconfig-platform-transceiver:input-power\": {\n\"instant\": \"1.11\"\n},\n\"openconfig-platform-transceiver:laser-bias-current\": {\n\"instant\": \"0.0\"\n},\n\"openconfig-platform-transceiver:output-power\": {}\n}\n}\n}\n]\n}\n]\n</code></pre> </p>"},{"location":"examples/gnmi-clients/gnmic/#get-the-dom-metrics-of-an-interface","title":"Get the DOM metrics of an interface","text":"<pre><code>gnmic -a 192.0.2.214:6030 -u cvpadmin -p arista --insecure --gzip get --path  \\\n\"components/component[name=Ethernet49 transceiver]/transceiver/physical-channels/channel/state/\"\n</code></pre>  Reveal output <p> <pre><code>[\n{\n\"time\": \"1970-01-01T01:00:00+01:00\",\n\"updates\": [\n{\n\"Path\": \"components/component[name=Ethernet49 transceiver]/transceiver/physical-channels/channel[index=0]/state\",\n\"values\": {\n\"components/component/transceiver/physical-channels/channel/state\": {\n\"openconfig-platform-transceiver:index\": 0,\n\"openconfig-platform-transceiver:input-power\": {\n\"instant\": \"1.08\"\n},\n\"openconfig-platform-transceiver:laser-bias-current\": {\n\"instant\": \"0.0\"\n},\n\"openconfig-platform-transceiver:output-power\": {}\n}\n}\n}\n]\n}\n]\n</code></pre> </p>"},{"location":"examples/gnmi-clients/gnmic/#get-per-core-cpu-utilization","title":"Get per core CPU utilization","text":"<pre><code>gnmic -a 192.0.2.214:6030 -u cvpadmin -p arista --insecure --gzip get --path  \\\n'components/component/cpu'\n</code></pre>  Reveal output <p> <pre><code>[\n{\n\"timestamp\": 1626294810779644595,\n\"time\": \"2021-07-14T21:33:30.779644595+01:00\",\n\"updates\": [\n{\n\"Path\": \"components/component[name=CPU1]/cpu\",\n\"values\": {\n\"components/component/cpu\": {\n\"openconfig-platform-cpu:utilization\": {\n\"state\": {\n\"avg\": 6,\n\"instant\": 6,\n\"interval\": \"1000000000000\",\n\"max\": 14,\n\"max-time\": \"3252585270429488128\",\n\"min\": 2,\n\"min-time\": \"3252586330424618496\"\n}\n}\n}\n}\n},\n{\n\"Path\": \"components/component[name=CPU0]/cpu\",\n\"values\": {\n\"components/component/cpu\": {\n\"openconfig-platform-cpu:utilization\": {\n\"state\": {\n\"avg\": 5,\n\"instant\": 7,\n\"interval\": \"1000000000000\",\n\"max\": 13,\n\"max-time\": \"3252586170423993344\",\n\"min\": 1,\n\"min-time\": \"3252585340433252352\"\n}\n}\n}\n}\n}\n]\n}\n]\n</code></pre> </p>"},{"location":"examples/gnmi-clients/gnmic/#get-the-availableutilized-memory","title":"Get the available/utilized memory","text":"<pre><code>gnmic -a 192.0.2.214:6030 -u cvpadmin -p arista --insecure --gzip get --path  \\\n'components/component/state/memory/'\n</code></pre> <pre><code>[\n{\n\"timestamp\": 1626294846423115892,\n\"time\": \"2021-07-14T21:34:06.423115892+01:00\",\n\"updates\": [\n{\n\"Path\": \"components/component[name=Chassis]/state/memory\",\n\"values\": {\n\"components/component/state/memory\": {\n\"openconfig-platform:available\": \"4098412544\",\n\"openconfig-platform:utilized\": \"4018016256\"\n}\n}\n}\n]\n}\n]\n</code></pre>"},{"location":"examples/gnmi-clients/gnmic/#get-the-system-environment-temperatures","title":"Get the system environment temperatures","text":"<pre><code>gnmic -a 192.0.2.214:6030 -u cvpadmin -p arista --insecure --gzip get --path  \\\n'components/component/state/temperature/instant'\n</code></pre>  Reveal output <p> <pre><code>[\n{\n\"timestamp\": 1626294876186613578,\n\"time\": \"2021-07-14T21:34:36.186613578+01:00\"\n\"updates\": [\n{\n\"Path\": \"components/component[name=DomTemperatureSensor50]/state/temperature/instant\",\n\"values\": {\n\"components/component/state/temperature/instant\": {\n\"digits\": 2709375,\n\"precision\": 5\n}\n}\n},\n{\n\"Path\": \"components/component[name=DomTemperatureSensor49]/state/temperature/instant\",\n\"values\": {\n\"components/component/state/temperature/instant\": {\n\"digits\": 27140625,\n\"precision\": 6\n}\n}\n},\n{\n\"Path\": \"components/component[name=TempSensor7]/state/temperature/instant\",\n\"values\": {\n\"components/component/state/temperature/instant\": {\n\"digits\": 41168000000000006,\n\"precision\": 15\n}\n}\n},\n{\n\"Path\": \"components/component[name=TempSensor8]/state/temperature/instant\",\n\"values\": {\n\"components/component/state/temperature/instant\": {\n\"digits\": 4225279999999998,\n\"precision\": 14\n}\n}\n},\n{\n\"Path\": \"components/component[name=TempSensor9]/state/temperature/instant\",\n\"values\": {\n\"components/component/state/temperature/instant\": {\n\"digits\": 4062560000000002,\n\"precision\": 14\n}\n}\n},\n{\n\"Path\": \"components/component[name=TempSensor1]/state/temperature/instant\",\n\"values\": {\n\"components/component/state/temperature/instant\": {\n\"digits\": 39141723894742796,\n\"precision\": 15\n}\n}\n},\n{\n\"Path\": \"components/component[name=TempSensor6]/state/temperature/instant\",\n\"values\": {\n\"components/component/state/temperature/instant\": {\n\"digits\": 23875,\n\"precision\": 3\n}\n}\n},\n{\n\"Path\": \"components/component[name=TempSensor3]/state/temperature/instant\",\n\"values\": {\n\"components/component/state/temperature/instant\": {\n\"digits\": 21\n}\n}\n},\n{\n\"Path\": \"components/component[name=TempSensor4]/state/temperature/instant\",\n\"values\": {\n\"components/component/state/temperature/instant\": {\n\"digits\": 1725,\n\"precision\": 2\n}\n}\n},\n{\n\"Path\": \"components/component[name=TempSensor5]/state/temperature/instant\",\n\"values\": {\n\"components/component/state/temperature/instant\": {\n\"digits\": 29\n}\n}\n},\n{\n\"Path\": \"components/component[name=TempSensor2]/state/temperature/instant\",\n\"values\": {\n\"components/component/state/temperature/instant\": {\n\"digits\": 32\n}\n}\n}\n]\n}\n]\n</code></pre> </p>"},{"location":"examples/gnmi-clients/gnmic/#gnmi-subscribe-rpc-examples","title":"gNMI SUBSCRIBE RPC Examples","text":""},{"location":"examples/gnmi-clients/gnmic/#openconfig-paths_1","title":"OpenConfig paths","text":""},{"location":"examples/gnmi-clients/gnmic/#subscribe-to-all-bgp-neighbor-states","title":"Subscribe to all BGP neighbor states","text":"<pre><code>gnmic -a 192.0.2.214:6030 -u cvpadmin -p arista --insecure --gzip subscribe --path  \\\n'/network-instances/network-instance/protocols/protocol/bgp/neighbors/neighbor/state'\n</code></pre>  Reveal output <p> <pre><code>{\n\"source\": \"192.0.2.214:6030\",\n\"subscription-name\": \"default-1626302647\",\n\"timestamp\": 1626292010055258009,\n\"time\": \"2021-07-14T20:46:50.055258009+01:00\",\n\"updates\": [\n{\n\"Path\": \"network-instances/network-instance[name=default]/protocols/protocol[identifier=BGP][name=BGP]/bgp/neighbors/neighbor[neighbor-address=172.18.255.42]/state/messages/sent/UPDATE\",\n\"values\": {\n\"network-instances/network-instance/protocols/protocol/bgp/neighbors/neighbor/state/messages/sent/UPDATE\": 8\n}\n}\n]\n}\n{\n\"source\": \"192.0.2.214:6030\",\n\"subscription-name\": \"default-1626302647\",\n\"timestamp\": 1626292008053994815,\n\"time\": \"2021-07-14T20:46:48.053994815+01:00\",\n\"updates\": [\n{\n\"Path\": \"network-instances/network-instance[name=default]/protocols/protocol[identifier=BGP][name=BGP]/bgp/neighbors/neighbor[neighbor-address=172.18.255.42]/state/established-transitions\",\n\"values\": {\n\"network-instances/network-instance/protocols/protocol/bgp/neighbors/neighbor/state/established-transitions\": 1\n}\n}\n]\n}\n</code></pre> </p>"},{"location":"examples/gnmi-clients/gnmic/#subscribe-to-specific-bgp-neighbor-state","title":"Subscribe to specific BGP neighbor state","text":"<pre><code>gnmic -a 192.0.2.214:6030 -u cvpadmin -p arista --insecure --gzip subscribe --path  \\\n'network-instances/network-instance[name=Tenant_A_WEB_Zone]/protocols/protocol[identifier=BGP][name=BGP]/bgp/neighbors/neighbor[neighbor-address=198.51.100.21]/state'\n</code></pre>  Reveal output <p> <pre><code>{\n\"source\": \"192.0.2.214:6030\",\n\"subscription-name\": \"default-1626303017\",\n\"timestamp\": 1626302991598465536,\n\"time\": \"2021-07-14T23:49:51.598465536+01:00\",\n\"updates\": [\n{\n\"Path\": \"network-instances/network-instance[name=Tenant_A_WEB_Zone]/protocols/protocol[identifier=BGP][name=BGP]/bgp/neighbors/neighbor[neighbor-address=198.51.100.21]/state/last-established\",\n\"values\": {\n\"network-instances/network-instance/protocols/protocol/bgp/neighbors/neighbor/state/last-established\": 1626302991563603200\n}\n}\n]\n}\n</code></pre> </p>"},{"location":"examples/gnmi-clients/gnmic/#subscribe-with-stream-mode-sample-and-interval","title":"Subscribe with stream mode sample and interval","text":"<pre><code>gnmic -a 192.0.2.214:6030 -u cvpadmin -p arista --insecure --gzip --sample-interval 5s --stream-mode sample subscribe --path  \\\n'/network-instances/network-instance[name=Tenant_A_WEB_Zone]/protocols/protocol[identifier=BGP][name=BGP]/bgp/neighbors/neighbor[neighbor-address=198.51.100.21]/afi-safis/afi-safi[afi-safi-name=openconfig-bgp-types:IPV4_UNICAST]/state/prefixes/received'\n</code></pre>  Reveal output <p> <pre><code>{\n\"source\": \"192.0.2.214:6030\",\n\"subscription-name\": \"default-1626303393\",\n\"timestamp\": 1626303158135414182,\n\"time\": \"2021-07-14T23:52:38.135414182+01:00\",\n\"updates\": [\n{\n\"Path\": \"network-instances/network-instance[name=Tenant_A_WEB_Zone]/protocols/protocol[identifier=BGP][name=BGP]/bgp/neighbors/neighbor[neighbor-address=198.51.100.21]/afi-safis/afi-safi[afi-safi-name=IPV4_UNICAST]/state/prefixes/received\",\n\"values\": {\n\"network-instances/network-instance/protocols/protocol/bgp/neighbors/neighbor/afi-safis/afi-safi/state/prefixes/received\": 5\n}\n}\n]\n}\n{\n\"source\": \"192.0.2.214:6030\",\n\"subscription-name\": \"default-1626303393\",\n\"timestamp\": 1626303158135414182,\n\"time\": \"2021-07-14T23:52:38.135414182+01:00\",\n\"updates\": [\n{\n\"Path\": \"network-instances/network-instance[name=Tenant_A_WEB_Zone]/protocols/protocol[identifier=BGP][name=BGP]/bgp/neighbors/neighbor[neighbor-address=198.51.100.21]/afi-safis/afi-safi[afi-safi-name=IPV4_UNICAST]/state/prefixes/received\",\n\"values\": {\n\"network-instances/network-instance/protocols/protocol/bgp/neighbors/neighbor/afi-safis/afi-safi/state/prefixes/received\": 5\n}\n}\n]\n}\n</code></pre> </p>"},{"location":"examples/gnmi-clients/gnmic/#subscribe-to-interface-counters-and-save-them-to-a-file","title":"Subscribe to interface counters and save them to a file","text":"<pre><code>gnmic -a 192.0.2.1:6030 -u admin -p admin --insecure subscribe --path \\\n\"/interfaces/interface/state/counters\"  &gt;&gt; outputs/interface_state.json\n</code></pre>"},{"location":"examples/gnmi-clients/gnmic/#gnmi-set-rpc-examples","title":"gNMI SET RPC Examples","text":""},{"location":"examples/gnmi-clients/gnmic/#openconfig-paths_2","title":"OpenConfig paths","text":""},{"location":"examples/gnmi-clients/gnmic/#configure-bgp-neighbor-address-and-peer-as","title":"Configure BGP neighbor address and peer AS","text":"<pre><code>gnmic -a 192.0.2.214:6030 -u cvpadmin -p arista --insecure --gzip set \\\n--update-path '/network-instances/network-instance[name=default]/protocols/protocol[name=BGP]/bgp/neighbors/neighbor[neighbor-address=198.51.100.43]' \\\n--update-file value.json\n</code></pre> <p>value.json:</p> <pre><code>{\"config\": {\"neighbor-address\":\"198.51.100.43\", \"peer-as\": 123}}\n</code></pre> <p>Output:</p> <pre><code>{\n\"timestamp\": 1626305876151537555,\n\"time\": \"2021-07-15T00:37:56.151537555+01:00\",\n\"results\": [\n{\n\"operation\": \"UPDATE\",\n\"path\": \"network-instances/network-instance[name=default]/protocols/protocol[name=BGP]/bgp/neighbors/neighbor[neighbor-address=198.51.100.43]\"\n}\n]\n}\n</code></pre>"},{"location":"examples/gnmi-clients/gnmic/#configure-bgp-neighbor-address-peer-as-and-send-community","title":"Configure BGP neighbor address, peer AS and send-community","text":"<pre><code>gnmic -a 192.0.2.214:6030 -u cvpadmin -p arista --insecure --gzip set  \\\n--update-path '/network-instances/network-instance[name=default]/protocols/protocol[name=BGP]/bgp/neighbors/neighbor[neighbor-address=198.51.100.43]' \\\n--update-file value.json\n</code></pre> <p>value.json:</p> <pre><code>{\"config\": {\"neighbor-address\":\"198.51.100.43\", \"peer-as\": 123, \"enabled\": true, \"send-community\": \"EXTENDED\"}}\n</code></pre> <p>Output:</p> <pre><code>{\n\"timestamp\": 1626305480401353997,\n\"time\": \"2021-07-15T00:31:20.401353997+01:00\",\n\"results\": [\n{\n\"operation\": \"UPDATE\",\n\"path\": \"network-instances/network-instance[name=default]/protocols/protocol[name=BGP]/bgp/neighbors/neighbor[neighbor-address=198.51.100.43]\"\n}\n]\n}\n</code></pre>"},{"location":"examples/gnmi-clients/gnmic/#create-bgp-peer-group","title":"Create BGP peer group","text":"<pre><code>gnmic -a 192.0.2.214:6030 -u cvpadmin -p arista --insecure --gzip set \\\n--update-path '/network-instances/network-instance[name=default]/protocols/protocol[name=BGP]/bgp/peer-groups/peer-group[peer-group-name=XYZ]' \\\n--update-file value.json\n</code></pre> <p>value.json:</p> <pre><code>{\"config\": {\"peer-group-name\":\"XYZ\", \"local-as\": 114}}\n</code></pre>"},{"location":"examples/gnmi-clients/gnmic/#update-bgp-peer-as","title":"Update BGP peer AS","text":"<pre><code>gnmic -a 192.0.2.214:6030 -u cvpadmin -p arista --insecure --gzip set \\\n--update-path '/network-instances/network-instance[name=default]/protocols/protocol[name=BGP]/bgp/neighbors/neighbor[neighbor-address=198.51.100.43]/config/peer-as' \\\n--update-value '110'\n</code></pre> <p>Output:</p> <pre><code>{\n\"timestamp\": 1626306067189329813,\n\"time\": \"2021-07-15T00:41:07.189329813+01:00\",\n\"results\": [\n{\n\"operation\": \"UPDATE\",\n\"path\": \"network-instances/network-instance[name=default]/protocols/protocol[name=BGP]/bgp/neighbors/neighbor[neighbor-address=198.51.100.43]/config/peer-as\"\n}\n]\n}\n</code></pre>"},{"location":"examples/gnmi-clients/gnmic/#update-bgp-peer-group","title":"Update BGP peer group","text":"<pre><code>gnmic -a 192.0.2.214:6030 -u cvpadmin -p arista --insecure --gzip set \\\n--update-path '/network-instances/network-instance[name=default]/protocols/protocol[name=BGP]/bgp/neighbors/neighbor[neighbor-address=198.51.100.43]/config/peer-group' \\\n--update-value 'XYZ'\n</code></pre> <p>Output:</p> <pre><code>{\n\"timestamp\": 1626306067189329813,\n\"time\": \"2021-07-15T00:41:07.189329813+01:00\",\n\"results\": [\n{\n\"operation\": \"UPDATE\",\n\"path\": \"network-instances/network-instance[name=default]/protocols/protocol[name=BGP]/bgp/neighbors/neighbor[neighbor-address=198.51.100.43]/config/peer-as\"\n}\n]\n}\n</code></pre>"},{"location":"examples/gnmi-clients/gnmic/#create-an-acl","title":"Create an ACL","text":"<pre><code>gnmic -a 192.0.2.108:6030 -u cvpadmin -p arista --insecure --gzip set \\\n--update-path /acl/acl-sets \\\n--update-file acl2.json\n</code></pre> <p>Output:</p> <pre><code>{\n\"timestamp\": 1626307972085688242,\n\"time\": \"2021-07-15T01:12:52.085688242+01:00\",\n\"results\": [\n{\n\"operation\": \"UPDATE\",\n\"path\": \"acl/acl-sets\"\n}\n]\n}\n</code></pre>  acl2.json  <p> <pre><code>{\n\"acl-set\": [\n{\n\"config\": {\n\"name\": \"test\",\n\"type\": \"ACL_IPV4\"\n},\n\"name\": \"test\",\n\"type\": \"ACL_IPV4\",\n\"acl-entries\": {\n\"acl-entry\": [\n{\n\"sequence-id\": 10,\n\"actions\": {\n\"config\": {\n\"forwarding-action\": \"DROP\"\n}\n},\n\"config\": {\n\"sequence-id\": 10\n},\n\"ipv4\": {\n\"config\": {\n\"destination-address\": \"192.0.2.0/24\",\n\"source-address\": \"0.0.0.0/0\"\n}\n}\n}\n]\n}\n}\n]\n}\n</code></pre> </p> <p>This creates</p> <pre><code>ip access-list test\n   10 deny ip any 192.0.2.0/24\n</code></pre>"},{"location":"examples/gnmi-clients/gnmic/#shutdown-an-interface","title":"Shutdown an interface","text":"<pre><code>gnmic -a 192.0.2.108:6030 -u cvpadmin -p arista --insecure --gzip set \\\n--update-path '/interfaces/interface[name=Ethernet1]/config/enabled' \\\n--update-value 'false'\n</code></pre> <pre><code>{\n\"timestamp\": 1626309145489047571,\n\"time\": \"2021-07-15T01:32:25.489047571+01:00\",\n\"results\": [\n{\n\"operation\": \"UPDATE\",\n\"path\": \"interfaces/interface[name=Ethernet1]/config/enabled\"\n}\n]\n}\n</code></pre>"},{"location":"examples/gnmi-clients/gnmic/#bring-up-an-interface","title":"Bring up an interface","text":"<pre><code>gnmic -a 192.0.2.108:6030 -u cvpadmin -p arista --insecure --gzip set \\\n--update-path '/interfaces/interface[name=Ethernet1]/config/enabled' \\\n--update-value 'true'\n</code></pre> <pre><code>{\n\"timestamp\": 1626309156607307596,\n\"time\": \"2021-07-15T01:32:36.607307596+01:00\",\n\"results\": [\n{\n\"operation\": \"UPDATE\",\n\"path\": \"interfaces/interface[name=Ethernet1]/config/enabled\"\n}\n]\n}\n</code></pre>"},{"location":"examples/gnmi-clients/gnmic/#eos-native-paths","title":"EOS Native paths","text":"<p>To get EOS native paths, OCTA has to be enabled as mentioned in the configuration section. Performing GET/SUBSCRIBE actions using EOS native paths require changing the origin to <code>eos_native</code>.</p>"},{"location":"examples/gnmi-clients/gnmic/#commonly-used-paths","title":"Commonly used paths","text":"<ul> <li>MAC table: <code>/Smash/bridging/status/smashFdbStatus</code></li> <li>ARP table: <code>/Smash/arp/status/arpEntry</code></li> <li>Neighbor table: <code>/Smash/arp/status/neighborEntry</code></li> <li>IPv4 RIB: <code>/Smash/routing/status/route</code></li> <li>IPv6 RIB: <code>/Smash/routing6/status/route</code></li> <li>IPv4 next-hop table: <code>/Smash/routing/status/nexthop</code></li> <li>IPv6 next-hop table: <code>/Smash/routing6/status/nexthop</code></li> <li>CPU info: <code>/Kernel/proc/cpu</code></li> <li>Process statistics: <code>/Kernel/proc/stat</code></li> <li>System info: <code>/Kernel/sysinfo</code></li> <li>EOS version: <code>/Eos/image</code></li> <li>Interface counters: <code>/Smash/counters/ethIntf/&lt;agent&gt;/current/counter</code></li> <li>Values for <code>&lt;agent&gt;</code> are:<ul> <li>7500-family, 7280-family, 7020-family (Arad/Jericho ASICs): <code>SandCounters</code></li> <li>7300-family, 7250-family, 7050-family, 7010 products, 720-family (Trident   ASICs): <code>StrataCounters</code></li> <li>For 7060-family, 7260-family (Tomahawk): <code>Strata-FixedSystem</code> or   <code>StrataCounters</code> from 4.22+</li> <li>7150-family products (Alta ASICs): <code>FocalPointV2</code></li> <li>7160-family products (Cavium/Xpliant ASICs): <code>XpCounters</code></li> <li>7170-family products (Barefoot ASIC): <code>BfnCounters</code></li> </ul> </li> </ul>"},{"location":"examples/gnmi-clients/gnmic/#get-cpu-utilization","title":"Get CPU utilization","text":"<pre><code> gnmic -a 192.0.2.108:6030 -u cvpadmin -p arista --insecure --gzip get --path  \\\n'eos_native:/Kernel/proc/cpu/utilization/total'\n</code></pre>  Reveal output <p> <pre><code>[\n{\n\"timestamp\": 1626291721294738334,\n\"time\": \"2021-07-14T20:42:01.294738334+01:00\",\n\"prefix\": \"eos_native:Kernel/proc/cpu/utilization/total\",\n\"updates\": [\n{\n\"Path\": \"name\",\n\"values\": {\n\"name\": \"total\"\n}\n},\n{\n\"Path\": \"nice\",\n\"values\": {\n\"nice\": 28845\n}\n},\n{\n\"Path\": \"util\",\n\"values\": {\n\"util\": 41\n}\n},\n{\n\"Path\": \"user\",\n\"values\": {\n\"user\": 32058347\n}\n},\n{\n\"Path\": \"system\",\n\"values\": {\n\"system\": 4597389\n}\n},\n{\n\"Path\": \"idle\",\n\"values\": {\n\"idle\": 76373566\n}\n}\n]\n}\n]\n</code></pre> </p>"},{"location":"examples/gnmi-clients/gnmic/#get-transceiver-dom-temperature","title":"Get transceiver DOM temperature","text":"<pre><code>gnmic -a 192.0.2.1:6030 -u admin -p admin --insecure --gzip get --path \\\neos_native:/Sysdb/hardware/archer/xcvr/status &gt;&gt; outputs/doms.json\n</code></pre>"},{"location":"examples/gnmi-clients/gnmic/#get-eos-image-version","title":"Get EOS image version","text":"<pre><code>gnmic -a 192.0.2.1:6030 -u admin -p admin --insecure --gzip get \\\n--path eos_native:/Eos/image &gt;&gt; outputs/eos_image.json\n</code></pre>"},{"location":"examples/gnmi-clients/gnmic/#get-lanz-data-streaming","title":"Get LANZ Data Streaming","text":"<p>In addition to Octa, LANZ and LANZ Data Streaming also needs to be enabled on the switch.</p> <pre><code>queue-monitor length\n!\nqueue-monitor streaming\n   no shutdown\n</code></pre> <p>With Octa and LANZ Data Streaming enabled, LANZ metrics can be subscribed to:</p> <pre><code>gnmic -a 192.0.2.1:6030 -u admin -p admin --insecure --gzip \\\nsubscribe --path 'eos_native:/LANZ'\n</code></pre>  Reveal output <p> <pre><code>{\n\"source\": \"192.0.2.1:6030\",\n\"subscription-name\": \"default-1669906007\",\n\"timestamp\": 1669903438845029161,\n\"time\": \"2022-12-01T19:33:58.845029161+05:30\",\n\"prefix\": \"eos_native:LANZ/config\",\n\"updates\": [\n{\n\"Path\": \"name\",\n\"values\": {\n\"name\": \"config\"\n}\n}\n]\n}\n{\n\"source\": \"192.0.2.1:6030\",\n\"subscription-name\": \"default-1669906007\",\n\"timestamp\": 1669903438845141433,\n\"time\": \"2022-12-01T19:33:58.845141433+05:30\",\n\"prefix\": \"eos_native:LANZ/globalBufferUsage\",\n\"updates\": [\n{\n\"Path\": \"name\",\n\"values\": {\n\"name\": \"globalBufferUsage\"\n}\n},\n{\n\"Path\": \"globalBufferUsageRecord\",\n\"values\": {\n\"globalBufferUsageRecord\": {\n\"bufferSize\": 0,\n\"duration\": 0,\n\"entryType\": \"\",\n\"timestamp\": 0\n}\n}\n}\n]\n}\n{\n\"source\": \"192.0.2.1:6030\",\n\"subscription-name\": \"default-1669906007\",\n\"timestamp\": 1669906008617947980,\n\"time\": \"2022-12-01T20:16:48.61794798+05:30\",\n\"prefix\": \"eos_native:LANZ/congestion\",\n\"updates\": [\n{\n\"Path\": \"congestionRecord\",\n\"values\": {\n\"congestionRecord\": {\n\"entryType\": \"POLLING\",\n\"fabricPeerIntfName\": \"\",\n\"intfName\": \"Ethernet6\",\n\"portID\": 105,\n\"qDropCount\": 0,\n\"queueSize\": 1998240,\n\"switchID\": 0,\n\"timeOfMaxQLen\": 0,\n\"timestamp\": 1669906008617720,\n\"trafficClass\": 1,\n\"txLatency\": 0\n}\n}\n}\n]\n}\n{\n\"source\": \"192.0.2.1:6030\",\n\"subscription-name\": \"default-1669906007\",\n\"timestamp\": 1669903438845107943,\n\"time\": \"2022-12-01T19:33:58.845107943+05:30\",\n\"prefix\": \"eos_native:LANZ/congestion\",\n\"updates\": [\n{\n\"Path\": \"name\",\n\"values\": {\n\"name\": \"congestion\"\n}\n}\n]\n}\n{\n\"source\": \"192.0.2.1:6030\",\n\"subscription-name\": \"default-1669906007\",\n\"timestamp\": 1669905829532672732,\n\"time\": \"2022-12-01T20:13:49.532672732+05:30\",\n\"prefix\": \"eos_native:LANZ/config/portConfigRecord\",\n\"updates\": [\n{\n\"Path\": \"Ethernet6/intfName\",\n\"values\": {\n\"Ethernet6/intfName\": \"Ethernet6\"\n}\n},\n{\n\"Path\": \"Ethernet6/switchID\",\n\"values\": {\n\"Ethernet6/switchID\": 0\n}\n},\n{\n\"Path\": \"Ethernet6/portID\",\n\"values\": {\n\"Ethernet6/portID\": 105\n}\n},\n{\n\"Path\": \"Ethernet6/internalPort\",\n\"values\": {\n\"Ethernet6/internalPort\": false\n}\n},\n{\n\"Path\": \"Ethernet6/highThreshold\",\n\"values\": {\n\"Ethernet6/highThreshold\": 40962\n}\n},\n{\n\"Path\": \"Ethernet6/lowThreshold\",\n\"values\": {\n\"Ethernet6/lowThreshold\": 10241\n}\n}\n]\n}\n{\n\"source\": \"192.0.2.1:6030\",\n\"subscription-name\": \"default-1669906007\",\n\"timestamp\": 1669905829532649815,\n\"time\": \"2022-12-01T20:13:49.532649815+05:30\",\n\"prefix\": \"eos_native:LANZ/config\",\n\"updates\": [\n{\n\"Path\": \"configRecord\",\n\"values\": {\n\"configRecord\": {\n\"globalUsageHighThreshold\": 0,\n\"globalUsageLowThreshold\": 0,\n\"globalUsageReportingEnabled\": true,\n\"lanzVersion\": 1,\n\"maxQueueSize\": 524288000,\n\"numOfPorts\": 121,\n\"segmentSize\": 16,\n\"timestamp\": 1669905829532490\n}\n}\n}\n]\n}\n{\n\"source\": \"192.0.2.1:6030\",\n\"subscription-name\": \"default-1669906007\",\n\"timestamp\": 1669903438845176033,\n\"time\": \"2022-12-01T19:33:58.845176033+05:30\",\n\"prefix\": \"eos_native:LANZ/error\",\n\"updates\": [\n{\n\"Path\": \"name\",\n\"values\": {\n\"name\": \"error\"\n}\n},\n{\n\"Path\": \"errorRecord\",\n\"values\": {\n\"errorRecord\": {\n\"errorMessage\": \"\",\n\"timestamp\": 0\n}\n}\n}\n]\n}\n</code></pre> </p>"},{"location":"examples/gnmi-clients/gnmic/#cli-origin","title":"Cli origin","text":""},{"location":"examples/gnmi-clients/gnmic/#get-the-running-config","title":"Get the running config","text":"<pre><code>gnmic -a 192.0.2.1:6030 -u admin -p admin --insecure  get \\\n--path \"cli:/show running-config\" &gt;&gt; outputs/outputs.json\n</code></pre>"},{"location":"examples/gnmi-clients/gnmic/#get-the-total-route-count","title":"Get the total route count","text":"<pre><code>gnmic -a 192.0.2.1:6030 -u admin -p admin --insecure  get \\\n--path \"cli:/show ip route summary\" \\\n| jq '.[0].updates[0].values.\"show ip route summary\".totalRoutes'\n</code></pre>"},{"location":"examples/gnmi-clients/gnmic/#changing-the-running-config","title":"Changing the running-config","text":"<p>There are multiple ways to change the configuration using the <code>cli</code> origin:</p>"},{"location":"examples/gnmi-clients/gnmic/#using-json","title":"Using JSON","text":"<p>Multiple config sections can be change at a time, for instance in the below example vlan 304 is created and the description of Ethernet1 is changed:</p> <pre><code> gnmic -a 192.0.2.214:6030 -u admin -p admin --insecure --gzip set \\\n--request-file intf.json\n</code></pre> <p>Output:</p>  Reveal output <p> <pre><code>{\n\"timestamp\": 1628103804792021864,\n\"time\": \"2021-08-04T20:03:24.792021864+01:00\",\n\"results\": [\n{\n\"operation\": \"UPDATE\",\n\"path\": \"cli:\"\n},\n{\n\"operation\": \"UPDATE\",\n\"path\": \"cli:\"\n},\n{\n\"operation\": \"UPDATE\",\n\"path\": \"cli:\"\n},\n{\n\"operation\": \"UPDATE\",\n\"path\": \"cli:\"\n}\n]\n}\n</code></pre> </p> <pre><code>cat intf.json\n</code></pre> <pre><code>{\n\"updates\": [\n{\n\"path\": \"cli:\",\n\"value\": \"interface Ethernet 1\",\n\"encoding\": \"ascii\"\n},\n{\n\"path\": \"cli:\",\n\"value\": \"description arista-openmgmt\",\n\"encoding\": \"ascii\"\n},\n{\n\"path\": \"cli:\",\n\"value\": \"vlan 304\",\n\"encoding\": \"ascii\"\n},\n{\n\"path\": \"cli:\",\n\"value\": \"name test\",\n\"encoding\": \"ascii\"\n}\n]\n}\n</code></pre>"},{"location":"examples/gnmi-clients/gnmic/#using-yaml","title":"Using YAML","text":"<p>Changing the maximum-routes for a BGP neighbor:</p> <pre><code>gnmic -a 192.0.2.214:6030 -u cvpadmin -p arista --insecure --gzip set \\\n--request-file bgp.yaml\n</code></pre> <p>Output:</p>  Reveal output <p> <pre><code>{\n  \"timestamp\": 1628091791855672771,\n  \"time\": \"2021-08-04T16:43:11.855672771+01:00\",\n  \"results\": [\n    {\n      \"operation\": \"UPDATE\",\n      \"path\": \"cli:\"\n    },\n    {\n      \"operation\": \"UPDATE\",\n      \"path\": \"cli:\"\n    }\n  ]\n}\n</code></pre> </p> <pre><code>cat bgp.yaml\n</code></pre> <pre><code>updates:\n- path: \"cli:\"\nvalue: router bgp 65101\nencoding: ascii\n- path: \"cli:\"\nvalue: neighbor IPv4-UNDERLAY-PEERS maximum-routes 15500\nencoding: ascii\n</code></pre>"},{"location":"examples/gnmi-clients/gnmic/#using-imperative-commands","title":"Using imperative commands","text":"<pre><code>gnmic -a 192.0.2.214:6030 -u cvpadmin -p arista --insecure --gzip \\\n--encoding ASCII set \\\n--update-path \"cli:\" \\\n--update-value \"router bgp 65101\" \\\n--update-path \"cli:\" \\\n--update-value \"neighbor IPv4-UNDERLAY-PEERS maximum-routes 13500\"\n</code></pre> <p>Output:</p>  Reveal output <p> <pre><code>{\n\"timestamp\": 1628091405938523430,\n\"time\": \"2021-08-04T16:36:45.93852343+01:00\",\n\"results\": [\n{\n\"operation\": \"UPDATE\",\n\"path\": \"cli:\"\n},\n{\n\"operation\": \"UPDATE\",\n\"path\": \"cli:\"\n}\n]\n}\n</code></pre> </p>"},{"location":"examples/gnmi-clients/gnmic/#running-unconverted-show-commands-that-use-text-format","title":"Running unconverted show commands that use 'text' format","text":"<p>To run show commands that are not converted to JSON and require <code>format=\"text\"</code> the <code>ASCII</code> encoding can be used from EOS 4.29.2F or newer.</p>"},{"location":"examples/gnmi-clients/gnmic/#show-platform-fap-interrupts","title":"show platform fap interrupts","text":"<pre><code>gnmic -a 192.0.2.1:6030 -u admin -p admin --insecure get --gzip --encoding ASCII --path \"cli:/show platform fap interrupts\"\n</code></pre> <p>Output:</p>  Reveal output <p> <pre><code>[\n{\n\"source\": \"10.81.117.21:6030\",\n\"timestamp\": 1698270415643755294,\n\"time\": \"2023-10-25T22:46:55.643755294+01:00\",\n\"updates\": [\n{\n\"Path\": \"cli:show platform fap interrupts\",\n\"values\": {\n\"show platform fap interrupts\": \" Jericho0\\n -------------------------------------------------------------------------------------------------------------- \\n\n          | Interrupt Bit                                                         | Count | First Occurrence    | Last Occurrence     |\\n -------------------------------------------------------------------------------------------------------------- \\n\n          | NBIH_LINK_STATUS_CHANGE_LinkStatusChangeInterruptRegister_12[0]       |    55 | 2023-10-05 00:02:22 | 2023-10-20 10:29:21 |\\n\n          | NBIH_LINK_STATUS_CHANGE_LinkStatusChangeInterruptRegister_13[0]       |    39 | 2023-10-05 00:02:21 | 2023-10-16 19:00:15 |\\n\n          | NBIH_LINK_STATUS_CHANGE_LinkStatusChangeInterruptRegister_14[0]       |    39 | 2023-10-05 00:02:23 | 2023-10-16 19:00:15 |\\n\n          | NBIH_LINK_STATUS_CHANGE_LinkStatusChangeInterruptRegister_15[0]       |    39 | 2023-10-05 00:02:22 | 2023-10-16 19:00:15 |\\n\n          | NBIH_LINK_STATUS_CHANGE_LinkStatusChangeInterruptRegister_20[0]       |    67 | 2023-10-05 00:02:26 | 2023-10-24 00:44:24 |\\n\n          | NBIH_LINK_STATUS_CHANGE_LinkStatusChangeInterruptRegister_21[0]       |    56 | 2023-10-05 00:02:25 | 2023-10-24 00:44:24 |\\n\n          | NBIH_LINK_STATUS_CHANGE_LinkStatusChangeInterruptRegister_22[0]       |    53 | 2023-10-05 00:02:25 | 2023-10-24 00:45:15 |\\n\n          | NBIH_LINK_STATUS_CHANGE_LinkStatusChangeInterruptRegister_23[0]       |    55 | 2023-10-05 00:02:24 | 2023-10-24 00:45:15 |\\n\n          | IPS_QueueEnteredDel[1]                                                |     6 | 2023-10-11 14:00:20 | 2023-10-11 14:12:02 |\\n\n          | EPNI_PP_NewDaErr[0]                                                   | 255279 | 2023-10-05 15:06:43 | 2023-10-25 21:46:52 |\\n\n          | EPNI_PP_VsiMembershipDeny[1]                                          |     2 | 2023-10-11 02:27:16 | 2023-10-11 14:11:46 |\\n\n          | EPNI_PP_EesLastActionNotAc[0]                                         | 255279 | 2023-10-05 15:06:43 | 2023-10-25 21:46:52 |\\n\n          | EPNI_PP_EesLastActionNotAc[1]                                         | 47299 | 2023-10-05 13:33:12 | 2023-10-23 16:16:04 |\\n\n          | FMAC_FMAC_2_RxLostOfSync_0[32]                                        | 883687 | 2023-10-05 00:02:34 | 2023-10-25 21:46:54 |\\n\n          | FMAC_FMAC_2_RxLostOfSync_1[33]\n          &lt;ommitted&gt;\n          \\n\"\n}\n}\n]\n}\n]\n</code></pre> </p>"},{"location":"examples/gnmi-clients/gnmic/#misc","title":"Misc","text":""},{"location":"examples/gnmi-clients/gnmic/#save-all-status-states-to-a-file","title":"Save all status states to a file","text":"<pre><code>gnmic -a 192.0.2.1:6030 -u admin -p admin --insecure get \\\n--path \".../state/...\" &gt;&gt; outputs/states.json\n</code></pre>"},{"location":"examples/gnmi-clients/gnmic/#save-all-config-states-to-a-file","title":"Save all config states to a file","text":"<pre><code>gnmic -a 192.0.2.1:6030 -u admin -p admin --insecure get \\\n--path \".../config/...\" &gt;&gt; outputs/configs.json\n</code></pre>"},{"location":"examples/gnmi-clients/gnmic/#save-network-instance-states-to-a-file","title":"Save network instance states to a file","text":"<pre><code>gnmic -a 192.0.2.1:6030 -u admin -p admin --insecure get --path \\\n/network-instances/network-instance &gt;&gt; outputs/network-instances.json\n</code></pre>"},{"location":"examples/gnmi-clients/gnmic/#save-bgp-states-to-a-file","title":"Save BGP states to a file","text":"<pre><code>gnmic -a 192.0.2.1:6030 -u admin -p admin --insecure get --path \\\n/network-instances/network-instance[name=default]/protocols/protocol[name=BGP]\\\n&gt;&gt; outputs/bgp.json\n</code></pre>"},{"location":"examples/gnmi-gateway/","title":"gNMI-Gateway","text":""},{"location":"examples/gnmi-gateway/#overview","title":"Overview","text":"<p>gNMI gateway is an opensource project created by Netflix. Conceptually, gNMI gateway sits as a proxy for multiple gNMI targets. A gNMI client speaks to a common gNMI service endpoint within the network (gNMI gateway) and specifies a gNMI target with an accompanying path. The gNMI gateway will in turn initiate the connection to the target device and stream the contents to the originating proxy.</p> <ul> <li>gNMI gateway documentation</li> <li>NANOG demonstration</li> </ul> <p>This demo will start the gNMI gateway binary and use gNMIC to stream to a target which is managed by the gNMI gateway. Please make adjustments to the <code>targets.json</code> file to match your environment.</p> <p>The demo is dependent on the following files:</p> <ul> <li>gnmi-gateway - The binary to activate gNMI gateway. This must be built for the platform that it will run on.   Details regarding generation of the binary for the target platform can be found in the gNMI gateway   documentation.</li> <li>server.crt / server.key - the certificate and key for gNMI gateway. These can be generated through a CA.   Additional details may be found here.</li> <li>targets.json - This file specifies the targets.  gNMI-gateway supports hot reloading of the files. So if changes   are made within targets.json it will reload automatically with new targets and or new paths.</li> </ul> sample: targets.json <p> <pre><code>{\n\"request\": {\n\"default\": {\n\"subscribe\": {\n\"prefix\": {\n},\n\"subscription\": [\n{\n\"path\": {\n\"elem\": [\n{\n\"name\": \"interfaces\"\n}\n]\n}\n}\n]\n}\n}\n},\n\"target\": {\n\"DC2-SP02\": {\n\"addresses\": [\n\"198.51.100.22:6030\"\n],\n\"credentials\": {\n\"username\": \"ansible\",\n\"password\": \"ansible\"\n},\n\"request\": \"default\",\n\"meta\": {\n\"NoTLS\": \"yes\"\n}\n},\n\"DC2-LEAF1A\": {\n\"addresses\": [\n\"198.51.100.5:6030\"\n],\n\"credentials\": {\n\"username\": \"ansible\",\n\"password\": \"ansible\"\n},\n\"request\": \"default\",\n\"meta\": {\n\"NoTLS\": \"yes\"\n}\n},\n\"DC2-LF70\": {\n\"addresses\": [\n\"198.51.100.70:6030\"\n],\n\"credentials\": {\n\"username\": \"ansible\",\n\"password\": \"ansible\"\n},\n\"request\": \"default\",\n\"meta\": {\n\"NoTLS\": \"yes\"\n}\n}\n}\n}\n</code></pre> </p>"},{"location":"examples/gnmi-gateway/#eos-configuration","title":"EOS Configuration","text":"<p>gNMI will need to be enabled on the target which is managed by gNMI gateway and a certificate will need to be installed to use TLS-based authentication. Additional details regarding enabling gnmi on EOS devices can be found here. Additional details regarding certificate management and configuration can be found here.</p>"},{"location":"examples/gnmi-gateway/#start-gnmi-gateway","title":"Start gNMI gateway","text":"<p>Note, the <code>server.crt</code> must be signed by a CA that the switch can resolve.</p> <pre><code>gnmi-gateway -EnableGNMIServer -ServerTLSCert=server.crt \\\n-ServerTLSKey=server.key -TargetLoaders=json -TargetJSONFile=targets.json\n</code></pre> <p>Output:</p> Reveal Output <p> <pre><code>{\"level\":\"info\",\"time\":\"2021-03-19T08:47:35-04:00\",\"message\":\"Starting GNMI Gateway.\"}\n{\"level\":\"info\",\"time\":\"2021-03-19T08:47:35-04:00\",\"message\":\"Clustering is NOT enabled. No locking or cluster coordination will happen.\"}\n{\"level\":\"info\",\"time\":\"2021-03-19T08:47:35-04:00\",\"message\":\"Starting connection manager.\"}\n{\"level\":\"info\",\"time\":\"2021-03-19T08:47:35-04:00\",\"message\":\"Starting gNMI server on 0.0.0.0:9339.\"}\n{\"level\":\"info\",\"time\":\"2021-03-19T08:47:35-04:00\",\"message\":\"Connection manager received a target control message: 3 inserts 0 removes\"}\n{\"level\":\"info\",\"time\":\"2021-03-19T08:47:35-04:00\",\"message\":\"Initializing target DC2-SP02 ([198.51.100.22:6030]) map[NoTLS:yes].\"}\n{\"level\":\"info\",\"time\":\"2021-03-19T08:47:35-04:00\",\"message\":\"Initializing target DC2-LEAF1A ([198.51.100.5:6030]) map[NoTLS:yes].\"}\n{\"level\":\"info\",\"time\":\"2021-03-19T08:47:35-04:00\",\"message\":\"Target DC2-SP02: Connecting\"}\n{\"level\":\"warn\",\"time\":\"2021-03-19T08:47:35-04:00\",\"message\":\"DEPRECATED: The 'NoTLS' target flag has been deprecated and will be removed in a future release. Please use 'NoTLSVerify' instead.\"}\n{\"level\":\"info\",\"time\":\"2021-03-19T08:47:35-04:00\",\"message\":\"Target DC2-SP02: Subscribing\"}\n{\"level\":\"info\",\"time\":\"2021-03-19T08:47:35-04:00\",\"message\":\"Initializing target DC2-LF70 ([198.51.100.70:6030]) map[NoTLS:yes].\"}\n{\"level\":\"info\",\"time\":\"2021-03-19T08:47:35-04:00\",\"message\":\"Target DC2-LEAF1A: Connecting\"}\n{\"level\":\"warn\",\"time\":\"2021-03-19T08:47:35-04:00\",\"message\":\"DEPRECATED: The 'NoTLS' target flag has been deprecated and will be removed in a future release. Please use 'NoTLSVerify' instead.\"}\n{\"level\":\"info\",\"time\":\"2021-03-19T08:47:35-04:00\",\"message\":\"Target DC2-LEAF1A: Subscribing\"}\n{\"level\":\"info\",\"time\":\"2021-03-19T08:47:35-04:00\",\"message\":\"Target DC2-LF70: Connecting\"}\n{\"level\":\"warn\",\"time\":\"2021-03-19T08:47:35-04:00\",\"message\":\"DEPRECATED: The 'NoTLS' target flag has been deprecated and will be removed in a future release. Please use 'NoTLSVerify' instead.\"}\n{\"level\":\"info\",\"time\":\"2021-03-19T08:47:35-04:00\",\"message\":\"Target DC2-LF70: Subscribing\"}\n{\"level\":\"info\",\"time\":\"2021-03-19T08:47:35-04:00\",\"message\":\"Target DC2-SP02: Connected\"}\n{\"level\":\"info\",\"time\":\"2021-03-19T08:47:36-04:00\",\"message\":\"Target DC2-LF70: Connected\"}\n{\"level\":\"info\",\"time\":\"2021-03-19T08:47:36-04:00\",\"message\":\"Target DC2-LEAF1A: Connected\"}\n{\"level\":\"info\",\"time\":\"2021-03-19T08:47:37-04:00\",\"message\":\"Target DC2-LF70: Synced\"}\n{\"level\":\"info\",\"time\":\"2021-03-19T08:47:37-04:00\",\"message\":\"Target DC2-SP02: Synced\"}\n{\"level\":\"info\",\"time\":\"2021-03-19T08:47:38-04:00\",\"message\":\"Target DC2-LEAF1A: Synced\"}\n</code></pre> </p> <p>The output indicates that gNMI-gateway has started and will now serve gNMI requests to the <code>/interfaces/interface</code> path on behalf of any external gNMI client.</p>"},{"location":"examples/gnmi-gateway/#requesting-a-target-managed-by-gnmi-gateway","title":"Requesting a target managed by gNMI gateway","text":"<pre><code>gnmic subscribe -a 192.0.2.1 -u ansible -p ansible --port=9339 \\\n--skip-verify --target=DC2-SP02 --path=/interfaces\n</code></pre> <p>Output:</p> <pre><code>{\n\"source\": \"192.0.2.1:9339\",\n\"subscription-name\": \"default-1616158143\",\n\"timestamp\": 1605208845740882713,\n\"time\": \"2020-11-12T14:20:45.740882713-05:00\",\n\"target\": \"DC2-SP02\",\n\"updates\": [\n{\n\"Path\": \"interfaces/interface[name=Ethernet54/1]/state/tpid\",\n\"values\": {\n\"interfaces/interface/state/tpid\": \"openconfig-vlan-types:TPID_0X8100\"\n}\n}\n]\n}\n</code></pre> <p>Since the gNMI gateway is running locally a query can be issued to the service on port 9339 passing in the target value of <code>DC2-SP02</code> and telemetry will start to stream data back to the client.</p>"},{"location":"examples/gnoi/","title":"gNOI","text":""},{"location":"examples/gnoi/#about-grpc","title":"About gRPC","text":"<p>gRPC - Google Remote Procedure Call</p> <p>gRPC uses protobuf and HTTP/2</p>"},{"location":"examples/gnoi/#about-gnoi","title":"About gNOI","text":"<p>gNOI - gRPC Network Operations Interface</p> <p>gNOI defines a set of gRPC-based microservices for executing operational commands on network devices.</p> <p>gNOI github repository</p> <p>As example, this gNOI proto file defines the service <code>System</code> with the RPC <code>Traceroute</code> and <code>Ping</code></p> <ul> <li>Ping executes the ping command on the target and streams back the results</li> <li>Traceroute executes the traceroute command on the target and streams back the results</li> <li>As you can see in the proto file, the field VRF is not defined for these messages</li> </ul>"},{"location":"examples/gnoi/#about-gnoi-support-on-eos","title":"About gNOI support on EOS","text":"<p>Please refer to this link for the gNOI support by EOS.</p> <p>Examples:</p> <ul> <li>gNOI ping</li> <li>gNOI traceroute</li> <li>gNOI Support</li> </ul>"},{"location":"examples/gnoi/gnoic/","title":"gNOIc examples","text":""},{"location":"examples/gnoi/gnoic/#gnoic-overview","title":"gNOIc overview","text":"<p>gNOIc is a gNOI CLI client:</p> <ul> <li>source code</li> <li>documentation</li> </ul> <p>The following examples shows various gNOIc commands with Arista EOS devices.</p>"},{"location":"examples/gnoi/gnoic/#download-install-gnoic","title":"Download &amp; install gNOIc","text":"<p>To install run:</p> <pre><code>bash -c \"$(curl -sL https://get-gnoic.kmrd.dev)\"\n</code></pre> <p>To get the version run:</p> <pre><code>gnoic version\n</code></pre> <p>Output:</p> <pre><code>version : 0.0.5\n commit : 26c6248\n   date : 2021-05-12T10:12:55Z\n gitURL : https://github.com/karimra/gnoic\n   docs : https://gnoic.kmrd.dev\n</code></pre>"},{"location":"examples/gnoi/gnoic/#device-config","title":"Device config","text":"<pre><code>interface Management1\n   description oob_management\n   vrf MGMT\n   ip address 192.0.2.118/24\n\nusername arista secret 0 arista\n\nmanagement api gnmi\n   transport grpc def\n      vrf MGMT\n</code></pre> <pre><code>DC1-L2LEAF2A#show management api gnmi\nEnabled:            Yes\nServer:             running on port 6030, in MGMT VRF\nSSL Profile:        none\nQoS DSCP:           none\nDC1-L2LEAF2A#\n</code></pre> <p>Before to use gNOI ping and traceroute, lets run these commands locally:</p> <pre><code>$ ssh arista@192.0.2.118\nPassword:\nLast login: Thu Jun  3 12:06:25 2021 from 192.0.2.3\nDC1-L2LEAF2A&gt;en\nDC1-L2LEAF2A#bash\n\nArista Networks EOS shell\n\n[arista@DC1-L2LEAF2A ~]$ ping  172.31.255.0 -c 2\nPING 172.31.255.0 (172.31.255.0) 56(84) bytes of data.\n64 bytes from 172.31.255.0: icmp_seq=1 ttl=63 time=24.6 ms\n64 bytes from 172.31.255.0: icmp_seq=2 ttl=63 time=18.8 ms\n\n--- 172.31.255.0 ping statistics ---\n2 packets transmitted, 2 received, 0% packet loss, time 1001ms\nrtt min/avg/max/mdev = 18.861/21.738/24.616/2.881 ms\n[arista@DC1-L2LEAF2A ~]$\n[arista@DC1-L2LEAF2A ~]$ traceroute -A 172.31.255.0\ntraceroute to 172.31.255.0 (172.31.255.0), 30 hops max, 60 byte packets\n 1  10.90.90.1 (10.90.90.1) [!!]  26.636 ms  29.420 ms  32.113 ms\n 2  172.31.255.0 (172.31.255.0) [!!]  52.764 ms  53.881 ms  63.213 ms\n[arista@DC1-L2LEAF2A ~]$\n[arista@DC1-L2LEAF2A ~]$ exit\nlogout\nDC1-L2LEAF2A#exit\nConnection to 192.0.2.118 closed.\n</code></pre>"},{"location":"examples/gnoi/gnoic/#gnoi-demo-with-arista-using-gnoic","title":"gNOI demo with Arista using gNOIc","text":""},{"location":"examples/gnoi/gnoic/#gnoi-ping","title":"gNOI Ping","text":"<pre><code>gnoic -a 192.0.2.118:6030 -u arista -p arista --insecure  system ping \\\n--destination 172.31.255.0 --count 2 --do-not-resolve\n</code></pre> <p>Output:</p> <pre><code>WARN[0000] \"192.0.2.118:6030\" could not lookup hostname: lookup 118.1.73.10.in-addr.arpa. on 127.0.0.53:53: no such host\nsource: \"172.31.255.0\"\ntime: 31200000\nbytes: 64\nsequence: 1\nttl: 63\nsource: \"172.31.255.0\"\ntime: 33900000\nbytes: 64\nsequence: 2\nttl: 63\nsource: \"172.31.255.0\"\ntime: 1001000000\nsent: 2\nreceived: 2\nmin_time: 31251000\navg_time: 32590000\nmax_time: 33930000\nstd_dev: 1351000\n</code></pre>"},{"location":"examples/gnoi/gnoic/#gnoi-traceroute","title":"gNOI Traceroute","text":"<pre><code> gnoic -a 192.0.2.118:6030 -u arista -p arista --insecure  system traceroute \\\n--destination 172.31.255.0 --do-not-resolve\n</code></pre> <p>Output:</p> <pre><code>WARN[0000] \"192.0.2.118:6030\" could not lookup hostname: lookup 118.1.73.10.in-addr.arpa. on 127.0.0.53:53: no such host\ndestination_name: \"172.31.255.0\"\ndestination_address: \"172.31.255.0\"\nhops: 30\npacket_size: 60\nhop: 1\naddress: \"10.90.90.1\"\nrtt: 21440000\nhop: 1\naddress: \"10.90.90.1\"\nrtt: 23011000\nhop: 1\naddress: \"10.90.90.1\"\nrtt: 31135000\nhop: 2\naddress: \"172.31.255.0\"\nrtt: 62216000\nhop: 2\naddress: \"172.31.255.0\"\nrtt: 63213000\nhop: 2\naddress: \"172.31.255.0\"\nrtt: 71079000\n</code></pre>"},{"location":"examples/gnoi/gnoic/#gnoi-cert","title":"gNOI cert","text":"<pre><code>gnoic -a 192.0.2.118:6030 -u arista -p arista --insecure cert can-generate-csr\n</code></pre> <p>Output:</p> <pre><code>WARN[0000] \"192.0.2.118:6030\" could not lookup hostname: lookup 118.1.73.10.in-addr.arpa. on 127.0.0.53:53: no such host\nINFO[0000] \"192.0.2.118:6030\" key-type=KT_RSA, cert-type=CT_X509, key-size=2048: can_generate: true\n+------------------+------------------+\n|   Target Name    | Can Generate CSR |\n+------------------+------------------+\n| 192.0.2.118:6030 | true             |\n+------------------+------------------+\n</code></pre>"},{"location":"examples/gnoi/gnoic/#upgrading-eos-using-gnoi","title":"Upgrading EOS using gNOI","text":"<p>EOS supports gNOI OS Install/Activate/Verification (4.24.2F+) and gNOI System Reboot/Reboot/RebootStatus (4.27.0F+) that can be used to upload the EOS image, activate that image (set the boot-config) so that it boots with it next time, verify the image activation was successful and lastly to reboot the device to perform the upgrade.</p>"},{"location":"examples/gnoi/gnoic/#gnoi-os-install","title":"gNOI OS Install","text":"<p>To upload an EOS SWI image to a switch we can use the <code>gnoi.os.OS/Installation</code> RPC:</p> <pre><code>gnoic -a 192.0.2.1:6030 --insecure  --gzip -u admin -p admin \\\nos install \\\n--version 4.29.1F \\\n--pkg EOS.swi\n</code></pre> <p>Output:</p> <pre><code>INFO[0000] starting install RPC\nINFO[0000] target \"192.0.2.1:6030\": starting Install stream\nINFO[0003] target \"192.0.2.1:6030\": TransferProgress bytes_received:5242880\nINFO[0003] target \"192.0.2.1:6030\": TransferProgress bytes_received:10485760\n...\nINFO[0411] target \"192.0.2.1:6030\": TransferProgress bytes_received:1030750208\nINFO[0413] target \"192.0.2.1:6030\": sending TransferEnd\nINFO[0413] target \"192.0.2.1:6030\": TransferProgress bytes_received:1035993088\nINFO[0413] target \"192.0.2.1:6030\": TransferContent done...\n</code></pre>"},{"location":"examples/gnoi/gnoic/#gnoi-os-activate","title":"gNOI OS Activate","text":"<p>To activate the new EOS image (equivalent to running <code>boot system flash:EOS.swi</code> on the CLI) we can use  the <code>/gnoi.os.OS/Activation</code> RPC:</p> <pre><code>gnoic -a 192.0.2.1:6030 --insecure  --gzip -u admin -p admin \\\nos activate \\\n--version 4.29.1F \\\n--no-reboot\n</code></pre> <p>Output:</p> <pre><code>INFO[0034] target \"192.0.2.1:6030\" activate response \"activate_ok:{}\"\n</code></pre>"},{"location":"examples/gnoi/gnoic/#gnoi-os-verify","title":"gNOI OS Verify","text":"<pre><code>gnoic -a 192.0.2.1:6030 --insecure  --gzip -u admin -p admin os verify\n</code></pre> <p>Output:</p> <pre><code>+-------------------+---------+---------------------+\n|    Target Name    | Version | Activation Fail Msg |\n+-------------------+---------+---------------------+\n| 192.0.2.1:6030 | 4.29.1F |                     |\n+-------------------+---------+---------------------+\n</code></pre>"},{"location":"examples/gnoi/gnoic/#gnoi-system-reboot","title":"gNOI System Reboot","text":"<p>To reboot the device we can use <code>gnoi.system.System/Reboot</code> RPC and the <code>COLD</code> method:</p> <pre><code>gnoic -a 192.0.2.1:6030 --insecure  --gzip -u admin -p admin \\\nsystem reboot \\\n--method COLD\n</code></pre> <p>Note on older EOS versions you may get the following error message:</p> <pre><code>ERRO[0009] \"192.0.2.1:6030\" System Reboot failed: rpc error: code = Unavailable desc = error reading from server: EOF\nError: there was 1 error(s)\n</code></pre>"},{"location":"examples/gnoi/gnoic/#references","title":"References","text":"<p>gNOI Support</p>"},{"location":"examples/gnoi/gnoicode/","title":"gNOI in Golang","text":""},{"location":"examples/gnoi/gnoicode/#gnoi-review","title":"gNOI review","text":"<p>These are a few examples leveraging golang and gNOI using the gNOI protobuf specifically the System service</p> <p>The following examples show how to leverage the ping rpc and traceroute rpc</p> <p>All code can be found within the src directory under gnoi</p> <p>We will be leveraging the gNOI godocs which module can be imported as github.com/openconfig/gnoi</p> <p>Each one of the examples has the following default flags which can be changed based on the environment.</p> <pre><code>-username    = \"admin\"\n-password    = \"admin\"\n-target      = \"172.20.20.2:6030\"\n-destination = \"1.1.1.1\"\n</code></pre>"},{"location":"examples/gnoi/gnoicode/#test-device-configuration","title":"Test Device configuration","text":"<pre><code>management api gnmi\n   transport grpc default\n   provider eos-native\n</code></pre>"},{"location":"examples/gnoi/gnoicode/#cd-into-srcgnoi","title":"cd into src/gnoi","text":"<pre><code>cd src/gnoi\n</code></pre> <p>The directory should include the go.mod/go.sum for the correct packages so nothing needs installed on the system at the current time.</p> <pre><code>ls\ngo.mod  go.sum  pinggnoi.go  traceroutegnoi.go\n</code></pre>"},{"location":"examples/gnoi/gnoicode/#run-pinggo","title":"Run ping.go","text":""},{"location":"examples/gnoi/gnoicode/#srcgnoipinggo","title":"src/gnoi/ping.go","text":"Reveal output <p> <pre><code>package main\nimport (\n\"context\"\n\"flag\"\n\"fmt\"\n\"os\"\n\"time\"\nlog \"github.com/golang/glog\"\nsystem \"github.com/openconfig/gnoi/system\"\n\"google.golang.org/grpc\"\n\"google.golang.org/grpc/metadata\"\n)\nfunc checkflags(flag ...string) {\nfor _, f := range flag {\nif f == \"\" {\nfmt.Printf(\"You have an empty flag please fix.\")\nos.Exit(1)\n}\n}\n}\nfunc main() {\n// Add input parameters\nusername := flag.String(\"username\", \"admin\", \"username for connection to gNOI\")\npassword := flag.String(\"password\", \"admin\", \"password for connection to gNOI\")\ntarget := flag.String(\"target\", \"\", \"Target ip or hostname of the device running gNOI\")\ndestination := flag.String(\"destination\", \"\", \"Destination of the address to ping to\")\nflag.Parse()\n// Check for empty flags.\ncheckflags(*username, *password, *target, *destination)\nconn, err := grpc.Dial(*target, grpc.WithInsecure())\nif err != nil {\nlog.Exitf(\"Failed to %s Error: %v\", target, err)\n}\ndefer conn.Close()\n// Create the new grpc service connection\nSys := system.NewSystemClient(conn)\n// pass in context blank information with the timeout.\nctx, cancel := context.WithTimeout(context.Background(), time.Second)\n// cancel when the function is over.\ndefer cancel()\n// Since Metadata needs a map to pass into the header of gRPC request create a map for it.\nmetamap := make(map[string]string)\n// Set the username and password\nmetamap[\"username\"] = *username\nmetamap[\"password\"] = *password\n// Set the metadata needed in the metadata package\nmd := metadata.New(metamap)\n// set the ctx to use the metadata in every update.\nctx = metadata.NewOutgoingContext(ctx, md)\n// Try to ping 10 times with a loop\nfor i := 0; i &lt; 10; i++ {\nresponse, err := Sys.Ping(ctx, &amp;system.PingRequest{Destination: *destination})\nif err != nil {\nlog.Fatalf(\"Error trying to ping: %v\", err)\n}\nfmt.Println(response.Recv())\n}\n}\n</code></pre> </p> <p>Output</p> <pre><code>go run ping/ping.go -username admin -password admin -target 172.20.20.2:6030 -destination 2.2.2.2\nsource:\"2.2.2.2\" time:38000 bytes:64 sequence:1 ttl:64 &lt;nil&gt;\nsource:\"2.2.2.2\" time:44000 bytes:64 sequence:1 ttl:64 &lt;nil&gt;\nsource:\"2.2.2.2\" time:37000 bytes:64 sequence:1 ttl:64 &lt;nil&gt;\nsource:\"2.2.2.2\" time:41000 bytes:64 sequence:1 ttl:64 &lt;nil&gt;\nsource:\"2.2.2.2\" time:40000 bytes:64 sequence:1 ttl:64 &lt;nil&gt;\nsource:\"2.2.2.2\" time:38000 bytes:64 sequence:1 ttl:64 &lt;nil&gt;\nsource:\"2.2.2.2\" time:40000 bytes:64 sequence:1 ttl:64 &lt;nil&gt;\nsource:\"2.2.2.2\" time:36000 bytes:64 sequence:1 ttl:64 &lt;nil&gt;\nsource:\"2.2.2.2\" time:44000 bytes:64 sequence:1 ttl:64 &lt;nil&gt;\nsource:\"2.2.2.2\" time:66000 bytes:64 sequence:1 ttl:64 &lt;nil&gt;\n</code></pre>"},{"location":"examples/gnoi/gnoicode/#run-traceroutego","title":"Run traceroute.go","text":""},{"location":"examples/gnoi/gnoicode/#srcgnoitraceroutego","title":"src/gnoi/traceroute.go","text":"Reveal output <p> <pre><code>package main\nimport (\n\"context\"\n\"flag\"\n\"fmt\"\n\"os\"\n\"time\"\nlog \"github.com/golang/glog\"\nsystem \"github.com/openconfig/gnoi/system\"\n\"google.golang.org/grpc\"\n\"google.golang.org/grpc/metadata\"\n)\nfunc checkflags(flag ...string) {\nfor _, f := range flag {\nif f == \"\" {\nfmt.Printf(\"You have an empty flag please fix.\")\nos.Exit(1)\n}\n}\n}\nfunc main() {\n// Add input parameters\nusername := flag.String(\"username\", \"\", \"username for connection to gNOI\")\npassword := flag.String(\"password\", \"\", \"password for connection to gNOI\")\ntarget := flag.String(\"target\", \"\", \"Target ip or hostname of the device running gNOI\")\ndestination := flag.String(\"destination\", \"\", \"Destination of the address to traceroute to\")\nflag.Parse()\nconn, err := grpc.Dial(*target, grpc.WithInsecure())\nif err != nil {\nlog.Exitf(\"Failed to %s Error: %v\", target, err)\n}\ndefer conn.Close()\n// Check for empty flags.\ncheckflags(*username, *password, *target, *destination)\n// Create the new grpc service connection\nSys := system.NewSystemClient(conn)\n// pass in context blank information with the timeout.\nctx, cancel := context.WithTimeout(context.Background(), time.Second)\n// cancel when the function is over.\ndefer cancel()\n// Since Metadata needs a map to pass into the header of gRPC request create a map for it.\nmetamap := make(map[string]string)\n// Set the username and password\nmetamap[\"username\"] = *username\nmetamap[\"password\"] = *password\n// Set the metadata needed in the metadata package\nmd := metadata.New(metamap)\n// set the ctx to use the metadata in every update.\nctx = metadata.NewOutgoingContext(ctx, md)\nresponse, err := Sys.Traceroute(ctx, &amp;system.TracerouteRequest{Destination: *destination})\nif err != nil {\nlog.Fatalf(\"Cannot trace path: %v\", err)\n}\nfmt.Println(response.Recv())\n}\n</code></pre> </p> <p></p> <p>Output</p> <pre><code>go run traceroute/traceroute.go -username admin -password admin -target 172.20.20.2:6030 -destination 2.2.2.2\ndestination_name:\"2.2.2.2\"  destination_address:\"2.2.2.2\"  hops:30  packet_size:60 &lt;nil&gt;\n</code></pre>"},{"location":"examples/gnoi/grpcurl/","title":"gRPCurl examples","text":""},{"location":"examples/gnoi/grpcurl/#grpcurl-overview","title":"gRPCurl overview","text":"<p>gRPCurl is a command-line tool that lets you interact with gRPC servers:</p> <ul> <li>github repository</li> </ul> <p>The following examples shows various gRPCurl commands to interact with Arista EOS devices.</p>"},{"location":"examples/gnoi/grpcurl/#install-grpcurl","title":"Install gRPCurl","text":""},{"location":"examples/gnoi/grpcurl/#install-go","title":"Install GO","text":"<pre><code>$ go version\ngo version go1.16.4 linux/amd64\n</code></pre> <pre><code>go env | grep 'GOROOT\\|GOPATH'\n</code></pre> <pre><code>export GOROOT=/usr/local/go\nexport GOPATH=$HOME/go\nexport PATH=$GOPATH/bin:$GOROOT/bin:$PATH\n</code></pre>"},{"location":"examples/gnoi/grpcurl/#get-gnoi-repository","title":"Get gNOI repository","text":"<pre><code>mkdir -p $GOPATH/src/github.com/openconfig\ngit clone https://github.com/openconfig/gnoi.git $GOPATH/src/github.com/openconfig/gnoi\n</code></pre> <pre><code>$ ls $GOPATH/src/github.com/openconfig\ngnoi\n</code></pre>"},{"location":"examples/gnoi/grpcurl/#install-grpcurl_1","title":"Install gRPCurl","text":"<pre><code>go get github.com/fullstorydev/grpcurl\n</code></pre> <pre><code>ls $GOPATH/pkg/mod/github.com/fullstorydev/\ngrpcurl@v1.8.1\n</code></pre> <pre><code>go install github.com/fullstorydev/grpcurl/cmd/grpcurl@latest\n</code></pre> <pre><code>ls $GOPATH/bin/\ngrpcurl\n</code></pre>"},{"location":"examples/gnoi/grpcurl/#device-config","title":"Device config","text":"<pre><code>interface Management1\n   description oob_management\n   vrf MGMT\n   ip address 192.0.2.118/24\n\nusername arista secret 0 arista\n\nmanagement api gnmi\n   transport grpc def\n      vrf MGMT\n</code></pre> <pre><code>DC1-L2LEAF2A#show management api gnmi\nEnabled:            Yes\nServer:             running on port 6030, in MGMT VRF\nSSL Profile:        none\nQoS DSCP:           none\nDC1-L2LEAF2A#\n</code></pre> <p>Before to use gNOI ping and traceroute, let's run these commands locally:</p> <pre><code>$ ssh arista@192.0.2.118\nPassword:\nLast login: Thu Jun  3 12:06:25 2021 from 192.0.2.3\nDC1-L2LEAF2A&gt;en\nDC1-L2LEAF2A#bash\n\nArista Networks EOS shell\n\n[arista@DC1-L2LEAF2A ~]$ ping  172.31.255.0 -c 2\nPING 172.31.255.0 (172.31.255.0) 56(84) bytes of data.\n64 bytes from 172.31.255.0: icmp_seq=1 ttl=63 time=24.6 ms\n64 bytes from 172.31.255.0: icmp_seq=2 ttl=63 time=18.8 ms\n\n--- 172.31.255.0 ping statistics ---\n2 packets transmitted, 2 received, 0% packet loss, time 1001ms\nrtt min/avg/max/mdev = 18.861/21.738/24.616/2.881 ms\n[arista@DC1-L2LEAF2A ~]$\n[arista@DC1-L2LEAF2A ~]$ traceroute -A 172.31.255.0\ntraceroute to 172.31.255.0 (172.31.255.0), 30 hops max, 60 byte packets\n 1  10.90.90.1 (10.90.90.1) [!!]  26.636 ms  29.420 ms  32.113 ms\n 2  172.31.255.0 (172.31.255.0) [!!]  52.764 ms  53.881 ms  63.213 ms\n[arista@DC1-L2LEAF2A ~]$\n[arista@DC1-L2LEAF2A ~]$ exit\nlogout\nDC1-L2LEAF2A#exit\nConnection to 192.0.2.118 closed.\n</code></pre>"},{"location":"examples/gnoi/grpcurl/#use-grpcurl","title":"Use gRPCurl","text":""},{"location":"examples/gnoi/grpcurl/#describe-from-a-proto-file","title":"Describe from a proto file","text":""},{"location":"examples/gnoi/grpcurl/#describe-cancelreboot-method","title":"Describe CancelReboot method","text":"<pre><code>grpcurl --plaintext  --import-path ${GOPATH}/src --proto github.com/openconfig/gnoi/system/system.proto  \\\ndescribe  gnoi.system.System.CancelReboot\n</code></pre> <p>Output:</p> <pre><code>gnoi.system.System.CancelReboot is a method:\n// CancelReboot cancels any pending reboot request.\nrpc CancelReboot ( .gnoi.system.CancelRebootRequest ) returns ( .gnoi.system.CancelRebootResponse );\n</code></pre>"},{"location":"examples/gnoi/grpcurl/#describe-system-service","title":"Describe System service","text":"<pre><code>$ grpcurl --plaintext  --import-path ${GOPATH}/src --proto github.com/openconfig/gnoi/system/system.proto  \\\ndescribe  gnoi.system.System\n</code></pre> <p>Output:</p> <pre><code>gnoi.system.System is a service:\n// The gNOI service is a collection of operational RPC's that allow for the\n// management of a target outside of the configuration and telemetry pipeline.\nservice System {\n// CancelReboot cancels any pending reboot request.\n  rpc CancelReboot ( .gnoi.system.CancelRebootRequest ) returns ( .gnoi.system.CancelRebootResponse );\n// Ping executes the ping command on the target and streams back\n  // the results.  Some targets may not stream any results until all\n  // results are in.  If a packet count is not explicitly provided,\n  // 5 is used.\n  rpc Ping ( .gnoi.system.PingRequest ) returns ( stream .gnoi.system.PingResponse );\n// Reboot causes the target to reboot, possibly at some point in the future.\n  // If the method of reboot is not supported then the Reboot RPC will fail.\n  // If the reboot is immediate the command will block until the subcomponents\n  // have restarted.\n  // If a reboot on the active control processor is pending the service must\n  // reject all other reboot requests.\n  // If a reboot request for active control processor is initiated with other\n  // pending reboot requests it must be rejected.\n  rpc Reboot ( .gnoi.system.RebootRequest ) returns ( .gnoi.system.RebootResponse );\n// RebootStatus returns the status of reboot for the target.\n  rpc RebootStatus ( .gnoi.system.RebootStatusRequest ) returns ( .gnoi.system.RebootStatusResponse );\n// SetPackage places a software package (possibly including bootable images)\n// on the target. The file is sent in sequential messages, each message\n  // up to 64KB of data. A final message must be sent that includes the hash\n// of the data sent. An error is returned if the location does not exist or\n  // there is an error writing the data. If no checksum is received, the target\n  // must assume the operation is incomplete and remove the partially\n  // transmitted file. The target should initially write the file to a temporary\n  // location so a failure does not destroy the original file.\n  rpc SetPackage ( stream .gnoi.system.SetPackageRequest ) returns ( .gnoi.system.SetPackageResponse );\n// SwitchControlProcessor will switch from the current route processor to the\n  // provided route processor. If the current route processor is the same as the\n  // one provided it is a NOOP. If the target does not exist an error is\n  // returned.\n  rpc SwitchControlProcessor ( .gnoi.system.SwitchControlProcessorRequest ) returns ( .gnoi.system.SwitchControlProcessorResponse );\n// Time returns the current time on the target.  Time is typically used to\n  // test if a target is actually responding.\n  rpc Time ( .gnoi.system.TimeRequest ) returns ( .gnoi.system.TimeResponse );\n// Traceroute executes the traceroute command on the target and streams back\n  // the results.  Some targets may not stream any results until all\n  // results are in.  If a hop count is not explicitly provided,\n  // 30 is used.\n  rpc Traceroute ( .gnoi.system.TracerouteRequest ) returns ( stream .gnoi.system.TracerouteResponse );\n}\n</code></pre>"},{"location":"examples/gnoi/grpcurl/#list","title":"List","text":""},{"location":"examples/gnoi/grpcurl/#list-from-a-proto-file","title":"List from a proto file","text":"<p>Example 1)</p> <pre><code>grpcurl --plaintext  --import-path ${GOPATH}/src \\\n--proto github.com/openconfig/gnoi/system/system.proto list\n</code></pre> <p>Output:</p> <pre><code>gnoi.system.System\n</code></pre> <p>Example 2)</p> <pre><code>grpcurl --plaintext  --import-path ${GOPATH}/src \\\n--proto github.com/openconfig/gnoi/system/system.proto \\\nlist gnoi.system.System\n</code></pre> <p>Output:</p> <pre><code>gnoi.system.System.CancelReboot\ngnoi.system.System.Ping\ngnoi.system.System.Reboot\ngnoi.system.System.RebootStatus\ngnoi.system.System.SetPackage\ngnoi.system.System.SwitchControlProcessor\ngnoi.system.System.Time\ngnoi.system.System.Traceroute\n</code></pre> <p>Example 3)</p> <pre><code>grpcurl --plaintext  --import-path ${GOPATH}/src \\\n--proto github.com/openconfig/gnoi/os/os.proto list gnoi.os.OS\n</code></pre> <p>Output:</p> <pre><code>gnoi.os.OS.Activate\ngnoi.os.OS.Install\ngnoi.os.OS.Verify\n</code></pre>"},{"location":"examples/gnoi/grpcurl/#list-from-a-grpc-server-eos-device","title":"List from a gRPC server (EOS device)","text":"<pre><code>$ grpcurl --plaintext 192.0.2.105:6030 list\ngnmi.gNMI\ngnoi.certificate.CertificateManagement\ngnoi.system.System\ngrpc.reflection.v1alpha.ServerReflection\n</code></pre>"},{"location":"examples/gnoi/grpcurl/#execute-gnoi-rpc-with-eos","title":"Execute gNOI RPC with EOS","text":"<pre><code>grpcurl -H 'username: arista'  -H 'password: arista' \\\n-d '{\"destination\": \"172.31.255.0\", \"count\": 2, \"do_not_resolve\":true}' \\\n-import-path ${GOPATH}/src -proto github.com/openconfig/gnoi/system/system.proto \\\n-plaintext 192.0.2.118:6030 gnoi.system.System/Ping\n</code></pre> <p>Output:</p> <pre><code>{\n\"source\": \"172.31.255.0\",\n  \"time\": \"29800000\",\n  \"bytes\": 64,\n  \"sequence\": 1,\n  \"ttl\": 63\n}\n{\n\"source\": \"172.31.255.0\",\n  \"time\": \"25200000\",\n  \"bytes\": 64,\n  \"sequence\": 2,\n  \"ttl\": 63\n}\n{\n\"source\": \"172.31.255.0\",\n  \"time\": \"1001000000\",\n  \"sent\": 2,\n  \"received\": 2,\n  \"minTime\": \"25210000\",\n  \"avgTime\": \"27510000\",\n  \"maxTime\": \"29810000\",\n  \"stdDev\": \"2300000\"\n}\n</code></pre> <pre><code>grpcurl -H 'username: arista'  -H 'password: arista' \\\n-d '{\"destination\": \"172.31.255.0\", \"max_ttl\": 50, \"do_not_resolve\":true}' \\\n-import-path ${GOPATH}/src -proto github.com/openconfig/gnoi/system/system.proto \\\n-plaintext 192.0.2.118:6030 gnoi.system.System/Traceroute\n</code></pre> <p>Output:</p> <pre><code>{\n\"destinationName\": \"172.31.255.0\",\n  \"destinationAddress\": \"172.31.255.0\",\n  \"hops\": 50,\n  \"packetSize\": 60\n}\n{\n\"hop\": 1,\n  \"address\": \"10.90.90.1\",\n  \"rtt\": \"16589000\"\n}\n{\n\"hop\": 1,\n  \"address\": \"10.90.90.1\",\n  \"rtt\": \"17886000\"\n}\n{\n\"hop\": 1,\n  \"address\": \"10.90.90.1\",\n  \"rtt\": \"23219000\"\n}\n{\n\"hop\": 2,\n  \"address\": \"172.31.255.0\",\n  \"rtt\": \"46537000\"\n}\n{\n\"hop\": 2,\n  \"address\": \"172.31.255.0\",\n  \"rtt\": \"47873000\"\n}\n{\n\"hop\": 2,\n  \"address\": \"172.31.255.0\",\n  \"rtt\": \"55376000\"\n}\n</code></pre>"},{"location":"examples/golang/","title":"golang","text":""},{"location":"examples/golang/#overview","title":"Overview","text":"<p>The following example uses the goarista go module for gNMI to interact with a device. Within this very simplistic getting started example main.go will simply perform a get method to the device for all paths.</p> <pre><code>package main\nimport (\n\"context\"\n\"fmt\"\n\"github.com/aristanetworks/glog\"\n\"github.com/aristanetworks/goarista/gnmi\"\npb \"github.com/openconfig/gnmi/proto/gnmi\"\n)\nvar cfg = &amp;gnmi.Config{\nAddr:     \"10.20.30.67:6030\",\nUsername: \"ansible\",\nPassword: \"ansible\",\n}\nfunc main() {\npaths := []string{\"/\"}\nvar origin = \"openconfig\"\n//var origin = \"eos_native\"\nctx := gnmi.NewContext(context.Background(), cfg)\nclient, err := gnmi.Dial(cfg)\nif err != nil {\nglog.Fatal(err)\n}\nreq, err := gnmi.NewGetRequest(gnmi.SplitPaths(paths), origin)\nif err != nil {\nglog.Fatal(err)\n}\nif cfg.Addr != \"\" {\nif req.Prefix == nil {\nreq.Prefix = &amp;pb.Path{}\n}\nreq.Prefix.Target = cfg.Addr\n}\nerr = gnmi.GetWithRequest(ctx, client, req)\nif err != nil {\nglog.Fatal(err)\n}\nfmt.Println(err)\n}\n</code></pre> <p>Copy the above code into a file and run via the following command.</p> <pre><code>go run main.go\n</code></pre>"},{"location":"examples/golang/#truncated-output","title":"Truncated output","text":"<pre><code>{\n\"openconfig-acl:acl\": {\n\"state\": {\n\"counter-capability\": \"AGGREGATE_ONLY\"\n}\n},\n\"arista-exp-eos:arista\": {\n\"eos\": {\n\"arista-exp-eos-igmpsnooping:bridging\": {\n\"igmpsnooping\": {\n\"config\": {}\n}\n},\n\"arista-exp-eos-mlag:mlag\": {\n\"config\": {\n\"dual-primary-action\": \"action-none\",\n</code></pre>"},{"location":"examples/netconf/","title":"About NETCONF","text":""},{"location":"examples/netconf/#about-netconf","title":"About NETCONF","text":"<p>NETCONF is a protocol defined in the RFC 6241</p>"},{"location":"examples/netconf/ncclient/","title":"ncclient examples","text":""},{"location":"examples/netconf/ncclient/#install-ncclient","title":"Install ncclient","text":"<pre><code>pip install ncclient\n</code></pre> <pre><code>pip3 freeze | grep ncclient\n</code></pre>"},{"location":"examples/netconf/ncclient/#requirements-on-the-eos-device","title":"Requirements on the EOS device","text":"<pre><code>switch1#show running-config section netconf\nmanagement api netconf\n   transport ssh test\nvrf MGMT\n</code></pre> <pre><code>switch1#sh management api netconf\nEnabled:            Yes\nServer:             running on port 830, in MGMT VRF\n</code></pre>"},{"location":"examples/netconf/ncclient/#ncclient-demo","title":"ncclient demo","text":""},{"location":"examples/netconf/ncclient/#interactive-python-session","title":"interactive python session","text":"<pre><code>&gt;&gt;&gt; from ncclient import manager\n&gt;&gt;&gt; eos=manager.connect(host=\"198.51.100.221\", port=\"830\", timeout=30, username=\"arista\", password=\"arista\", hostkey_verify=False)\n&gt;&gt;&gt;\n&gt;&gt;&gt; eos.connected\nTrue\n&gt;&gt;&gt; eos.timeout\n30\n&gt;&gt;&gt; eos.session_id\n'1292406600'\n&gt;&gt;&gt;\n&gt;&gt;&gt; assert(\"urn:ietf:params:xml:ns:yang:ietf-netconf-monitoring\" in eos.server_capabilities), \"NetConf server not compliant with https://tools.ietf.org/html/rfc6022\"\n&gt;&gt;&gt;\n&gt;&gt;&gt; conf = '''\n... &lt;config&gt;\n...     &lt;system xmlns=\"http://openconfig.net/yang/system\"&gt;\n...         &lt;config&gt;\n...             &lt;domain-name&gt;abc.xyz&lt;/domain-name&gt;\n...         &lt;/config&gt;\n...     &lt;/system&gt;\n... &lt;/config&gt;\n... '''\n&gt;&gt;&gt;\n&gt;&gt;&gt; eos.edit_config(target = \"running\", config = conf, default_operation=\"merge\")\n&lt;rpc-reply xmlns=\"urn:ietf:params:xml:ns:netconf:base:1.0\" message-id=\"urn:uuid:33ca18d3-43b5-4277-a6ce-9a751f74cada\"&gt;&lt;ok&gt;&lt;/ok&gt;&lt;/rpc-reply&gt;\n&gt;&gt;&gt;\n&gt;&gt;&gt; domain_name='''\n... &lt;system xmlns=\"http://openconfig.net/yang/system\"&gt;\n...     &lt;config&gt;\n...         &lt;domain-name&gt;\n...         &lt;/domain-name&gt;\n...     &lt;/config&gt;\n... &lt;/system&gt;\n... '''\n&gt;&gt;&gt;\n&gt;&gt;&gt; domain_name_conf = eos.get_config(source=\"running\", filter=(\"subtree\", domain_name))\n&gt;&gt;&gt; print (domain_name_conf)\n&lt;rpc-reply xmlns=\"urn:ietf:params:xml:ns:netconf:base:1.0\" message-id=\"urn:uuid:a43cfae5-3215-4f99-97ce-ff61ca1e285c\"&gt;&lt;data time-modified=\"2021-07-11T12:29:49.133333939Z\"&gt;&lt;system xmlns=\"http://openconfig.net/yang/system\"&gt;&lt;config&gt;&lt;domain-name&gt;abc.xyz&lt;/domain-name&gt;&lt;/config&gt;&lt;/system&gt;&lt;/data&gt;&lt;/rpc-reply&gt;\n&gt;&gt;&gt;\n&gt;&gt;&gt; eos.close_session()\n&lt;rpc-reply xmlns=\"urn:ietf:params:xml:ns:netconf:base:1.0\" message-id=\"urn:uuid:1841896a-9c97-467d-aef8-9a405b51d298\"&gt;&lt;ok&gt;&lt;/ok&gt;&lt;/rpc-reply&gt;\n&gt;&gt;&gt;\n&gt;&gt;&gt; eos.connected\nFalse\n&gt;&gt;&gt;\n&gt;&gt;&gt; exit()\n</code></pre> <pre><code>&gt;&gt;&gt; from lxml import etree\n&gt;&gt;&gt;\n&gt;&gt;&gt; system_e = etree.Element(\"system\")\n&gt;&gt;&gt; dns_e = etree.SubElement(system_e, \"dns\")\n&gt;&gt;&gt; servers_e = etree.SubElement(dns_e, \"servers\")\n&gt;&gt;&gt; server_e = etree.SubElement(servers_e, \"server\")\n&gt;&gt;&gt; address_e = etree.SubElement(server_e, \"address\")\n&gt;&gt;&gt; config_e = etree.SubElement(server_e, \"config\")\n&gt;&gt;&gt; address_e.text = \"8.8.8.8\"\n&gt;&gt;&gt;\n&gt;&gt;&gt; address_e.text\n'8.8.8.8'\n&gt;&gt;&gt;\n&gt;&gt;&gt; etree.tostring(system_e)\nb'&lt;system&gt;&lt;dns&gt;&lt;servers&gt;&lt;server&gt;&lt;address&gt;8.8.8.8&lt;/address&gt;&lt;config/&gt;&lt;/server&gt;&lt;/servers&gt;&lt;/dns&gt;&lt;/system&gt;'\n&gt;&gt;&gt;\n&gt;&gt;&gt; etree.tostring(system_e, pretty_print = True)\nb'&lt;system&gt;\\n  &lt;dns&gt;\\n    &lt;servers&gt;\\n      &lt;server&gt;\\n        &lt;address&gt;8.8.8.8&lt;/address&gt;\\n        &lt;config/&gt;\\n      &lt;/server&gt;\\n    &lt;/servers&gt;\\n  &lt;/dns&gt;\\n&lt;/system&gt;\\n'\n&gt;&gt;&gt;\n&gt;&gt;&gt; etree.dump(system_e)\n&lt;system&gt;\n&lt;dns&gt;\n&lt;servers&gt;\n&lt;server&gt;\n&lt;address&gt;8.8.8.8&lt;/address&gt;\n&lt;config/&gt;\n&lt;/server&gt;\n&lt;/servers&gt;\n&lt;/dns&gt;\n&lt;/system&gt;\n&gt;&gt;&gt;\n&gt;&gt;&gt; from ncclient import manager\n&gt;&gt;&gt; eos=manager.connect(host=\"198.51.100.221\", port=\"830\", timeout=30, username=\"arista\", password=\"arista\", hostkey_verify=False)\n&gt;&gt;&gt; eos.connected\nTrue\n&gt;&gt;&gt;\n&gt;&gt;&gt; print(eos.get_config(source=\"running\", filter=(\"subtree\", system_e)))\n&lt;rpc-reply xmlns=\"urn:ietf:params:xml:ns:netconf:base:1.0\" message-id=\"urn:uuid:ab16e734-04df-4d4f-8efe-27963ece586c\"&gt;&lt;data time-modified=\"2021-07-11T12:29:49.138275819Z\"&gt;&lt;system xmlns=\"http://openconfig.net/yang/system\"&gt;&lt;dns&gt;&lt;servers&gt;&lt;server&gt;&lt;address&gt;8.8.8.8&lt;/address&gt;&lt;config&gt;&lt;address&gt;8.8.8.8&lt;/address&gt;&lt;/config&gt;&lt;/server&gt;&lt;/servers&gt;&lt;/dns&gt;&lt;/system&gt;&lt;/data&gt;&lt;/rpc-reply&gt;\n&gt;&gt;&gt;\n&gt;&gt;&gt; eos.close_session()\n&lt;rpc-reply xmlns=\"urn:ietf:params:xml:ns:netconf:base:1.0\" message-id=\"urn:uuid:2eed88ee-106b-44d1-b196-f79611512b25\"&gt;&lt;ok&gt;&lt;/ok&gt;&lt;/rpc-reply&gt;\n&gt;&gt;&gt;\n&gt;&gt;&gt; exit()\n</code></pre>"},{"location":"examples/netconf/ncclient/#other-demos","title":"Other demos","text":"<p>There are many python scripts using ncclient in this directory.</p> <p>To execute one of these scripts, run as example this command:</p> <pre><code>python3 print_server_capabilities.py\n</code></pre>"},{"location":"examples/netconf/ncclient/#capabilities","title":"Capabilities","text":"<ul> <li>print_client_capabilities.py   prints the NETCONF client capabilities.</li> <li>print_server_capabilities.py   prints the NETCONF server capabilities.</li> </ul>"},{"location":"examples/netconf/ncclient/#get-operation","title":"get operation","text":"<ul> <li>get.py uses the <code>get</code> operation to   retrieve the configuration and state data. It uses a filter to specify the portion of the configuration and state data   to retrieve.</li> </ul>"},{"location":"examples/netconf/ncclient/#get-config-operation","title":"get-config operation","text":"<ul> <li>get_config.py uses the <code>get-config</code>   operation with a filter to retrieve part of the configuration.</li> </ul>"},{"location":"examples/netconf/ncclient/#edit-config-operation","title":"edit-config operation","text":"<ul> <li>edit_config_merge.py uses   the <code>edit-config</code> operation with the <code>merge</code> operation (which is the default operation for <code>edit-config</code>)</li> <li>edit_config_replace.py   uses the <code>edit-config</code> operation with the <code>replace</code> operation</li> <li>edit_config_delete.py uses   the <code>edit-config</code> operation with the <code>delete</code> operation</li> <li>EOS_commands_with_NETCONF.py   configures a device using the <code>edit-config</code> operation and EOS data model</li> <li>candidate_configuration_commit.py   uses the <code>edit-config</code> operation with the <code>candidate</code> configuration datastore. It uses a <code>lock</code> operation and <code>commit</code>   operation.</li> <li> <p>candidate_configuration_discard_changes.py.   uses the <code>edit-config</code> operation with the <code>candidate</code> configuration datastore. It uses a <code>lock</code> operation and   <code>discard_change</code> operation to revert the candidate configuration to the current running configuration (insteaf of   commiting the candidate configuration).  #### XML output parsing</p> </li> <li> <p>parse_xml_output.py uses the   <code>get</code> operation to retrieve data from the device and then parse this data.</p> </li> </ul>"},{"location":"examples/netconf/ncclient/#rpc","title":"RPC","text":"<ul> <li>rpc.py sends RPCs to configure EOS   devices.</li> </ul>"},{"location":"examples/netconf/netconf_over_ssh/","title":"NETCONF over SSH","text":""},{"location":"examples/netconf/netconf_over_ssh/#requirements-on-the-eos-device","title":"Requirements on the EOS device","text":"<pre><code>switch1#show running-config section netconf\nmanagement api netconf\n   transport ssh test\nvrf MGMT\n</code></pre> <pre><code>switch1#sh management api netconf\nEnabled:            Yes\nServer:             running on port 830, in MGMT VRF\n</code></pre>"},{"location":"examples/netconf/netconf_over_ssh/#about-netconf-over-ssh","title":"About NETCONF over SSH","text":"<ul> <li>NETCONF over SSH is discussed in the RFC 6242</li> </ul> <p>In order to open a NETCONF session inside an SSH connection, there are two options:</p> <ul> <li>we can invoke the NETCONF subsystem using the following SSH command<ul> <li><code>ssh username@device -s netconf</code></li> </ul> </li> <li>we can establish an SSH connection to an EOS device (NETCONF server), and then run the EOS command<ul> <li><code>netconf start-client</code></li> </ul> </li> </ul>"},{"location":"examples/netconf/netconf_over_ssh/#netconf-over-ssh-demo","title":"NETCONF over SSH demo","text":""},{"location":"examples/netconf/netconf_over_ssh/#start-a-netconf-over-ssh-session","title":"Start a NETCONF over SSH session","text":"<pre><code>s70515#netconf start-client\n</code></pre>"},{"location":"examples/netconf/netconf_over_ssh/#advertise-the-client-capabilities","title":"Advertise the client capabilities","text":"<p>Once the NETCONF session is open, the NETCONF server (EOS device) advertises its capabilities.</p> <p>You must advertise the client capabilities. Example:</p> <pre><code>&lt;hello xmlns=\"urn:ietf:params:xml:ns:netconf:base:1.0\"&gt;\n&lt;capabilities&gt;\n&lt;capability&gt;urn:ietf:params:netconf:base:1.0&lt;/capability&gt;\n&lt;capability&gt;urn:ietf:params:netconf:capability:candidate:1.0&lt;/capability&gt;\n&lt;capability&gt;urn:ietf:params:netconf:capability:confimed-commit:1.0&lt;/capability&gt;\n&lt;capability&gt;urn:ietf:params:netconf:capability:writable-running:1.0&lt;/capability&gt;\n&lt;capability&gt;urn:ietf:params:netconf:capability:validate:1.0&lt;/capability&gt;\n&lt;/capabilities&gt;\n&lt;/hello&gt;\n]]&gt;]]&gt;\n</code></pre>"},{"location":"examples/netconf/netconf_over_ssh/#get-all-configuration-and-state-data","title":"Get all configuration and state data","text":"<pre><code>&lt;rpc xmlns=\"urn:ietf:params:xml:ns:netconf:base:1.0\" message-id=\"1\"&gt;\n&lt;get&gt;\n&lt;/get&gt;\n&lt;/rpc&gt;\n]]&gt;]]&gt;\n</code></pre>"},{"location":"examples/netconf/netconf_over_ssh/#get-the-operational-status-of-an-interface","title":"Get the operational status of an Interface","text":"<pre><code>&lt;rpc xmlns=\"urn:ietf:params:xml:ns:netconf:base:1.0\" message-id=\"2\"&gt;\n&lt;get&gt;\n&lt;filter type=\"subtree\"&gt;\n&lt;interfaces&gt;\n&lt;interface&gt;\n&lt;name&gt;Ethernet3&lt;/name&gt;\n&lt;state&gt;\n&lt;oper-status&gt;\n&lt;/oper-status&gt;\n&lt;/state&gt;\n&lt;/interface&gt;\n&lt;/interfaces&gt;\n&lt;/filter&gt;\n&lt;/get&gt;\n&lt;/rpc&gt;\n]]&gt;]]&gt;\n</code></pre>"},{"location":"examples/netconf/netconf_over_ssh/#get-the-whole-running-configuration","title":"Get the whole running configuration","text":"<pre><code>&lt;rpc xmlns=\"urn:ietf:params:xml:ns:netconf:base:1.0\" message-id=\"3\"&gt;\n&lt;get-config&gt;\n&lt;source&gt;\n&lt;running/&gt;\n&lt;/source&gt;\n&lt;/get-config&gt;\n&lt;/rpc&gt;\n]]&gt;]]&gt;\n</code></pre>"},{"location":"examples/netconf/netconf_over_ssh/#get-the-running-configuration-of-an-interface","title":"Get the running configuration of an interface","text":"<pre><code>&lt;rpc xmlns=\"urn:ietf:params:xml:ns:netconf:base:1.0\" message-id=\"4\"&gt;\n&lt;get-config&gt;\n&lt;source&gt;\n&lt;running/&gt;\n&lt;/source&gt;\n&lt;filter&gt;\n&lt;interfaces&gt;\n&lt;interface&gt;\n&lt;name&gt;Ethernet3&lt;/name&gt;\n&lt;/interface&gt;\n&lt;/interfaces&gt;\n&lt;/filter&gt;\n&lt;/get-config&gt;\n&lt;/rpc&gt;\n]]&gt;]]&gt;\n</code></pre>"},{"location":"examples/netconf/netconf_over_ssh/#get-the-interface-description-from-the-running-configuration","title":"Get the interface description from the running configuration","text":"<pre><code>&lt;rpc xmlns=\"urn:ietf:params:xml:ns:netconf:base:1.0\" message-id=\"5\"&gt;\n&lt;get-config&gt;\n&lt;source&gt;\n&lt;running/&gt;\n&lt;/source&gt;\n&lt;filter&gt;\n&lt;interfaces&gt;\n&lt;interface&gt;\n&lt;name&gt;Ethernet3&lt;/name&gt;\n&lt;config&gt;\n&lt;description&gt;\n&lt;/description&gt;\n&lt;/config&gt;\n&lt;/interface&gt;\n&lt;/interfaces&gt;\n&lt;/filter&gt;\n&lt;/get-config&gt;\n&lt;/rpc&gt;\n]]&gt;]]&gt;\n</code></pre>"},{"location":"examples/netconf/netconf_over_ssh/#lock-the-running-configuration","title":"Lock the running configuration","text":"<pre><code>&lt;rpc xmlns=\"urn:ietf:params:xml:ns:netconf:base:1.0\" message-id=\"6\"&gt;\n&lt;lock&gt;\n&lt;target&gt;\n&lt;running/&gt;\n&lt;/target&gt;\n&lt;/lock&gt;\n&lt;/rpc&gt;\n]]&gt;]]&gt;\n</code></pre>"},{"location":"examples/netconf/netconf_over_ssh/#edit-the-running-configuration-using-eos-native-data-model","title":"Edit the running configuration using EOS native data model","text":"<pre><code>&lt;rpc xmlns=\"urn:ietf:params:xml:ns:netconf:base:1.0\" message-id=\"7\"&gt;\n&lt;edit-config&gt;\n&lt;target&gt;\n&lt;running/&gt;\n&lt;/target&gt;\n&lt;default-operation&gt;merge&lt;/default-operation&gt;\n&lt;commands&gt;\n&lt;command&gt;vlan 198&lt;/command&gt;\n&lt;command&gt;name test198&lt;/command&gt;\n&lt;command&gt;interface ethernet6&lt;/command&gt;\n&lt;command&gt;description test&lt;/command&gt;\n&lt;command&gt;switchport access vlan 98&lt;/command&gt;\n&lt;/commands&gt;\n&lt;/edit-config&gt;\n&lt;/rpc&gt;\n]]&gt;]]&gt;\n</code></pre>"},{"location":"examples/netconf/netconf_over_ssh/#edit-the-running-configuration-using-openconfig-data-model","title":"Edit the running configuration using OpenConfig data model","text":"<pre><code>&lt;rpc xmlns=\"urn:ietf:params:xml:ns:netconf:base:1.0\" message-id=\"8\"&gt;\n&lt;edit-config&gt;\n&lt;target&gt;\n&lt;running/&gt;\n&lt;/target&gt;\n&lt;default-operation&gt;merge&lt;/default-operation&gt;\n&lt;config&gt;\n&lt;interfaces&gt;\n&lt;interface&gt;\n&lt;name&gt;Ethernet4&lt;/name&gt;\n&lt;config&gt;\n&lt;description&gt;This is the best interface&lt;/description&gt;\n&lt;/config&gt;\n&lt;/interface&gt;\n&lt;/interfaces&gt;\n&lt;/config&gt;\n&lt;/edit-config&gt;\n&lt;/rpc&gt;\n]]&gt;]]&gt;\n</code></pre>"},{"location":"examples/netconf/netconf_over_ssh/#edit-the-running-configuration-to-delete-an-existing-existing-data","title":"Edit the running configuration to delete an existing existing data","text":"<pre><code>&lt;rpc xmlns=\"urn:ietf:params:xml:ns:netconf:base:1.0\" message-id=\"9\"&gt;\n&lt;edit-config&gt;\n&lt;target&gt;\n&lt;running/&gt;\n&lt;/target&gt;\n&lt;default-operation&gt;none&lt;/default-operation&gt;\n&lt;config&gt;\n&lt;system xmlns=\"http://arista.com/yang/openconfig/system/\"&gt;\n&lt;dns&gt;\n&lt;servers&gt;\n&lt;server&gt;\n&lt;address operation=\"delete\"&gt;1.1.1.1&lt;/address&gt;\n&lt;/server&gt;\n&lt;/servers&gt;\n&lt;/dns&gt;\n&lt;/system&gt;\n&lt;/config&gt;\n&lt;/edit-config&gt;\n&lt;/rpc&gt;\n]]&gt;]]&gt;\n</code></pre>"},{"location":"examples/netconf/netconf_over_ssh/#unlock-the-running-configuration","title":"Unlock the running configuration","text":"<pre><code>&lt;rpc xmlns=\"urn:ietf:params:xml:ns:netconf:base:1.0\" message-id=\"10\"&gt;\n&lt;unlock&gt;\n&lt;target&gt;\n&lt;running/&gt;\n&lt;/target&gt;\n&lt;/unlock&gt;\n&lt;/rpc&gt;\n]]&gt;]]&gt;\n</code></pre>"},{"location":"examples/netconf/netconf_over_ssh/#save-running-configuration-on-the-flash","title":"Save running configuration on the flash","text":"<pre><code>&lt;rpc xmlns=\"urn:ietf:params:xml:ns:netconf:base:1.0\" message-id=\"11\"&gt;\n&lt;copy-config&gt;\n&lt;target&gt;\n&lt;url&gt;\nflash:/test.cfg\n      &lt;/url&gt;\n&lt;/target&gt;\n&lt;source&gt;\n&lt;running/&gt;\n&lt;/source&gt;\n&lt;/copy-config&gt;\n&lt;/rpc&gt;\n]]&gt;]]&gt;\n</code></pre>"},{"location":"examples/netconf/netconf_over_ssh/#copy-the-running-configuration-datastore-to-the-startup-configuration-datastore","title":"Copy the running configuration datastore to the startup configuration datastore","text":"<pre><code>&lt;rpc xmlns=\"urn:ietf:params:xml:ns:netconf:base:1.0\" message-id=\"12\"&gt;\n&lt;copy-config&gt;\n&lt;target&gt;\n&lt;startup/&gt;\n&lt;/target&gt;\n&lt;source&gt;\n&lt;running/&gt;\n&lt;/source&gt;\n&lt;/copy-config&gt;\n&lt;/rpc&gt;\n]]&gt;]]&gt;\n</code></pre>"},{"location":"examples/netconf/netconf_over_ssh/#lock-the-candidate-configuration","title":"Lock the candidate configuration","text":"<pre><code>&lt;rpc xmlns=\"urn:ietf:params:xml:ns:netconf:base:1.0\" message-id=\"13\"&gt;\n&lt;lock&gt;\n&lt;target&gt;\n&lt;candidate/&gt;\n&lt;/target&gt;\n&lt;/lock&gt;\n&lt;/rpc&gt;\n]]&gt;]]&gt;\n</code></pre>"},{"location":"examples/netconf/netconf_over_ssh/#edit-the-candidate-configuration-edit-interface-description","title":"Edit the candidate configuration - edit interface description","text":"<pre><code>&lt;rpc xmlns=\"urn:ietf:params:xml:ns:netconf:base:1.0\" message-id=\"14\"&gt;\n&lt;edit-config&gt;\n&lt;target&gt;\n&lt;candidate/&gt;\n&lt;/target&gt;\n&lt;default-operation&gt;merge&lt;/default-operation&gt;\n&lt;config&gt;\n&lt;interfaces&gt;\n&lt;interface&gt;\n&lt;name&gt;Ethernet5/1&lt;/name&gt;\n&lt;config&gt;\n&lt;description&gt;This is the best interface&lt;/description&gt;\n&lt;/config&gt;\n&lt;/interface&gt;\n&lt;/interfaces&gt;\n&lt;/config&gt;\n&lt;/edit-config&gt;\n&lt;/rpc&gt;\n]]&gt;]]&gt;\n</code></pre>"},{"location":"examples/netconf/netconf_over_ssh/#commit-the-configuration-change-from-the-candidate-to-the-running-configuration","title":"Commit the configuration change (from the candidate to the running configuration)","text":"<pre><code>&lt;rpc xmlns=\"urn:ietf:params:xml:ns:netconf:base:1.0\" message-id=\"15\"&gt;\n&lt;commit/&gt;\n&lt;/rpc&gt;\n]]&gt;]]&gt;\n</code></pre>"},{"location":"examples/netconf/netconf_over_ssh/#unlock-the-candidate-configuration","title":"Unlock the candidate configuration","text":"<pre><code>&lt;rpc xmlns=\"urn:ietf:params:xml:ns:netconf:base:1.0\" message-id=\"20\"&gt;\n&lt;unlock&gt;\n&lt;target&gt;\n&lt;candidate/&gt;\n&lt;/target&gt;\n&lt;/unlock&gt;\n&lt;/rpc&gt;\n]]&gt;]]&gt;\n</code></pre>"},{"location":"examples/netconf/netconf_over_ssh/#edit-the-candidate-configuration-set-hostname","title":"Edit the candidate configuration - set hostname","text":"<pre><code>&lt;rpc xmlns=\"urn:ietf:params:xml:ns:netconf:base:1.0\" message-id=\"21\"&gt;\n&lt;edit-config&gt;\n&lt;target&gt;\n&lt;candidate/&gt;\n&lt;/target&gt;\n&lt;default-operation&gt;merge&lt;/default-operation&gt;\n&lt;config&gt;\n&lt;system&gt;\n&lt;config&gt;\n&lt;hostname&gt;test&lt;/hostname&gt;\n&lt;/config&gt;\n&lt;/system&gt;\n&lt;/config&gt;\n&lt;/edit-config&gt;\n&lt;/rpc&gt;\n]]&gt;]]&gt;\n</code></pre>"},{"location":"examples/netconf/netconf_over_ssh/#get-part-of-the-candidate-configuration","title":"Get part of the candidate configuration","text":"<pre><code>&lt;rpc xmlns=\"urn:ietf:params:xml:ns:netconf:base:1.0\" message-id=\"5\"&gt;\n&lt;get-config&gt;\n&lt;source&gt;\n&lt;candidate/&gt;\n&lt;/source&gt;\n&lt;filter&gt;\n&lt;system&gt;\n&lt;config&gt;\n&lt;hostname&gt;&lt;/hostname&gt;\n&lt;/config&gt;\n&lt;/system&gt;\n&lt;/filter&gt;\n&lt;/get-config&gt;\n&lt;/rpc&gt;\n]]&gt;]]&gt;\n</code></pre>"},{"location":"examples/netconf/netconf_over_ssh/#revert-the-candidate-configuration-to-the-current-running-configuration","title":"Revert the candidate configuration to the current running configuration","text":"<p>If you decide to not commit the candidate configuration, you can revert the candidate configuration to the current running configuration</p> <pre><code>&lt;rpc xmlns=\"urn:ietf:params:xml:ns:netconf:base:1.0\" message-id=\"90\"&gt;\n&lt;discard-changes/&gt;\n&lt;/rpc&gt;\n]]&gt;]]&gt;\n</code></pre>"},{"location":"examples/netconf/netconf_over_ssh/#close-the-session","title":"Close the session","text":"<pre><code>&lt;rpc xmlns=\"urn:ietf:params:xml:ns:netconf:base:1.0\" message-id=\"100\"&gt;\n&lt;close-session&gt;\n&lt;/close-session&gt;\n&lt;/rpc&gt;\n]]&gt;]]&gt;\n</code></pre>"},{"location":"examples/pyang/","title":"pyang examples","text":""},{"location":"examples/pyang/#about-pyang","title":"About Pyang","text":"<p>pyang is a python program.</p> <p>We can use it to:</p> <ul> <li>Validate YANG modules against YANG RFCs</li> <li>Convert YANG modules into equivalent YIN module (XML)</li> <li>Generate a tree representation of YANG models for quick visualization</li> </ul>"},{"location":"examples/pyang/#install-pyang","title":"Install Pyang","text":"<pre><code>pip install pyang\npip3 freeze | grep pyang\n</code></pre> <pre><code>pip3 freeze | grep pyang\n</code></pre>"},{"location":"examples/pyang/#get-yang-modules","title":"Get YANG modules","text":"<p>We need YANG modules so we can use Pyang.  </p>"},{"location":"examples/pyang/#create-a-directory","title":"Create a directory","text":"<pre><code>mkdir yang_modules\n</code></pre>"},{"location":"examples/pyang/#clone-the-openconfig-repository","title":"Clone the OpenConfig repository","text":"<pre><code>git clone https://github.com/openconfig/public.git\n</code></pre> <pre><code>ls public\n</code></pre>"},{"location":"examples/pyang/#copy-all-the-yang-files-from-openconfig-to-the-yang_modules-directory","title":"Copy all the YANG files from OpenConfig to the yang_modules directory","text":"<pre><code>cp public/release/models/*.yang yang_modules/.\ncp -R public/release/models/*/*.yang yang_modules/.\ncp public/third_party/ietf/*.yang yang_modules/.\n</code></pre>"},{"location":"examples/pyang/#move-to-the-yang_modules-directory","title":"Move to the yang_modules directory","text":"<p>It has all the YANG files published on the OpenConfig repository</p> <pre><code>cd yang_modules/\nls\n</code></pre>"},{"location":"examples/pyang/#validate-yang-modules","title":"Validate YANG modules","text":"<pre><code>pyang openconfig-bgp.yang\npyang openconfig-interfaces.yang\n</code></pre>"},{"location":"examples/pyang/#convert-a-yang-module-into-an-equivalent-yin-module","title":"Convert a YANG module into an equivalent YIN module","text":"<p>A YANG module can be translated into an XML syntax called YIN. The translated module is called a YIN module. The YANG and YIN formats contain equivalent information using different notations: YIN is YANG in XML. A YANG module can be translated into YIN syntax without losing any information.</p> <p>Example (openconfig-bgp.yin is the YIN equivalent of openconfig-bgp.yang)</p> <pre><code>pyang openconfig-bgp.yang -f yin -o openconfig-bgp.yin\nls *.yin\n</code></pre>"},{"location":"examples/pyang/#generate-a-tree-representation-of-yang-modules-for-quick-visualization","title":"Generate a tree representation of YANG modules for quick visualization","text":"<pre><code>pyang openconfig-interfaces.yang -f tree\n</code></pre>  Reveal output <p> <pre><code>module: openconfig-interfaces\n  +--rw interfaces\n     +--rw interface* [name]\n+--rw name             -&gt; ../config/name\n        +--rw config\n        |  +--rw name?            string\n        |  +--rw type             identityref\n        |  +--rw mtu?             uint16\n        |  +--rw loopback-mode?   boolean\n        |  +--rw description?     string\n        |  +--rw enabled?         boolean\n        +--ro state\n        |  +--ro name?            string\n        |  +--ro type             identityref\n        |  +--ro mtu?             uint16\n        |  +--ro loopback-mode?   boolean\n        |  +--ro description?     string\n        |  +--ro enabled?         boolean\n        |  +--ro ifindex?         uint32\n        |  +--ro admin-status     enumeration\n        |  +--ro oper-status      enumeration\n        |  +--ro last-change?     oc-types:timeticks64\n        |  +--ro logical?         boolean\n        |  +--ro management?      boolean\n        |  +--ro cpu?             boolean\n        |  +--ro counters\n        |     +--ro in-octets?             oc-yang:counter64\n        |     +--ro in-pkts?               oc-yang:counter64\n        |     +--ro in-unicast-pkts?       oc-yang:counter64\n        |     +--ro in-broadcast-pkts?     oc-yang:counter64\n        |     +--ro in-multicast-pkts?     oc-yang:counter64\n        |     +--ro in-discards?           oc-yang:counter64\n        |     +--ro in-errors?             oc-yang:counter64\n        |     +--ro in-unknown-protos?     oc-yang:counter64\n        |     +--ro in-fcs-errors?         oc-yang:counter64\n        |     +--ro out-octets?            oc-yang:counter64\n        |     +--ro out-pkts?              oc-yang:counter64\n        |     +--ro out-unicast-pkts?      oc-yang:counter64\n        |     +--ro out-broadcast-pkts?    oc-yang:counter64\n        |     +--ro out-multicast-pkts?    oc-yang:counter64\n        |     +--ro out-discards?          oc-yang:counter64\n        |     +--ro out-errors?            oc-yang:counter64\n        |     +--ro carrier-transitions?   oc-yang:counter64\n        |     +--ro last-clear?            oc-types:timeticks64\n        +--rw hold-time\n        |  +--rw config\n        |  |  +--rw up?     uint32\n        |  |  +--rw down?   uint32\n        |  +--ro state\n        |     +--ro up?     uint32\n        |     +--ro down?   uint32\n        +--rw subinterfaces\n           +--rw subinterface* [index]\n+--rw index     -&gt; ../config/index\n              +--rw config\n              |  +--rw index?         uint32\n              |  +--rw description?   string\n              |  +--rw enabled?       boolean\n              +--ro state\n                 +--ro index?          uint32\n                 +--ro description?    string\n                 +--ro enabled?        boolean\n                 +--ro name?           string\n                 +--ro ifindex?        uint32\n                 +--ro admin-status    enumeration\n                 +--ro oper-status     enumeration\n                 +--ro last-change?    oc-types:timeticks64\n                 +--ro logical?        boolean\n                 +--ro management?     boolean\n                 +--ro cpu?            boolean\n                 +--ro counters\n                    +--ro in-octets?             oc-yang:counter64\n                    +--ro in-pkts?               oc-yang:counter64\n                    +--ro in-unicast-pkts?       oc-yang:counter64\n                    +--ro in-broadcast-pkts?     oc-yang:counter64\n                    +--ro in-multicast-pkts?     oc-yang:counter64\n                    +--ro in-discards?           oc-yang:counter64\n                    +--ro in-errors?             oc-yang:counter64\n                    +--ro in-unknown-protos?     oc-yang:counter64\n                    +--ro in-fcs-errors?         oc-yang:counter64\n                    +--ro out-octets?            oc-yang:counter64\n                    +--ro out-pkts?              oc-yang:counter64\n                    +--ro out-unicast-pkts?      oc-yang:counter64\n                    +--ro out-broadcast-pkts?    oc-yang:counter64\n                    +--ro out-multicast-pkts?    oc-yang:counter64\n                    +--ro out-discards?          oc-yang:counter64\n                    +--ro out-errors?            oc-yang:counter64\n                    +--ro carrier-transitions?   oc-yang:counter64\n                    +--ro last-clear?            oc-types:timeticks64\n</code></pre> </p> <pre><code>pyang openconfig-interfaces.yang -f tree --tree-path=/interfaces/interface/state\n</code></pre>  Reveal output <p> <pre><code>module: openconfig-interfaces\n  +--rw interfaces\n     +--rw interface* [name]\n+--ro state\n           +--ro name?            string\n           +--ro type             identityref\n           +--ro mtu?             uint16\n           +--ro loopback-mode?   boolean\n           +--ro description?     string\n           +--ro enabled?         boolean\n           +--ro ifindex?         uint32\n           +--ro admin-status     enumeration\n           +--ro oper-status      enumeration\n           +--ro last-change?     oc-types:timeticks64\n           +--ro logical?         boolean\n           +--ro management?      boolean\n           +--ro cpu?             boolean\n           +--ro counters\n              +--ro in-octets?             oc-yang:counter64\n              +--ro in-pkts?               oc-yang:counter64\n              +--ro in-unicast-pkts?       oc-yang:counter64\n              +--ro in-broadcast-pkts?     oc-yang:counter64\n              +--ro in-multicast-pkts?     oc-yang:counter64\n              +--ro in-discards?           oc-yang:counter64\n              +--ro in-errors?             oc-yang:counter64\n              +--ro in-unknown-protos?     oc-yang:counter64\n              +--ro in-fcs-errors?         oc-yang:counter64\n              +--ro out-octets?            oc-yang:counter64\n              +--ro out-pkts?              oc-yang:counter64\n              +--ro out-unicast-pkts?      oc-yang:counter64\n              +--ro out-broadcast-pkts?    oc-yang:counter64\n              +--ro out-multicast-pkts?    oc-yang:counter64\n              +--ro out-discards?          oc-yang:counter64\n              +--ro out-errors?            oc-yang:counter64\n              +--ro carrier-transitions?   oc-yang:counter64\n              +--ro last-clear?            oc-types:timeticks64\n</code></pre> </p> <pre><code>pyang openconfig-interfaces.yang -f tree --tree-depth=4\n</code></pre>  Reveal output <p> <pre><code>module: openconfig-interfaces\n  +--rw interfaces\n     +--rw interface* [name]\n+--rw name             -&gt; ../config/name\n        +--rw config\n        |  +--rw name?            string\n        |  +--rw type             identityref\n        |  +--rw mtu?             uint16\n        |  +--rw loopback-mode?   boolean\n        |  +--rw description?     string\n        |  +--rw enabled?         boolean\n        +--ro state\n        |  +--ro name?            string\n        |  +--ro type             identityref\n        |  +--ro mtu?             uint16\n        |  +--ro loopback-mode?   boolean\n        |  +--ro description?     string\n        |  +--ro enabled?         boolean\n        |  +--ro ifindex?         uint32\n        |  +--ro admin-status     enumeration\n        |  +--ro oper-status      enumeration\n        |  +--ro last-change?     oc-types:timeticks64\n        |  +--ro logical?         boolean\n        |  +--ro management?      boolean\n        |  +--ro cpu?             boolean\n        |  +--ro counters\n        |        ...\n        +--rw hold-time\n        |  +--rw config\n        |  |     ...\n        |  +--ro state\n        |        ...\n        +--rw subinterfaces\n           +--rw subinterface* [index]\n...\n</code></pre> </p> <pre><code>pyang openconfig-bgp.yang -f tree --tree-path=/bgp/neighbors --tree-depth=4\n</code></pre>  Reveal output <p> <pre><code>module: openconfig-bgp\n  +--rw bgp\n     +--rw neighbors\n        +--rw neighbor* [neighbor-address]\n+--rw neighbor-address      -&gt; ../config/neighbor-address\n           +--rw config\n           |     ...\n           +--ro state\n           |     ...\n           +--rw timers\n           |     ...\n           +--rw transport\n           |     ...\n           +--rw error-handling\n           |     ...\n           +--rw graceful-restart\n           |     ...\n           +--rw logging-options\n           |     ...\n           +--rw ebgp-multihop\n           |     ...\n           +--rw route-reflector\n           |     ...\n           +--rw as-path-options\n           |     ...\n           +--rw use-multiple-paths\n           |     ...\n           +--rw apply-policy\n           |     ...\n           +--rw afi-safis\n           |     ...\n           +--rw enable-bfd\n</code></pre> </p> <pre><code>pyang openconfig-bgp.yang -f tree --tree-path=/bgp/neighbors/neighbor/config\n</code></pre>  Reveal output <p> <pre><code>module: openconfig-bgp\n  +--rw bgp\n     +--rw neighbors\n        +--rw neighbor* [neighbor-address]\n+--rw config\n              +--rw peer-group?           -&gt; ../../../../peer-groups/peer-group/peer-group-name\n              +--rw neighbor-address?     oc-inet:ip-address\n              +--rw enabled?              boolean\n              +--rw peer-as?              oc-inet:as-number\n              +--rw local-as?             oc-inet:as-number\n              +--rw peer-type?            oc-bgp-types:peer-type\n              +--rw auth-password?        oc-types:routing-password\n              +--rw remove-private-as?    oc-bgp-types:remove-private-as-option\n              +--rw route-flap-damping?   boolean\n              +--rw send-community?       oc-bgp-types:community-type\n              +--rw description?          string\n</code></pre> </p> <pre><code>pyang openconfig-bgp.yang -f tree --tree-path=/bgp/neighbors/neighbor/state \\\n--tree-depth=5\n</code></pre>  Reveal output <p> <pre><code>module: openconfig-bgp\n  +--rw bgp\n     +--rw neighbors\n        +--rw neighbor* [neighbor-address]\n+--ro state\n              +--ro peer-group?                -&gt; ../../../../peer-groups/peer-group/peer-group-name\n              +--ro neighbor-address?          oc-inet:ip-address\n              +--ro enabled?                   boolean\n              +--ro peer-as?                   oc-inet:as-number\n              +--ro local-as?                  oc-inet:as-number\n              +--ro peer-type?                 oc-bgp-types:peer-type\n              +--ro auth-password?             oc-types:routing-password\n              +--ro remove-private-as?         oc-bgp-types:remove-private-as-option\n              +--ro route-flap-damping?        boolean\n              +--ro send-community?            oc-bgp-types:community-type\n              +--ro description?               string\n              +--ro session-state?             enumeration\n              +--ro last-established?          oc-types:timeticks64\n              +--ro established-transitions?   oc-yang:counter64\n              +--ro supported-capabilities*    identityref\n              +--ro messages\n              |     ...\n              +--ro queues\n              |     ...\n              +--ro dynamically-configured?    boolean\n</code></pre> </p> <pre><code>pyang openconfig-bgp.yang -f tree --tree-path=/bgp/neighbors/neighbor/afi-safis \\\n--tree-depth=6\n</code></pre>  Reveal output <p> <pre><code>module: openconfig-bgp\n  +--rw bgp\n     +--rw neighbors\n        +--rw neighbor* [neighbor-address]\n+--rw afi-safis\n              +--rw afi-safi* [afi-safi-name]\n+--rw afi-safi-name           -&gt; ../config/afi-safi-name\n                 +--rw config\n                 |     ...\n                 +--ro state\n                 |     ...\n                 +--rw graceful-restart\n                 |     ...\n                 +--rw add-paths\n                 |     ...\n                 +--rw apply-policy\n                 |     ...\n                 +--rw ipv4-unicast\n                 |     ...\n                 +--rw ipv6-unicast\n                 |     ...\n                 +--rw ipv4-labeled-unicast\n                 |     ...\n                 +--rw ipv6-labeled-unicast\n                 |     ...\n                 +--rw l3vpn-ipv4-unicast\n                 |     ...\n                 +--rw l3vpn-ipv6-unicast\n                 |     ...\n                 +--rw l3vpn-ipv4-multicast\n                 |     ...\n                 +--rw l3vpn-ipv6-multicast\n                 |     ...\n                 +--rw l2vpn-vpls\n                 |     ...\n                 +--rw l2vpn-evpn\n                 |     ...\n                 +--rw srte-policy-ipv4\n                 |     ...\n                 +--rw srte-policy-ipv6\n                 |     ...\n                 +--rw use-multiple-paths\n</code></pre> </p>"},{"location":"examples/pyangbind/","title":"Pyangbind","text":"<p>PyangBind is a pyang plugin.</p>"},{"location":"examples/pyangbind/#about-pyang","title":"About Pyang","text":"<p>Please visit this link if you need help about Pyang.</p>"},{"location":"examples/pyangbind/#about-pyangbind","title":"About PyangBind","text":"<p>It generates Python classes from a YANG module.</p> <p>It converts YANG module into a Python module. This Python module can be then used to generate data which conforms with the data model defined in YANG.</p>"},{"location":"examples/pyangbind/#install-pyang-and-pyangbind","title":"Install Pyang and Pyangbind","text":"<pre><code>pip install pyang\npip install pyangbind\n</code></pre> <pre><code>pip3 freeze | grep pyang\n</code></pre>"},{"location":"examples/pyangbind/#get-yang-modules","title":"Get YANG modules","text":"<p>We need YANG modules so we can use Pyang and Pyangbind.</p>"},{"location":"examples/pyangbind/#create-a-directory","title":"Create a directory","text":"<pre><code>mkdir yang_modules\n</code></pre>"},{"location":"examples/pyangbind/#clone-the-openconfig-repository","title":"Clone the OpenConfig repository","text":"<pre><code>git clone https://github.com/openconfig/public.git\n</code></pre> <p>Run this command to verify</p> <pre><code>ls public\n</code></pre>"},{"location":"examples/pyangbind/#copy-all-the-yang-files-from-openconfig-to-the-yang_modules-directory","title":"Copy all the YANG files from OpenConfig to the yang_modules directory","text":"<pre><code>cp public/release/models/*.yang yang_modules/.\ncp -R public/release/models/*/*.yang yang_modules/.\ncp public/third_party/ietf/*.yang yang_modules/.\n</code></pre>"},{"location":"examples/pyangbind/#move-to-the-yang_modules-directory","title":"Move to the yang_modules directory","text":"<pre><code>cd yang_modules/\n</code></pre> <p>Verify it has all the YANG files published on the OpenConfig repository</p> <pre><code>ls\n</code></pre>"},{"location":"examples/pyangbind/#use-pyangbind-to-generate-a-python-module-from-a-yang-module","title":"Use Pyangbind to generate a Python module from a YANG module","text":"<pre><code>pyang --plugindir $HOME/.local/lib/python3.6/site-packages/pyangbind/plugin/ -f pybind -o oc_bgp.py openconfig-bgp.yang\n</code></pre> <p>The above command generated the python module <code>oc_bgp.py</code> from the <code>openconfig-bgp.yang</code> file. Run this command to verify:</p> <pre><code>ls oc_bgp.py\n</code></pre>"},{"location":"examples/pyangbind/#use-the-new-python-module-to-generate-an-openconfig-configuration-file","title":"Use the new python module to generate an OpenConfig configuration file","text":"<p>The file pyangbind_demo.py uses the new python module <code>oc_bgp.py</code> and generates this OpenConfig configuration file demo.json</p> <pre><code>python3 pyangbind_demo.py\n</code></pre>"},{"location":"examples/pyangbind/#use-gnmi-set-rpc-to-configure-a-device","title":"Use gNMI SET RPC to configure a device","text":"<p>This OpenConfig configuration file demo.json can be loaded on a switch using the gNMI Set RPC</p>"},{"location":"examples/pyangbind/#install-gnmic","title":"Install gNMIc","text":"<p>Please visit this link if you need help with gNMIc installation</p>"},{"location":"examples/pyangbind/#required-device-configuration","title":"Required device configuration","text":"<p>Please visit this link if you need help to configure EOS for gNMI</p>"},{"location":"examples/pyangbind/#use-gnmic-to-configure-the-swicth","title":"Use gNMIc to configure the swicth","text":""},{"location":"examples/pyangbind/#check-the-device-configuration-before","title":"Check the device configuration before","text":"<pre><code>gnmic -a 192.0.2.117:6030 --insecure -u arista -p arista get   \\\n--path '/network-instances/network-instance[name=default]/protocols/protocol[name=BGP]/bgp'\n</code></pre> <pre><code>show run section bgp\n</code></pre>"},{"location":"examples/pyangbind/#use-gnmic-to-configure-the-swicth_1","title":"Use gNMIc to configure the swicth","text":"<pre><code>gnmic -a 192.0.2.117:6030 --insecure -u arista -p arista set  \\\n--replace-path '/network-instances/network-instance[name=default]/protocols/protocol[name=BGP]/bgp' \\\n--replace-file demo.json\n</code></pre>"},{"location":"examples/pyangbind/#check-the-device-configuration-after","title":"Check the device configuration after","text":"<pre><code>gnmic -a 192.0.2.117:6030 --insecure -u arista -p arista get  \\\n--path '/network-instances/network-instance[name=default]/protocols/protocol[name=BGP]/bgp'\n</code></pre> <pre><code>show run section bgp\n</code></pre>"},{"location":"examples/pygnmi/","title":"pygnmi","text":""},{"location":"examples/pygnmi/#overview","title":"Overview","text":"<p>The following example uses the pygnmi python module to talk to gNMI devices.</p> <pre><code># Modules\nfrom pygnmi.client import gNMIclient\nimport json\n# Variables\nhost = ('198.51.100.67', '6030')\n# Body\nif __name__ == '__main__':\nwith gNMIclient(target=host, username='ansible', password='ansible', insecure=True) as gc:\nresult = gc.get(path=['openconfig:interfaces'])\nprint(json.dumps(result, indent=4))\n</code></pre> <p>Assuming that the <code>pygnmi</code> module has been installed, this can be executed via the following command.</p> <pre><code>python3 gnmi_example.py\n</code></pre> <p>The following will simply run the <code>gnmi_example.py</code> file using python3 to get the openconfig interfaces.</p> <p>Truncated output</p> <pre><code>{\n\"notification\": [\n{\n\"timestamp\": 0,\n\"update\": [\n{\n\"path\": \"interfaces\",\n\"json_ietf_val\": {\n\"openconfig-interfaces:interface\": [\n{\n\"config\": {\n\"enabled\": true,\n\"arista-intf-augments:load-interval\": 300,\n\"loopback-mode\": false,\n\"mtu\": 0,\n\"name\": \"Ethernet1\",\n\"openconfig-vlan:tpid\": \"openconfig-vlan-types:TPID_0X8100\",\n\"type\": \"iana-if-type:ethernetCsmacd\"\n},\n</code></pre>"},{"location":"examples/pygnmi/#gnmi-capabilities-rpc","title":"gNMI Capabilities RPC","text":"<p>The file capabilities.py uses the pygnmi python module to get the gNMI capabilities.</p> <pre><code>python3 capabilities.py\n</code></pre> Reveal output <p> <pre><code>{'gnmi_version': '0.7.0',\n'supported_encodings': ['json', 'json_ietf', 'ascii'],\n'supported_models': [{'name': 'arista-exp-eos-varp-net-inst',\n'organization': 'Arista Networks &lt;http://arista.com/&gt;',\n'version': ''},\n{'name': 'openconfig-acl',\n'organization': 'OpenConfig working group',\n'version': '1.1.1'},\n{'name': 'arista-system-notsupported-deviations',\n'organization': 'Arista Networks, Inc.',\n'version': ''},\n{'name': 'openconfig-system-management',\n'organization': 'OpenConfig working group',\n'version': '0.2.0'},\n{'name': 'arista-isis-deviations',\n'organization': 'Arista Networks, Inc.',\n'version': ''},\n{'name': 'openconfig-rib-bgp-types',\n'organization': 'OpenConfig working group',\n'version': '0.5.0'},\n{'name': 'openconfig-platform-types',\n'organization': 'OpenConfig working group',\n'version': '1.0.0'},\n{'name': 'openconfig-network-instance',\n'organization': 'OpenConfig working group',\n'version': '0.13.2'},\n{'name': 'arista-bgp-augments',\n'organization': 'Arista Networks, Inc.',\n'version': ''},\n{'name': 'arista-exp-eos-igmpsnooping',\n'organization': 'Arista Networks &lt;http://arista.com/&gt;',\n'version': ''},\n{'name': 'ietf-netconf',\n'organization': 'IETF NETCONF (Network Configuration) '\n'Working Group',\n'version': ''},\n{'name': 'openconfig-policy-types',\n'organization': 'OpenConfig working group',\n'version': '3.1.1'},\n{'name': 'openconfig-rib-bgp',\n'organization': 'OpenConfig working group',\n'version': '0.6.0'},\n{'name': 'arista-local-routing-notsupported-deviations',\n'organization': 'Arista Networks, Inc.',\n'version': ''},\n{'name': 'arista-exp-eos-varp-intf',\n'organization': 'Arista Networks &lt;http://arista.com/&gt;',\n'version': ''},\n{'name': 'arista-interfaces-notsupported-deviations',\n'organization': 'Arista Networks, Inc.',\n'version': ''},\n{'name': 'arista-rpc-netconf',\n'organization': 'Arista Networks, Inc.',\n'version': ''},\n{'name': 'openconfig-platform-psu',\n'organization': 'OpenConfig working group',\n'version': '0.2.1'},\n{'name': 'openconfig-packet-match-types',\n'organization': 'OpenConfig working group',\n'version': '1.0.2'},\n{'name': 'openconfig-platform-fan',\n'organization': 'OpenConfig working group',\n'version': '0.1.1'},\n{'name': 'openconfig-inet-types',\n'organization': 'OpenConfig working group',\n'version': '0.3.3'},\n{'name': 'openconfig-igmp',\n'organization': 'OpenConfig working group',\n'version': '0.2.0'},\n{'name': 'openconfig-aaa-types',\n'organization': 'OpenConfig working group',\n'version': '0.4.1'},\n{'name': 'openconfig-lldp',\n'organization': 'OpenConfig working group',\n'version': '0.2.1'},\n{'name': 'arista-relay-agent-deviations',\n'organization': 'Arista Networks &lt;http://arista.com/&gt;',\n'version': ''},\n{'name': 'arista-intf-augments',\n'organization': 'Arista Networks &lt;http://arista.com/&gt;',\n'version': ''},\n{'name': 'arista-qos-augments',\n'organization': 'Arista Networks, Inc.',\n'version': ''},\n{'name': 'ietf-yang-types',\n'organization': 'IETF NETMOD (NETCONF Data Modeling '\n'Language) Working Group',\n'version': ''},\n{'name': 'openconfig-openflow',\n'organization': 'OpenConfig working group',\n'version': '0.1.2'},\n{'name': 'iana-if-type',\n'organization': 'IANA',\n'version': ''},\n{'name': 'arista-exp-eos-vxlan-config',\n'organization': 'Arista Networks &lt;http://arista.com/&gt;',\n'version': ''},\n{'name': 'arista-routing-policy-notsupported-deviations',\n'organization': 'Arista Networks, Inc.',\n'version': ''},\n{'name': 'openconfig-aaa',\n'organization': 'OpenConfig working group',\n'version': '0.4.3'},\n{'name': 'openconfig-if-ip',\n'organization': 'OpenConfig working group',\n'version': '3.0.0'},\n{'name': 'arista-srte-deviations',\n'organization': 'Arista Networks, Inc.',\n'version': ''},\n{'name': 'arista-local-routing-deviations',\n'organization': 'Arista Networks, Inc.',\n'version': ''},\n{'name': 'arista-lacp-augments',\n'organization': 'Arista Networks &lt;http://arista.com/&gt;',\n'version': ''},\n{'name': 'arista-bgp-notsupported-deviations',\n'organization': 'Arista Networks, Inc.',\n'version': ''},\n{'name': 'arista-exp-eos-multicast',\n'organization': 'Arista Networks &lt;http://arista.com/&gt;',\n'version': ''},\n{'name': 'openconfig-interfaces',\n'organization': 'OpenConfig working group',\n'version': '2.4.3'},\n{'name': 'openconfig-extensions',\n'organization': 'OpenConfig working group',\n'version': ''},\n{'name': 'openconfig-system-terminal',\n'organization': 'OpenConfig working group',\n'version': '0.3.1'},\n{'name': 'openconfig-bgp-types',\n'organization': 'OpenConfig working group',\n'version': '5.0.2'},\n{'name': 'arista-netinst-deviations',\n'organization': 'Arista Networks, Inc.',\n'version': ''},\n{'name': 'arista-system-deviations',\n'organization': 'Arista Networks, Inc.',\n'version': ''},\n{'name': 'openconfig-segment-routing',\n'organization': 'OpenConfig working group',\n'version': '0.0.4'},\n{'name': 'openconfig-platform',\n'organization': 'OpenConfig working group',\n'version': '0.12.2'},\n{'name': 'openconfig-pf-srte',\n'organization': 'OpenConfig working group',\n'version': '0.1.1'},\n{'name': 'arista-vlan-deviations',\n'organization': 'Arista Networks &lt;http://arista.com/&gt;',\n'version': ''},\n{'name': 'openconfig-bfd',\n'organization': 'OpenConfig working group',\n'version': '0.2.0'},\n{'name': 'openconfig-if-tunnel',\n'organization': 'OpenConfig working group',\n'version': '0.1.1'},\n{'name': 'openconfig-alarms',\n'organization': 'OpenConfig working group',\n'version': '0.3.2'},\n{'name': 'openconfig-if-aggregate',\n'organization': 'OpenConfig working group',\n'version': '2.4.2'},\n{'name': 'arista-acl-deviations',\n'organization': 'Arista Networks, Inc.',\n'version': ''},\n{'name': 'arista-acl-notsupported-deviations',\n'organization': 'Arista Networks, Inc.',\n'version': ''},\n{'name': 'arista-messages-notsupported-deviations',\n'organization': 'Arista Networks, Inc.',\n'version': ''},\n{'name': 'openconfig-network-instance-types',\n'organization': 'OpenConfig working group',\n'version': '0.8.2'},\n{'name': 'openconfig-types',\n'organization': 'OpenConfig working group',\n'version': '0.6.0'},\n{'name': 'ietf-interfaces',\n'organization': 'IETF NETMOD (Network Modeling) Working '\n'Group',\n'version': ''},\n{'name': 'openconfig-procmon',\n'organization': 'OpenConfig working group',\n'version': '0.4.0'},\n{'name': 'arista-exp-eos-qos',\n'organization': 'Arista Networks &lt;http://arista.com/&gt;',\n'version': ''},\n{'name': 'arista-exp-eos',\n'organization': 'Arista Networks &lt;http://arista.com/&gt;',\n'version': ''},\n{'name': 'arista-qos-notsupported-deviations',\n'organization': 'Arista Networks, Inc.',\n'version': ''},\n{'name': 'openconfig-aft',\n'organization': 'OpenConfig working group',\n'version': '0.4.0'},\n{'name': 'arista-isis-augments',\n'organization': 'Arista Networks, Inc.',\n'version': ''},\n{'name': 'openconfig-packet-match',\n'organization': 'OpenConfig working group',\n'version': '1.1.1'},\n{'name': 'arista-lldp-deviations',\n'organization': 'Arista Networks, Inc.',\n'version': ''},\n{'name': 'openconfig-if-ethernet',\n'organization': 'OpenConfig working group',\n'version': '2.7.2'},\n{'name': 'openconfig-mpls-sr',\n'organization': 'OpenConfig working group',\n'version': '3.0.1'},\n{'name': 'openconfig-policy-forwarding',\n'organization': 'OpenConfig working group',\n'version': '0.2.1'},\n{'name': 'arista-intf-deviations',\n'organization': 'Arista Networks, Inc.',\n'version': ''},\n{'name': 'openconfig-isis-lsdb-types',\n'organization': 'OpenConfig working group',\n'version': '0.4.2'},\n{'name': 'vlan-translation',\n'organization': 'Arista Networks',\n'version': ''},\n{'name': 'arista-gnoi-cert',\n'organization': 'Arista Networks, Inc.',\n'version': ''},\n{'name': 'arista-network-instance-notsupported-deviations',\n'organization': 'Arista Networks, Inc.',\n'version': ''},\n{'name': 'arista-bfd-augments',\n'organization': 'Arista Networks &lt;http://arista.com/&gt;',\n'version': ''},\n{'name': 'arista-vlan-augments',\n'organization': 'Arista Networks &lt;http://arista.com/&gt;',\n'version': ''},\n{'name': 'openconfig-hercules-interfaces',\n'organization': 'OpenConfig Hercules Working Group',\n'version': '0.2.0'},\n{'name': 'arista-lacp-notsupported-deviations',\n'organization': 'Arista Networks, Inc.',\n'version': ''},\n{'name': 'arista-srte-augments',\n'organization': 'Arista Networks, Inc.',\n'version': ''},\n{'name': 'openconfig-igmp-types',\n'organization': 'OpenConfig working group',\n'version': '0.1.1'},\n{'name': 'openconfig-lacp',\n'organization': 'OpenConfig working group',\n'version': '1.1.1'},\n{'name': 'openconfig-routing-policy',\n'organization': 'OpenConfig working group',\n'version': '3.1.1'},\n{'name': 'arista-lacp-deviations',\n'organization': 'Arista Networks, Inc.',\n'version': ''},\n{'name': 'openconfig-system-logging',\n'organization': 'OpenConfig working group',\n'version': '0.3.1'},\n{'name': 'openconfig-aft-types',\n'organization': 'OpenConfig Working Group',\n'version': '0.3.3'},\n{'name': 'openconfig-network-instance-l3',\n'organization': 'OpenConfig working group',\n'version': '0.11.1'},\n{'name': 'arista-bgp-deviations',\n'organization': 'Arista Networks, Inc.',\n'version': ''},\n{'name': 'arista-rpol-augments',\n'organization': 'Arista Networks &lt;http://arista.com/&gt;',\n'version': ''},\n{'name': 'arista-eos-types',\n'organization': 'Arista Networks &lt;http://arista.com/&gt;',\n'version': ''},\n{'name': 'openconfig-qos-types',\n'organization': 'OpenConfig working group',\n'version': '0.2.1'},\n{'name': 'arista-openflow-deviations',\n'organization': 'Arista Networks, Inc.',\n'version': ''},\n{'name': 'openconfig-mpls-types',\n'organization': 'OpenConfig working group',\n'version': '3.1.0'},\n{'name': 'openconfig-hercules-qos',\n'organization': 'OpenConfig Hercules Working Group',\n'version': '0.1.0'},\n{'name': 'openconfig-bgp',\n'organization': 'OpenConfig working group',\n'version': '6.0.0'},\n{'name': 'arista-platform-notsupported-deviations',\n'organization': 'Arista Networks, Inc.',\n'version': ''},\n{'name': 'arista-system-augments',\n'organization': 'Arista Networks, Inc.',\n'version': ''},\n{'name': 'arista-exp-eos-mlag',\n'organization': 'Arista Networks &lt;http://arista.com/&gt;',\n'version': ''},\n{'name': 'openconfig-system',\n'organization': 'OpenConfig working group',\n'version': '0.8.0'},\n{'name': 'openconfig-isis',\n'organization': 'OpenConfig working group',\n'version': '0.4.2'},\n{'name': 'openconfig-lldp-types',\n'organization': 'OpenConfig working group',\n'version': '0.1.1'},\n{'name': 'openconfig-vlan',\n'organization': 'OpenConfig working group',\n'version': '3.2.0'},\n{'name': 'openconfig-if-types',\n'organization': 'OpenConfig working group',\n'version': '0.2.1'},\n{'name': 'openconfig-relay-agent',\n'organization': 'OpenConfig working group',\n'version': '0.1.1'},\n{'name': 'arista-lldp-notsupported-deviations',\n'organization': 'Arista Networks, Inc.',\n'version': ''},\n{'name': 'arista-aft-augments',\n'organization': 'Arista Networks, Inc.',\n'version': ''},\n{'name': 'openconfig-vlan-types',\n'organization': 'OpenConfig working group',\n'version': '3.1.0'},\n{'name': 'arista-mpls-augments',\n'organization': 'Arista Networks &lt;http://arista.com/&gt;',\n'version': ''},\n{'name': 'arista-mpls-deviations',\n'organization': 'Arista Networks, Inc.',\n'version': ''},\n{'name': 'openconfig-alarm-types',\n'organization': 'OpenConfig working group',\n'version': '0.2.1'},\n{'name': 'openconfig-hercules-platform',\n'organization': 'OpenConfig Hercules Working Group',\n'version': '0.2.0'},\n{'name': 'openconfig-ospfv2',\n'organization': 'OpenConfig working group',\n'version': '0.2.2'},\n{'name': 'ietf-netconf-monitoring',\n'organization': 'IETF NETCONF (Network Configuration) '\n'Working Group',\n'version': ''},\n{'name': 'arista-exp-eos-evpn',\n'organization': 'Arista Networks, Inc.',\n'version': ''},\n{'name': 'arista-exp-eos-vxlan',\n'organization': 'Arista Networks &lt;http://arista.com/&gt;',\n'version': ''},\n{'name': 'openconfig-platform-port',\n'organization': 'OpenConfig working group',\n'version': '0.3.2'},\n{'name': 'openconfig-messages',\n'organization': 'OpenConfig working group',\n'version': '0.0.1'},\n{'name': 'openconfig-platform-cpu',\n'organization': 'OpenConfig working group',\n'version': '0.1.1'},\n{'name': 'openconfig-if-poe',\n'organization': 'OpenConfig working group',\n'version': '0.1.1'},\n{'name': 'openconfig-pim',\n'organization': 'OpenConfig working group',\n'version': '0.2.0'},\n{'name': 'openconfig-openflow-types',\n'organization': 'OpenConfig working group',\n'version': '0.1.2'},\n{'name': 'openconfig-mpls',\n'organization': 'OpenConfig working group',\n'version': '3.1.0'},\n{'name': 'openconfig-platform-linecard',\n'organization': 'OpenConfig working group',\n'version': '0.1.1'},\n{'name': 'openconfig-mpls-ldp',\n'organization': 'OpenConfig working group',\n'version': '3.0.2'},\n{'name': 'openconfig-bgp-policy',\n'organization': 'OpenConfig working group',\n'version': '6.0.1'},\n{'name': 'openconfig-mpls-rsvp',\n'organization': 'OpenConfig working group',\n'version': '3.0.1'},\n{'name': 'arista-exp-eos-qos-config',\n'organization': 'Arista Networks &lt;http://arista.com/&gt;',\n'version': ''},\n{'name': 'openconfig-yang-types',\n'organization': 'OpenConfig working group',\n'version': '0.2.1'},\n{'name': 'openconfig-qos',\n'organization': 'OpenConfig working group',\n'version': '0.2.3'},\n{'name': 'openconfig-local-routing',\n'organization': 'OpenConfig working group',\n'version': '1.0.2'},\n{'name': 'ietf-inet-types',\n'organization': 'IETF NETMOD (NETCONF Data Modeling '\n'Language) Working Group',\n'version': ''},\n{'name': 'arista-rpol-deviations',\n'organization': 'Arista Networks, Inc.',\n'version': ''},\n{'name': 'arista-pim-augments',\n'organization': 'Arista Networks &lt;http://arista.com/&gt;',\n'version': ''},\n{'name': 'openconfig-pim-types',\n'organization': 'OpenConfig working group',\n'version': '0.1.1'},\n{'name': 'arista-bfd-notsupported-deviations',\n'organization': 'Arista Networks, Inc.',\n'version': ''},\n{'name': 'arista-lldp-augments',\n'organization': 'Arista Networks, Inc.',\n'version': ''},\n{'name': 'arista-exp-eos-qos-acl-config',\n'organization': 'Arista Networks &lt;http://arista.com/&gt;',\n'version': ''},\n{'name': 'openconfig-isis-types',\n'organization': 'OpenConfig working group',\n'version': '0.4.2'},\n{'name': 'openconfig-ospf-policy',\n'organization': 'OpenConfig working group',\n'version': '0.1.3'},\n{'name': 'openconfig-ospf-types',\n'organization': 'OpenConfig working group',\n'version': '0.1.3'},\n{'name': 'arista-bfd-deviations',\n'organization': 'Arista Networks, Inc.',\n'version': ''}]}\n</code></pre> </p>"},{"location":"examples/pygnmi/#gnmi-get-rpc","title":"gNMI Get RPC","text":"<p>The file get.py uses the pygnmi python module and uses the gNMI GET RPC</p> <pre><code>python3 get.py\n</code></pre> Reveal output <p> <pre><code>{\n\"notification\": [\n{\n\"timestamp\": 0,\n      \"update\": [\n{\n\"path\": \"interfaces/interface[name=Ethernet1]/state/counters\",\n          \"val\": {\n\"openconfig-interfaces:in-broadcast-pkts\": \"2\",\n            \"openconfig-interfaces:in-discards\": \"0\",\n            \"openconfig-interfaces:in-errors\": \"0\",\n            \"openconfig-interfaces:in-fcs-errors\": \"0\",\n            \"openconfig-interfaces:in-multicast-pkts\": \"189439\",\n            \"openconfig-interfaces:in-octets\": \"48284395\",\n            \"openconfig-interfaces:in-unicast-pkts\": \"416884\",\n            \"openconfig-interfaces:out-broadcast-pkts\": \"14\",\n            \"openconfig-interfaces:out-discards\": \"0\",\n            \"openconfig-interfaces:out-errors\": \"0\",\n            \"openconfig-interfaces:out-multicast-pkts\": \"217232\",\n            \"openconfig-interfaces:out-octets\": \"51749355\",\n            \"openconfig-interfaces:out-unicast-pkts\": \"416911\"\n}\n}\n]\n},\n    {\n\"timestamp\": 0,\n      \"update\": [\n{\n\"path\": \"network-instances/network-instance[name=default]/protocols/protocol[identifier=BGP][name=BGP]/bgp/neighbors/neighbor[neighbor-address=192.168.255.2]/state\",\n          \"val\": {\n\"openconfig-network-instance:enabled\": true,\n            \"openconfig-network-instance:established-transitions\": \"0\",\n            \"openconfig-network-instance:last-established\": \"1625684802230601216\",\n            \"openconfig-network-instance:messages\": {\n\"received\": {\n\"UPDATE\": \"0\"\n},\n              \"sent\": {\n\"UPDATE\": \"0\"\n}\n},\n            \"openconfig-network-instance:neighbor-address\": \"192.168.255.2\",\n            \"openconfig-network-instance:peer-group\": \"EVPN-OVERLAY-PEERS\",\n            \"openconfig-network-instance:send-community\": \"NONE\",\n            \"openconfig-network-instance:session-state\": \"ACTIVE\"\n}\n},\n        {\n\"path\": \"network-instances/network-instance[name=default]/protocols/protocol[identifier=BGP][name=BGP]/bgp/neighbors/neighbor[neighbor-address=192.168.255.1]/state\",\n          \"val\": {\n\"openconfig-network-instance:enabled\": true,\n            \"openconfig-network-instance:established-transitions\": \"2\",\n            \"openconfig-network-instance:last-established\": \"1625740129181922304\",\n            \"openconfig-network-instance:messages\": {\n\"received\": {\n\"UPDATE\": \"2\"\n},\n              \"sent\": {\n\"UPDATE\": \"24\"\n}\n},\n            \"openconfig-network-instance:neighbor-address\": \"192.168.255.1\",\n            \"openconfig-network-instance:peer-group\": \"EVPN-OVERLAY-PEERS\",\n            \"openconfig-network-instance:send-community\": \"NONE\",\n            \"openconfig-network-instance:session-state\": \"ACTIVE\"\n}\n}\n]\n}\n]\n}\n</code></pre> </p>"},{"location":"examples/pygnmi/#gnmi-subscribe-rpc","title":"gNMI Subscribe RPC","text":"<p>The file sub.py uses the pygnmi python module and uses the gNMI Subscribe RPC</p> <pre><code>python3 sub.py\n</code></pre> Reveal output <p> <pre><code>{'update': {'update': [{'path': 'interfaces/interface[name=Ethernet1]/state/counters/in-broadcast-pkts', 'val': 2}], 'timestamp': 1626462768674581749}}\n{'update': {'update': [{'path': 'interfaces/interface[name=Ethernet1]/state/counters/in-discards', 'val': 0}], 'timestamp': 1626462768674597259}}\n{'update': {'update': [{'path': 'interfaces/interface[name=Ethernet1]/state/counters/in-errors', 'val': 0}], 'timestamp': 1626462768674603747}}\n{'update': {'update': [{'path': 'interfaces/interface[name=Ethernet1]/state/counters/in-fcs-errors', 'val': 0}], 'timestamp': 1626462768672465216}}\n{'update': {'update': [{'path': 'interfaces/interface[name=Ethernet1]/state/counters/in-multicast-pkts', 'val': 189439}], 'timestamp': 1626462768674588779}}\n{'update': {'update': [{'path': 'interfaces/interface[name=Ethernet1]/state/counters/in-octets', 'val': 48284395}], 'timestamp': 1626462768674553338}}\n{'update': {'update': [{'path': 'interfaces/interface[name=Ethernet1]/state/counters/in-unicast-pkts', 'val': 416884}], 'timestamp': 1626462768674571889}}\n{'update': {'update': [{'path': 'interfaces/interface[name=Ethernet1]/state/counters/out-broadcast-pkts', 'val': 14}], 'timestamp': 1626462768674624983}}\n{'update': {'update': [{'path': 'interfaces/interface[name=Ethernet1]/state/counters/out-discards', 'val': 0}], 'timestamp': 1626462768674639908}}\n{'update': {'update': [{'path': 'interfaces/interface[name=Ethernet1]/state/counters/out-errors', 'val': 0}], 'timestamp': 1626462768674645915}}\n{'update': {'update': [{'path': 'interfaces/interface[name=Ethernet1]/state/counters/out-multicast-pkts', 'val': 217294}], 'timestamp': 1626599894372892660}}\n{'update': {'update': [{'path': 'interfaces/interface[name=Ethernet1]/state/counters/out-octets', 'val': 51756949}], 'timestamp': 1626599894372858163}}\n{'update': {'update': [{'path': 'interfaces/interface[name=Ethernet1]/state/counters/out-unicast-pkts', 'val': 416911}], 'timestamp': 1626462768674617475}}\n{'update': {'update': [{'path': 'network-instances/network-instance[name=default]/protocols/protocol[name=BGP][identifier=BGP]/bgp/neighbors/neighbor[neighbor-address=192.168.255.2]/state/enabled', 'val': True}], 'timestamp': 1626462768440845697}}\n{'update': {'update': [{'path': 'network-instances/network-instance[name=default]/protocols/protocol[identifier=BGP][name=BGP]/bgp/neighbors/neighbor[neighbor-address=192.168.255.2]/state/established-transitions', 'val': 0}], 'timestamp': 1626462768468632490}}\n{'update': {'update': [{'path': 'network-instances/network-instance[name=default]/protocols/protocol[name=BGP][identifier=BGP]/bgp/neighbors/neighbor[neighbor-address=192.168.255.2]/state/last-established', 'val': 1625684802230601216}], 'timestamp': 1626462768469284793}}\n{'update': {'update': [{'path': 'network-instances/network-instance[name=default]/protocols/protocol[identifier=BGP][name=BGP]/bgp/neighbors/neighbor[neighbor-address=192.168.255.2]/state/messages/received/UPDATE', 'val': 0}], 'timestamp': 1626462768421128387}}\n{'update': {'update': [{'path': 'network-instances/network-instance[name=default]/protocols/protocol[name=BGP][identifier=BGP]/bgp/neighbors/neighbor[neighbor-address=192.168.255.2]/state/messages/sent/UPDATE', 'val': 0}], 'timestamp': 1626462768421184402}}\n{'update': {'update': [{'path': 'network-instances/network-instance[name=default]/protocols/protocol[identifier=BGP][name=BGP]/bgp/neighbors/neighbor[neighbor-address=192.168.255.2]/state/neighbor-address', 'val': '192.168.255.2'}], 'timestamp': 1626462768421876850}}\n{'update': {'update': [{'path': 'network-instances/network-instance[name=default]/protocols/protocol[name=BGP][identifier=BGP]/bgp/neighbors/neighbor[neighbor-address=192.168.255.2]/state/peer-group', 'val': 'EVPN-OVERLAY-PEERS'}], 'timestamp': 1626462768439035722}}\n{'update': {'update': [{'path': 'network-instances/network-instance[name=default]/protocols/protocol[identifier=BGP][name=BGP]/bgp/neighbors/neighbor[neighbor-address=192.168.255.2]/state/send-community', 'val': 'NONE'}], 'timestamp': 1626462768419003214}}\n{'update': {'update': [{'path': 'network-instances/network-instance[name=default]/protocols/protocol[identifier=BGP][name=BGP]/bgp/neighbors/neighbor[neighbor-address=192.168.255.2]/state/session-state', 'val': 'ACTIVE'}], 'timestamp': 1626462768469145043}}\n{'update': {'update': [{'path': 'network-instances/network-instance[name=default]/protocols/protocol[identifier=BGP][name=BGP]/bgp/neighbors/neighbor[neighbor-address=192.168.255.1]/state/enabled', 'val': True}], 'timestamp': 1626462768428252812}}\n{'update': {'update': [{'path': 'network-instances/network-instance[name=default]/protocols/protocol[name=BGP][identifier=BGP]/bgp/neighbors/neighbor[neighbor-address=192.168.255.1]/state/established-transitions', 'val': 2}], 'timestamp': 1626462768470394508}}\n{'update': {'update': [{'path': 'network-instances/network-instance[name=default]/protocols/protocol[name=BGP][identifier=BGP]/bgp/neighbors/neighbor[neighbor-address=192.168.255.1]/state/last-established', 'val': 1625740129181922304}], 'timestamp': 1626462768469974563}}\n{'update': {'update': [{'path': 'network-instances/network-instance[name=default]/protocols/protocol[identifier=BGP][name=BGP]/bgp/neighbors/neighbor[neighbor-address=192.168.255.1]/state/messages/received/UPDATE', 'val': 2}], 'timestamp': 1626462768424768147}}\n{'update': {'update': [{'path': 'network-instances/network-instance[name=default]/protocols/protocol[name=BGP][identifier=BGP]/bgp/neighbors/neighbor[neighbor-address=192.168.255.1]/state/messages/sent/UPDATE', 'val': 24}], 'timestamp': 1626462768424826346}}\n{'update': {'update': [{'path': 'network-instances/network-instance[name=default]/protocols/protocol[identifier=BGP][name=BGP]/bgp/neighbors/neighbor[neighbor-address=192.168.255.1]/state/neighbor-address', 'val': '192.168.255.1'}], 'timestamp': 1626462768425586744}}\n{'update': {'update': [{'path': 'network-instances/network-instance[name=default]/protocols/protocol[identifier=BGP][name=BGP]/bgp/neighbors/neighbor[neighbor-address=192.168.255.1]/state/peer-group', 'val': 'EVPN-OVERLAY-PEERS'}], 'timestamp': 1626462768427044044}}\n{'update': {'update': [{'path': 'network-instances/network-instance[name=default]/protocols/protocol[name=BGP][identifier=BGP]/bgp/neighbors/neighbor[neighbor-address=192.168.255.1]/state/send-community', 'val': 'NONE'}], 'timestamp': 1626462768423035498}}\n{'update': {'update': [{'path': 'network-instances/network-instance[name=default]/protocols/protocol[identifier=BGP][name=BGP]/bgp/neighbors/neighbor[neighbor-address=192.168.255.1]/state/session-state', 'val': 'ACTIVE'}], 'timestamp': 1626462768469536321}}\n{'sync_response': True}\n{'update': {'update': [{'path': 'interfaces/interface[name=Ethernet1]/state/counters/in-broadcast-pkts', 'val': 2}], 'timestamp': 1626462768674581749}}\n{'update': {'update': [{'path': 'interfaces/interface[name=Ethernet1]/state/counters/in-discards', 'val': 0}], 'timestamp': 1626462768674597259}}\n{'update': {'update': [{'path': 'interfaces/interface[name=Ethernet1]/state/counters/in-errors', 'val': 0}], 'timestamp': 1626462768674603747}}\n{'update': {'update': [{'path': 'interfaces/interface[name=Ethernet1]/state/counters/in-fcs-errors', 'val': 0}], 'timestamp': 1626462768672465216}}\n{'update': {'update': [{'path': 'interfaces/interface[name=Ethernet1]/state/counters/in-multicast-pkts', 'val': 189439}], 'timestamp': 1626462768674588779}}\n{'update': {'update': [{'path': 'interfaces/interface[name=Ethernet1]/state/counters/in-octets', 'val': 48284395}], 'timestamp': 1626462768674553338}}\n{'update': {'update': [{'path': 'interfaces/interface[name=Ethernet1]/state/counters/in-unicast-pkts', 'val': 416884}], 'timestamp': 1626462768674571889}}\n{'update': {'update': [{'path': 'interfaces/interface[name=Ethernet1]/state/counters/out-broadcast-pkts', 'val': 14}], 'timestamp': 1626462768674624983}}\n{'update': {'update': [{'path': 'interfaces/interface[name=Ethernet1]/state/counters/out-discards', 'val': 0}], 'timestamp': 1626462768674639908}}\n{'update': {'update': [{'path': 'interfaces/interface[name=Ethernet1]/state/counters/out-errors', 'val': 0}], 'timestamp': 1626462768674645915}}\n{'update': {'update': [{'path': 'interfaces/interface[name=Ethernet1]/state/counters/out-multicast-pkts', 'val': 217299}], 'timestamp': 1626599904372340631}}\n{'update': {'update': [{'path': 'interfaces/interface[name=Ethernet1]/state/counters/out-octets', 'val': 51757564}], 'timestamp': 1626599904372302101}}\n{'update': {'update': [{'path': 'interfaces/interface[name=Ethernet1]/state/counters/out-unicast-pkts', 'val': 416911}], 'timestamp': 1626462768674617475}}\n{'sync_response': True}\n{'update': {'update': [{'path': 'network-instances/network-instance[name=default]/protocols/protocol[name=BGP][identifier=BGP]/bgp/neighbors/neighbor[neighbor-address=192.168.255.2]/state/enabled', 'val': True}], 'timestamp': 1626462768440845697}}\n{'update': {'update': [{'path': 'network-instances/network-instance[name=default]/protocols/protocol[identifier=BGP][name=BGP]/bgp/neighbors/neighbor[neighbor-address=192.168.255.2]/state/established-transitions', 'val': 0}], 'timestamp': 1626462768468632490}}\n{'update': {'update': [{'path': 'network-instances/network-instance[name=default]/protocols/protocol[name=BGP][identifier=BGP]/bgp/neighbors/neighbor[neighbor-address=192.168.255.2]/state/last-established', 'val': 1625684802230601216}], 'timestamp': 1626462768469284793}}\n{'update': {'update': [{'path': 'network-instances/network-instance[name=default]/protocols/protocol[identifier=BGP][name=BGP]/bgp/neighbors/neighbor[neighbor-address=192.168.255.2]/state/messages/received/UPDATE', 'val': 0}], 'timestamp': 1626462768421128387}}\n{'update': {'update': [{'path': 'network-instances/network-instance[name=default]/protocols/protocol[identifier=BGP][name=BGP]/bgp/neighbors/neighbor[neighbor-address=192.168.255.2]/state/messages/sent/UPDATE', 'val': 0}], 'timestamp': 1626462768421184402}}\n{'update': {'update': [{'path': 'network-instances/network-instance[name=default]/protocols/protocol[name=BGP][identifier=BGP]/bgp/neighbors/neighbor[neighbor-address=192.168.255.2]/state/neighbor-address', 'val': '192.168.255.2'}], 'timestamp': 1626462768421876850}}\n{'update': {'update': [{'path': 'network-instances/network-instance[name=default]/protocols/protocol[identifier=BGP][name=BGP]/bgp/neighbors/neighbor[neighbor-address=192.168.255.2]/state/peer-group', 'val': 'EVPN-OVERLAY-PEERS'}], 'timestamp': 1626462768439035722}}\n{'update': {'update': [{'path': 'network-instances/network-instance[name=default]/protocols/protocol[name=BGP][identifier=BGP]/bgp/neighbors/neighbor[neighbor-address=192.168.255.2]/state/send-community', 'val': 'NONE'}], 'timestamp': 1626462768419003214}}\n{'update': {'update': [{'path': 'network-instances/network-instance[name=default]/protocols/protocol[name=BGP][identifier=BGP]/bgp/neighbors/neighbor[neighbor-address=192.168.255.2]/state/session-state', 'val': 'ACTIVE'}], 'timestamp': 1626462768469145043}}\n{'update': {'update': [{'path': 'network-instances/network-instance[name=default]/protocols/protocol[identifier=BGP][name=BGP]/bgp/neighbors/neighbor[neighbor-address=192.168.255.1]/state/enabled', 'val': True}], 'timestamp': 1626462768428252812}}\n{'update': {'update': [{'path': 'network-instances/network-instance[name=default]/protocols/protocol[identifier=BGP][name=BGP]/bgp/neighbors/neighbor[neighbor-address=192.168.255.1]/state/established-transitions', 'val': 2}], 'timestamp': 1626462768470394508}}\n{'update': {'update': [{'path': 'network-instances/network-instance[name=default]/protocols/protocol[identifier=BGP][name=BGP]/bgp/neighbors/neighbor[neighbor-address=192.168.255.1]/state/last-established', 'val': 1625740129181922304}], 'timestamp': 1626462768469974563}}\n{'update': {'update': [{'path': 'network-instances/network-instance[name=default]/protocols/protocol[name=BGP][identifier=BGP]/bgp/neighbors/neighbor[neighbor-address=192.168.255.1]/state/messages/received/UPDATE', 'val': 2}], 'timestamp': 1626462768424768147}}\n{'update': {'update': [{'path': 'network-instances/network-instance[name=default]/protocols/protocol[name=BGP][identifier=BGP]/bgp/neighbors/neighbor[neighbor-address=192.168.255.1]/state/messages/sent/UPDATE', 'val': 24}], 'timestamp': 1626462768424826346}}\n{'update': {'update': [{'path': 'network-instances/network-instance[name=default]/protocols/protocol[name=BGP][identifier=BGP]/bgp/neighbors/neighbor[neighbor-address=192.168.255.1]/state/neighbor-address', 'val': '192.168.255.1'}], 'timestamp': 1626462768425586744}}\n{'update': {'update': [{'path': 'network-instances/network-instance[name=default]/protocols/protocol[identifier=BGP][name=BGP]/bgp/neighbors/neighbor[neighbor-address=192.168.255.1]/state/peer-group', 'val': 'EVPN-OVERLAY-PEERS'}], 'timestamp': 1626462768427044044}}\n{'update': {'update': [{'path': 'network-instances/network-instance[name=default]/protocols/protocol[name=BGP][identifier=BGP]/bgp/neighbors/neighbor[neighbor-address=192.168.255.1]/state/send-community', 'val': 'NONE'}], 'timestamp': 1626462768423035498}}\n{'update': {'update': [{'path': 'network-instances/network-instance[name=default]/protocols/protocol[identifier=BGP][name=BGP]/bgp/neighbors/neighbor[neighbor-address=192.168.255.1]/state/session-state', 'val': 'ACTIVE'}], 'timestamp': 1626462768469536321}}\n{'sync_response': True}\n{'update': {'update': [{'path': 'interfaces/interface[name=Ethernet1]/state/counters/in-broadcast-pkts', 'val': 2}], 'timestamp': 1626462768674581749}}\n{'update': {'update': [{'path': 'interfaces/interface[name=Ethernet1]/state/counters/in-discards', 'val': 0}], 'timestamp': 1626462768674597259}}\n{'update': {'update': [{'path': 'interfaces/interface[name=Ethernet1]/state/counters/in-errors', 'val': 0}], 'timestamp': 1626462768674603747}}\n{'update': {'update': [{'path': 'interfaces/interface[name=Ethernet1]/state/counters/in-fcs-errors', 'val': 0}], 'timestamp': 1626462768672465216}}\n{'update': {'update': [{'path': 'interfaces/interface[name=Ethernet1]/state/counters/in-multicast-pkts', 'val': 189439}], 'timestamp': 1626462768674588779}}\n{'update': {'update': [{'path': 'interfaces/interface[name=Ethernet1]/state/counters/in-octets', 'val': 48284395}], 'timestamp': 1626462768674553338}}\n{'update': {'update': [{'path': 'interfaces/interface[name=Ethernet1]/state/counters/in-unicast-pkts', 'val': 416884}], 'timestamp': 1626462768674571889}}\n{'update': {'update': [{'path': 'interfaces/interface[name=Ethernet1]/state/counters/out-broadcast-pkts', 'val': 14}], 'timestamp': 1626462768674624983}}\n{'update': {'update': [{'path': 'interfaces/interface[name=Ethernet1]/state/counters/out-discards', 'val': 0}], 'timestamp': 1626462768674639908}}\n{'update': {'update': [{'path': 'interfaces/interface[name=Ethernet1]/state/counters/out-errors', 'val': 0}], 'timestamp': 1626462768674645915}}\n{'update': {'update': [{'path': 'interfaces/interface[name=Ethernet1]/state/counters/out-multicast-pkts', 'val': 217304}], 'timestamp': 1626599914374756337}}\n{'update': {'update': [{'path': 'interfaces/interface[name=Ethernet1]/state/counters/out-octets', 'val': 51758179}], 'timestamp': 1626599914374727204}}\n{'update': {'update': [{'path': 'interfaces/interface[name=Ethernet1]/state/counters/out-unicast-pkts', 'val': 416911}], 'timestamp': 1626462768674617475}}\n{'sync_response': True}\n{'update': {'update': [{'path': 'network-instances/network-instance[name=default]/protocols/protocol[identifier=BGP][name=BGP]/bgp/neighbors/neighbor[neighbor-address=192.168.255.2]/state/enabled', 'val': True}], 'timestamp': 1626462768440845697}}\n{'update': {'update': [{'path': 'network-instances/network-instance[name=default]/protocols/protocol[name=BGP][identifier=BGP]/bgp/neighbors/neighbor[neighbor-address=192.168.255.2]/state/established-transitions', 'val': 0}], 'timestamp': 1626462768468632490}}\n{'update': {'update': [{'path': 'network-instances/network-instance[name=default]/protocols/protocol[name=BGP][identifier=BGP]/bgp/neighbors/neighbor[neighbor-address=192.168.255.2]/state/last-established', 'val': 1625684802230601216}], 'timestamp': 1626462768469284793}}\n{'update': {'update': [{'path': 'network-instances/network-instance[name=default]/protocols/protocol[name=BGP][identifier=BGP]/bgp/neighbors/neighbor[neighbor-address=192.168.255.2]/state/messages/received/UPDATE', 'val': 0}], 'timestamp': 1626462768421128387}}\n{'update': {'update': [{'path': 'network-instances/network-instance[name=default]/protocols/protocol[name=BGP][identifier=BGP]/bgp/neighbors/neighbor[neighbor-address=192.168.255.2]/state/messages/sent/UPDATE', 'val': 0}], 'timestamp': 1626462768421184402}}\n{'update': {'update': [{'path': 'network-instances/network-instance[name=default]/protocols/protocol[identifier=BGP][name=BGP]/bgp/neighbors/neighbor[neighbor-address=192.168.255.2]/state/neighbor-address', 'val': '192.168.255.2'}], 'timestamp': 1626462768421876850}}\n{'update': {'update': [{'path': 'network-instances/network-instance[name=default]/protocols/protocol[name=BGP][identifier=BGP]/bgp/neighbors/neighbor[neighbor-address=192.168.255.2]/state/peer-group', 'val': 'EVPN-OVERLAY-PEERS'}], 'timestamp': 1626462768439035722}}\n{'update': {'update': [{'path': 'network-instances/network-instance[name=default]/protocols/protocol[name=BGP][identifier=BGP]/bgp/neighbors/neighbor[neighbor-address=192.168.255.2]/state/send-community', 'val': 'NONE'}], 'timestamp': 1626462768419003214}}\n{'update': {'update': [{'path': 'network-instances/network-instance[name=default]/protocols/protocol[name=BGP][identifier=BGP]/bgp/neighbors/neighbor[neighbor-address=192.168.255.2]/state/session-state', 'val': 'ACTIVE'}], 'timestamp': 1626462768469145043}}\n{'update': {'update': [{'path': 'network-instances/network-instance[name=default]/protocols/protocol[name=BGP][identifier=BGP]/bgp/neighbors/neighbor[neighbor-address=192.168.255.1]/state/enabled', 'val': True}], 'timestamp': 1626462768428252812}}\n{'update': {'update': [{'path': 'network-instances/network-instance[name=default]/protocols/protocol[identifier=BGP][name=BGP]/bgp/neighbors/neighbor[neighbor-address=192.168.255.1]/state/established-transitions', 'val': 2}], 'timestamp': 1626462768470394508}}\n{'update': {'update': [{'path': 'network-instances/network-instance[name=default]/protocols/protocol[identifier=BGP][name=BGP]/bgp/neighbors/neighbor[neighbor-address=192.168.255.1]/state/last-established', 'val': 1625740129181922304}], 'timestamp': 1626462768469974563}}\n{'update': {'update': [{'path': 'network-instances/network-instance[name=default]/protocols/protocol[name=BGP][identifier=BGP]/bgp/neighbors/neighbor[neighbor-address=192.168.255.1]/state/messages/received/UPDATE', 'val': 2}], 'timestamp': 1626462768424768147}}\n{'update': {'update': [{'path': 'network-instances/network-instance[name=default]/protocols/protocol[identifier=BGP][name=BGP]/bgp/neighbors/neighbor[neighbor-address=192.168.255.1]/state/messages/sent/UPDATE', 'val': 24}], 'timestamp': 1626462768424826346}}\n{'update': {'update': [{'path': 'network-instances/network-instance[name=default]/protocols/protocol[identifier=BGP][name=BGP]/bgp/neighbors/neighbor[neighbor-address=192.168.255.1]/state/neighbor-address', 'val': '192.168.255.1'}], 'timestamp': 1626462768425586744}}\n{'update': {'update': [{'path': 'network-instances/network-instance[name=default]/protocols/protocol[identifier=BGP][name=BGP]/bgp/neighbors/neighbor[neighbor-address=192.168.255.1]/state/peer-group', 'val': 'EVPN-OVERLAY-PEERS'}], 'timestamp': 1626462768427044044}}\n{'update': {'update': [{'path': 'network-instances/network-instance[name=default]/protocols/protocol[identifier=BGP][name=BGP]/bgp/neighbors/neighbor[neighbor-address=192.168.255.1]/state/send-community', 'val': 'NONE'}], 'timestamp': 1626462768423035498}}\n{'update': {'update': [{'path': 'network-instances/network-instance[name=default]/protocols/protocol[name=BGP][identifier=BGP]/bgp/neighbors/neighbor[neighbor-address=192.168.255.1]/state/session-state', 'val': 'ACTIVE'}], 'timestamp': 1626462768469536321}}\n</code></pre> </p>"},{"location":"examples/pygnmi/#gnmi-set-rpc","title":"gNMI Set RPC","text":""},{"location":"examples/pygnmi/#update","title":"Update","text":"<p>The file update.py uses the pygnmi python module and uses the gNMI SET RPC (update)</p> <pre><code>python3 update.py\n</code></pre>"},{"location":"examples/pygnmi/#output","title":"output","text":"<p>GET RPC, interface Ethernet1 config, before the update</p> <pre><code>{\n\"notification\": [\n{\n\"timestamp\": 0,\n\"update\": [\n{\n\"path\": \"interfaces/interface[name=Ethernet1]/config\",\n\"val\": {\n\"arista-intf-augments:load-interval\": 300,\n\"openconfig-interfaces:description\": \"test1234\",\n\"openconfig-interfaces:enabled\": true,\n\"openconfig-interfaces:loopback-mode\": false,\n\"openconfig-interfaces:mtu\": 0,\n\"openconfig-interfaces:name\": \"Ethernet1\",\n\"openconfig-interfaces:type\": \"iana-if-type:ethernetCsmacd\",\n\"openconfig-vlan:tpid\": \"openconfig-vlan-types:TPID_0X8100\"\n}\n}\n]\n}\n]\n}\n</code></pre> <p>SET RPC, update, interface Ethernet1</p> <pre><code>{'response': [{'path': 'interfaces/interface[name=Ethernet1]', 'op': 'UPDATE'}]}\nGET RPC, interface Ethernet1 config, after the update\n{\n\"notification\": [\n{\n\"timestamp\": 0,\n\"update\": [\n{\n\"path\": \"interfaces/interface[name=Ethernet1]/config\",\n\"val\": {\n\"arista-intf-augments:load-interval\": 300,\n\"openconfig-interfaces:description\": \"Test\",\n\"openconfig-interfaces:enabled\": true,\n\"openconfig-interfaces:loopback-mode\": false,\n\"openconfig-interfaces:mtu\": 0,\n\"openconfig-interfaces:name\": \"Ethernet1\",\n\"openconfig-interfaces:type\": \"iana-if-type:ethernetCsmacd\",\n\"openconfig-vlan:tpid\": \"openconfig-vlan-types:TPID_0X8100\"\n}\n}\n]\n}\n]\n}\n</code></pre> <p></p>"},{"location":"examples/pygnmi/#delete","title":"Delete","text":"<p>The file delete.py uses the pygnmi python module and uses the gNMI SET RPC (delete)</p> <pre><code>python3 delete.py\n</code></pre> <p>output</p> <pre><code>{'response': [{'path': 'interfaces/interface[name=Ethernet1]/config/description', 'op': 'DELETE'}]}\n</code></pre>"},{"location":"examples/restconf/","title":"RESTCONF","text":""},{"location":"examples/restconf/#about-restconf","title":"About RESTCONF","text":"<p>RESTCONF is defined in the RFC 8040</p> <ul> <li>The GET method is sent by the client to retrieve data for a resource.</li> <li>The HEAD method is sent by the client to retrieve just the header fields (which contain the metadata for a resource) that would be returned for the comparable GET method, without the response message-body. It is supported for all resources that support the GET method.</li> <li>The POST method is sent by the client to create a data resource.</li> <li>The PUT method is sent by the client to create or replace the target data resource.</li> <li>The DELETE method is used to delete the target resource.</li> </ul>"},{"location":"examples/restconf/#eos-configuration","title":"EOS configuration","text":"<p>Please refer to this link</p>"},{"location":"examples/restconf/#eos-control-plane-acl","title":"EOS Control plane ACL","text":"<p>The default RESTCONF port on Arista devices is TCP 6020.</p> <p>We need to change the default control-plane ACL on EOS in order to allow TCP 6020 (or the configured RESTCONF TCP port).</p> <p>Please refer to this link</p>"},{"location":"examples/restconf/curl/","title":"RESTCONF with cURL","text":""},{"location":"examples/restconf/curl/#requirement-on-the-restconf-client","title":"Requirement on the RESTCONF client","text":"<pre><code>sudo apt-get update\nsudo apt-get -y upgrade\nsudo apt-get install curl jq -y\n</code></pre>"},{"location":"examples/restconf/curl/#restconf-examples-using-curl","title":"RESTCONF examples using cURL","text":""},{"location":"examples/restconf/curl/#get","title":"GET","text":""},{"location":"examples/restconf/curl/#get-interface-description-for-ethernet1","title":"Get interface description for Ethernet1","text":"<pre><code>curl -s GET 'https://192.0.2.105:6020/restconf/data/openconfig-interfaces:interfaces/interface=Ethernet1/config/description' \\\n--header 'Accept: application/yang-data+json' -u arista:arista  --insecure\n</code></pre> <p>Output:</p> <pre><code>{\"openconfig-interfaces:description\":\"P2P_LINK_TO_DC1-SPINE1_Ethernet1\"}\n</code></pre>"},{"location":"examples/restconf/curl/#get-interface-stats-for-ethernet1-and-output-the-in-octets-using-jq","title":"Get interface stats for Ethernet1 and output the \"in-octets\" using jq","text":"<pre><code>curl -s GET 'https://192.0.2.105:6020/restconf/data/openconfig-interfaces:interfaces/interface=Ethernet1' \\\n--header 'Accept: application/yang-data+json' -u arista:arista  \\\n--insecure | jq .'\"openconfig-interfaces:state\".counters.\"in-octets\"'\n</code></pre> <p>Output:</p> <pre><code>\"48284395\"\n</code></pre>"},{"location":"examples/restconf/curl/#get-interfaces-stats-and-output-the-name-of-the-second-third-index-using-jq","title":"Get interfaces stats and output the name of the second (third index) using jq","text":"<pre><code>curl -s GET 'https://192.0.2.105:6020/restconf/data/openconfig-interfaces:interfaces' \\\n--header 'Accept: application/yang-data+json' -u arista:arista \\\n--insecure | jq .'\"openconfig-interfaces:interface\"[2].name'\n</code></pre> <p>Output:</p> <pre><code>\"Ethernet1\"\n</code></pre>"},{"location":"examples/restconf/curl/#get-the-system-information-and-parse-the-hostname-using-jq","title":"Get the system information and parse the hostname using jq","text":"<pre><code>curl -X GET https://192.0.2.105:6020/restconf/data/system \\\n--header 'Accept: application/yang-data+json' -u arista:arista \\\n--insecure | jq .'\"openconfig-system:config\".hostname'\n</code></pre> <p>Output:</p> <pre><code>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n                                 Dload  Upload   Total   Spent    Left  Speed\n100 66151    0 66151    0     0   284k      0 --:--:-- --:--:-- --:--:--  284k\n\"switch1\"\n</code></pre>"},{"location":"examples/restconf/curl/#get-pfxrcd-and-pfxacc-stats-from-a-bgp-neighbor","title":"Get PfxRcd and PfxAcc stats from a BGP neighbor","text":"<pre><code> curl -s GET 'https://192.0.2.100:5900/restconf/data/network-instances/network-instance=default/protocols/protocol=BGP,BGP/bgp/neighbors/neighbor=192.0.2.21/afi-safis/afi-safi=IPV4_UNICAST' \\\n--header 'Accept: application/yang-data+json' -u cvpadmin:arastra --insecure | jq\n</code></pre> <p>Output:</p> <pre><code>{\n\"openconfig-network-instance:afi-safi-name\": \"openconfig-bgp-types:IPV4_UNICAST\",\n  \"openconfig-network-instance:config\": {\n\"afi-safi-name\": \"openconfig-bgp-types:IPV4_UNICAST\"\n},\n  \"openconfig-network-instance:state\": {\n\"afi-safi-name\": \"openconfig-bgp-types:IPV4_UNICAST\",\n    \"prefixes\": {\n\"arista-bgp-augments:best-ecmp-paths\": 0,\n      \"arista-bgp-augments:best-paths\": 0,\n      \"installed\": 7,\n      \"received\": 7,\n      \"sent\": 7\n}\n}\n}\n</code></pre> <p>NOTE: The protocol must have multiple keys, i.e.: <code>protocol=BGP,BGP</code>, in this case, it's the <code>identifier</code> and the <code>name</code> of the protocol, if either of these is omitted; on the switch side in the Octa/OpenConfig agent logs an error similar to the following would be generated:</p> <p><code>handler.go:95] ERROR mismatch between number of keys in [identifier name] and values present [BGP]</code> or if are omitted the error message would be: <code>handler.go:95] ERROR failed to find key values after element \"protocol\" in \"network-instances/network-instance=default/protocols/protocol</code></p> <p>Tip: pyang can be useful to understand what keys each leaf requires, e.g:</p> <pre><code>pyang openconfig-network-instance.yang -f tree --tree-depth=4 | tail -n 4\n|        ...\n   +--rw protocols\n      +--rw protocol* [identifier name]\n...\n</code></pre>"},{"location":"examples/restconf/curl/#head","title":"HEAD","text":"<pre><code>curl --head 'https://192.0.2.105:6020/restconf/data/openconfig-interfaces:interfaces/interface=Ethernet1' \\\n--header 'Accept: application/yang-data+json' -u arista:arista  --insecure\n</code></pre> <p>output</p> <pre><code>HTTP/1.1 200 OK\nContent-Type: application/yang.data+json\nDate: Sun, 04 Jul 2021 14:20:39 GMT\n</code></pre>"},{"location":"examples/restconf/curl/#put","title":"PUT","text":""},{"location":"examples/restconf/curl/#interface-configuration-example","title":"Interface configuration example","text":"<p>Let's check before the change</p> <pre><code>curl -s GET 'https://192.0.2.105:6020/restconf/data/openconfig-interfaces:interfaces/interface=Ethernet4/config' \\\n--header 'Accept: application/yang-data+json' -u arista:arista  --insecure\n</code></pre> <p>output</p> <pre><code>{\"openconfig-interfaces:description\":\"blabla\",\"openconfig-interfaces:enabled\":false,\"arista-intf-augments:load-interval\":300,\"openconfig-interfaces:loopback-mode\":false,\"openconfig-interfaces:mtu\":0,\"openconfig-interfaces:name\":\"Ethernet4\",\"openconfig-vlan:tpid\":\"openconfig-vlan-types:TPID_0X8100\",\"openconfig-interfaces:type\":\"iana-if-type:ethernetCsmacd\"}\n</code></pre> <p>Let's use the file interface.json</p> <pre><code>more interface.json\n</code></pre> <p>output</p> <pre><code>{\"enabled\":true,\"name\":\"Ethernet4\", \"description\":\"restconf_test\"}\n</code></pre> <pre><code>curl -X PUT https://192.0.2.105:6020/restconf/data/openconfig-interfaces:interfaces/interface=Ethernet4/config \\\n-H 'Content-Type: application/json' -u arista:arista -d @interface.json  --insecure\n</code></pre> <p>output</p> <pre><code>{\"openconfig-interfaces:description\":\"restconf_test\",\"openconfig-interfaces:enabled\":true,\"openconfig-interfaces:name\":\"Ethernet4\"}\n</code></pre> <p>Let's verify after the change</p> <pre><code>curl -s GET 'https://192.0.2.105:6020/restconf/data/openconfig-interfaces:interfaces/interface=Ethernet4/config' \\\n--header 'Accept: application/yang-data+json' -u arista:arista  --insecure\n</code></pre> <p>output</p> <pre><code>{\"openconfig-interfaces:description\":\"restconf_test\",\"openconfig-interfaces:enabled\":true,\"arista-intf-augments:load-interval\":300,\"openconfig-interfaces:loopback-mode\":false,\"openconfig-interfaces:mtu\":0,\"openconfig-interfaces:name\":\"Ethernet4\",\"openconfig-vlan:tpid\":\"openconfig-vlan-types:TPID_0X8100\",\"openconfig-interfaces:type\":\"iana-if-type:ethernetCsmacd\"}\n</code></pre> <pre><code>curl -s GET 'https://192.0.2.105:6020/restconf/data/openconfig-interfaces:interfaces/interface=Ethernet4/config' \\\n--header 'Accept: application/yang-data+json' -u arista:arista  --insecure | jq .\n</code></pre> <p>output</p> <pre><code>{\n\"openconfig-interfaces:description\": \"restconf_test\",\n\"openconfig-interfaces:enabled\": true,\n\"arista-intf-augments:load-interval\": 300,\n\"openconfig-interfaces:loopback-mode\": false,\n\"openconfig-interfaces:mtu\": 0,\n\"openconfig-interfaces:name\": \"Ethernet4\",\n\"openconfig-vlan:tpid\": \"openconfig-vlan-types:TPID_0X8100\",\n\"openconfig-interfaces:type\": \"iana-if-type:ethernetCsmacd\"\n}\n</code></pre>"},{"location":"examples/restconf/curl/#device-hostname-example","title":"Device hostname example","text":"<p>Let's check before the change</p> <pre><code>curl -X GET https://192.0.2.105:6020/restconf/data/system/config \\\n--header 'Accept: application/yang-data+json' -u arista:arista  --insecure\n</code></pre> <p>output</p> <pre><code>{\"openconfig-system:hostname\":\"DC1-LEAF1A\"}\n</code></pre> <pre><code>curl -X GET https://192.0.2.105:6020/restconf/data/system \\\n--header 'Accept: application/yang-data+json' -u arista:arista \\\n--insecure | jq .'\"openconfig-system:config\".hostname'\n</code></pre> <p>output</p> <pre><code>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n                                 Dload  Upload   Total   Spent    Left  Speed\n100 74748    0 74748    0     0   300k      0 --:--:-- --:--:-- --:--:--  300k\n\"DC1-LEAF1A\"\n</code></pre> <pre><code>curl -X PUT https://192.0.2.105:6020/restconf/data/system/config \\\n-H 'Content-Type: application/json' -u arista:arista \\\n-d '{\"openconfig-system:hostname\":\"test\"}'  --insecure\n</code></pre> <p>output</p> <pre><code>{\"openconfig-system:hostname\":\"test\"}\n</code></pre> <p>Let's verify after the change</p> <pre><code>curl -X GET https://192.0.2.105:6020/restconf/data/system/config \\\n--header 'Accept: application/yang-data+json' -u arista:arista  --insecure\n</code></pre> <p>output</p> <pre><code>{\"openconfig-system:hostname\":\"test\"}\n</code></pre>"},{"location":"examples/restconf/curl/#post","title":"POST","text":""},{"location":"examples/restconf/curl/#interface-configuration-example_1","title":"Interface configuration example","text":"<p>Let's check before the change</p> <pre><code>curl -s GET 'https://192.0.2.105:6020/restconf/data/openconfig-interfaces:interfaces/interface=Ethernet4' \\\n--header 'Accept: application/yang-data+json' -u arista:arista \\\n--insecure | jq .'\"openconfig-interfaces:config\"'\n</code></pre> <p>output</p> <pre><code>{\n\"description\": \"\",\n\"enabled\": true,\n\"arista-intf-augments:load-interval\": 300,\n\"loopback-mode\": false,\n\"mtu\": 0,\n\"name\": \"Ethernet4\",\n\"openconfig-vlan:tpid\": \"openconfig-vlan-types:TPID_0X8100\",\n\"type\": \"iana-if-type:ethernetCsmacd\"\n}\n</code></pre> <pre><code>curl -X POST https://192.0.2.105:6020/restconf/data/openconfig-interfaces:interfaces/interface=Ethernet4/config \\\n-H 'Content-Type: application/json' -u arista:arista \\\n-d '{\"openconfig-interfaces:description\":\"restconf_test\"}' --insecure\n</code></pre> <p>output</p> <pre><code>{\"openconfig-interfaces:description\":\"restconf_test\"}\n</code></pre> <pre><code>curl -X POST https://192.0.2.105:6020/restconf/data/openconfig-interfaces:interfaces/interface=Ethernet4/config \\\n-H 'Content-Type: application/json' -u arista:arista \\\n-d '{\"openconfig-interfaces:enabled\":false}'  --insecure\n</code></pre> <p>output</p> <pre><code>{\"openconfig-interfaces:enabled\":false}\n</code></pre> <p>Let's verify after the change</p> <pre><code>curl -s GET 'https://192.0.2.105:6020/restconf/data/openconfig-interfaces:interfaces/interface=Ethernet4' \\\n--header 'Accept: application/yang-data+json' -u arista:arista \\\n--insecure | jq .'\"openconfig-interfaces:config\".description'\n</code></pre> <p>output</p> <pre><code>\"restconf_test\"\n</code></pre> <pre><code>curl -s GET 'https://192.0.2.105:6020/restconf/data/openconfig-interfaces:interfaces/interface=Ethernet4' \\\n--header 'Accept: application/yang-data+json' \\\n-u arista:arista  --insecure | jq .'\"openconfig-interfaces:config\"'\n</code></pre> <p>output</p> <pre><code>{\n\"description\": \"restconf_test\",\n\"enabled\": false,\n\"arista-intf-augments:load-interval\": 300,\n\"loopback-mode\": false,\n\"mtu\": 0,\n\"name\": \"Ethernet4\",\n\"openconfig-vlan:tpid\": \"openconfig-vlan-types:TPID_0X8100\",\n\"type\": \"iana-if-type:ethernetCsmacd\"\n}\n</code></pre>"},{"location":"examples/restconf/curl/#delete","title":"DELETE","text":"<p>Let's check before the change</p> <pre><code>curl -s GET 'https://192.0.2.105:6020/restconf/data/ietf-interfaces:interfaces/interface=Loopback100' \\\n--header 'Accept: application/yang-data+json' -u arista:arista  --insecure\n</code></pre> <p>output</p> <pre><code>{\"openconfig-interfaces:config\":{\"description\":\"test\",\"enabled\":true,\"arista-intf-augments:load-interval\":300,\"loopback-mode\":true,\"name\":\"Loopback100\",\"openconfig-vlan:tpid\":\"openconfig-vlan-types:TPID_0X8100\",\"type\":\"iana-if-type:softwareLoopback\"},\"openconfig-interfaces:hold-time\":{\"config\":{\"down\":0,\"up\":0},\"state\":{\"down\":0,\"up\":0}},\"openconfig-interfaces:name\":\"Loopback100\",\"openconfig-interfaces:state\":{\"enabled\":true,\"loopback-mode\":false,\"openconfig-vlan:tpid\":\"openconfig-vlan-types:TPID_0X8100\"},\"openconfig-interfaces:subinterfaces\":{\"subinterface\":[{\"config\":{\"description\":\"test\",\"enabled\":true,\"index\":0},\"index\":0,\"openconfig-if-ip:ipv4\":{\"config\":{\"dhcp-client\":false,\"enabled\":true,\"mtu\":1500},\"state\":{\"dhcp-client\":false,\"enabled\":true,\"mtu\":1500}},\"openconfig-if-ip:ipv6\":{\"config\":{\"dhcp-client\":false,\"enabled\":false,\"mtu\":1500},\"state\":{\"dhcp-client\":false,\"enabled\":false,\"mtu\":1500}},\"state\":{\"enabled\":true,\"index\":0}}]}}\n</code></pre> <pre><code>curl -X DELETE https://192.0.2.105:6020/restconf/data/ietf-interfaces:interfaces/interface=Loopback100 \\\n-u arista:arista  --insecure\n</code></pre>"},{"location":"examples/restconf/python/","title":"RESTCONF with Python","text":""},{"location":"examples/restconf/python/#requirement-on-the-restconf-client","title":"Requirement on the RESTCONF client","text":"<pre><code>sudo apt-get update\nsudo apt-get -y upgrade\npip install requests\n</code></pre> <pre><code>pip3 freeze | grep requests\n</code></pre>"},{"location":"examples/restconf/python/#restconf-examples-with-python","title":"RESTCONF examples with Python","text":""},{"location":"examples/restconf/python/#get","title":"GET","text":"<pre><code>$ python3\nPython 3.6.9 (default, Jan 26 2021, 15:33:00)\n[GCC 8.4.0] on linux\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n&gt;&gt;&gt; import requests\n&gt;&gt;&gt; from requests.auth import HTTPBasicAuth\n&gt;&gt;&gt; import json\n&gt;&gt;&gt; USER = 'arista'\n&gt;&gt;&gt; PASS = 'arista'\n&gt;&gt;&gt; requests.packages.urllib3.disable_warnings()\n&gt;&gt;&gt; headers = {'Content-Type': 'application/yang-data+json', 'Accept': 'application/yang-data+json'}\n&gt;&gt;&gt; headers = {'Accept': 'application/yang-data+json'}\n&gt;&gt;&gt; api_call = \"https://10.73.1.105:6020/restconf/data/openconfig-interfaces:interfaces/interface=Ethernet1/state\"\n&gt;&gt;&gt; result = requests.get(api_call, auth=HTTPBasicAuth(USER, PASS), headers=headers, verify=False)\n&gt;&gt;&gt; result.status_code\n200\n&gt;&gt;&gt; result.ok\nTrue\n&gt;&gt;&gt; result.url\n'https://10.73.1.105:6020/restconf/data/openconfig-interfaces:interfaces/interface=Ethernet1/state'\n&gt;&gt;&gt; result.content\nb'{\"openconfig-interfaces:admin-status\":\"UP\",\"openconfig-interfaces:counters\":{\"in-broadcast-pkts\":\"0\",\"in-discards\":\"0\",\"in-errors\":\"0\",\"in-fcs-errors\":\"0\",\"in-multicast-pkts\":\"972\",\"in-octets\":\"116602\",\"in-unicast-pkts\":\"131\",\"out-broadcast-pkts\":\"1\",\"out-discards\":\"0\",\"out-errors\":\"0\",\"out-multicast-pkts\":\"1761\",\"out-octets\":\"199997\",\"out-unicast-pkts\":\"122\"},\"openconfig-interfaces:description\":\"restconf_test\",\"openconfig-interfaces:enabled\":true,\"openconfig-platform-port:hardware-port\":\"Port1\",\"openconfig-interfaces:ifindex\":1,\"arista-intf-augments:inactive\":false,\"openconfig-interfaces:last-change\":\"1624966430515012864\",\"openconfig-interfaces:loopback-mode\":false,\"openconfig-interfaces:mtu\":0,\"openconfig-interfaces:name\":\"Ethernet1\",\"openconfig-interfaces:oper-status\":\"UP\",\"openconfig-vlan:tpid\":\"openconfig-vlan-types:TPID_0X8100\",\"openconfig-interfaces:type\":\"iana-if-type:ethernetCsmacd\"}\\n'\n&gt;&gt;&gt; result.json()\n{'openconfig-interfaces:admin-status': 'UP', 'openconfig-interfaces:counters': {'in-broadcast-pkts': '0', 'in-discards':\n'0', 'in-errors': '0', 'in-fcs-errors': '0', 'in-multicast-pkts': '972', 'in-octets': '116602', 'in-unicast-pkts':\n'131', 'out-broadcast-pkts': '1', 'out-discards': '0', 'out-errors': '0', 'out-multicast-pkts': '1761', 'out-octets':\n'199997', 'out-unicast-pkts': '122'}, 'openconfig-interfaces:description': 'restconf_test',\n'openconfig-interfaces:enabled': True, 'openconfig-platform-port:hardware-port': 'Port1',\n'openconfig-interfaces:ifindex': 1, 'arista-intf-augments:inactive': False, 'openconfig-interfaces:last-change':\n'1624966430515012864', 'openconfig-interfaces:loopback-mode': False, 'openconfig-interfaces:mtu': 0,\n'openconfig-interfaces:name': 'Ethernet1', 'openconfig-interfaces:oper-status': 'UP', 'openconfig-vlan:tpid':\n'openconfig-vlan-types:TPID_0X8100', 'openconfig-interfaces:type': 'iana-if-type:ethernetCsmacd'}\n&gt;&gt;&gt; result.json()['openconfig-interfaces:oper-status']\n'UP'\n&gt;&gt;&gt; result.json()['openconfig-interfaces:counters']['out-octets']\n'199997'\n&gt;&gt;&gt; exit()\n</code></pre> <p>Execute the python script get_eth1_status.py</p> <pre><code>python3 get_eth1_status.py\n</code></pre> <p>output</p> <pre><code>{'arista-intf-augments:inactive': False,\n'openconfig-interfaces:admin-status': 'UP',\n'openconfig-interfaces:counters': {'in-broadcast-pkts': '0',\n'in-discards': '0',\n'in-errors': '0',\n'in-fcs-errors': '0',\n'in-multicast-pkts': '1762',\n'in-octets': '202553',\n'in-unicast-pkts': '183',\n'out-broadcast-pkts': '1',\n'out-discards': '0',\n'out-errors': '0',\n'out-multicast-pkts': '2552',\n'out-octets': '284793',\n'out-unicast-pkts': '174'},\n'openconfig-interfaces:description': 'restconf_test',\n'openconfig-interfaces:enabled': True,\n'openconfig-interfaces:ifindex': 1,\n'openconfig-interfaces:last-change': '1624966430515012864',\n'openconfig-interfaces:loopback-mode': False,\n'openconfig-interfaces:mtu': 0,\n'openconfig-interfaces:name': 'Ethernet1',\n'openconfig-interfaces:oper-status': 'UP',\n'openconfig-interfaces:type': 'iana-if-type:ethernetCsmacd',\n'openconfig-platform-port:hardware-port': 'Port1',\n'openconfig-vlan:tpid': 'openconfig-vlan-types:TPID_0X8100'}\n</code></pre>"},{"location":"examples/restconf/python/#head","title":"HEAD","text":"<p>Execute the python script head.py</p> <pre><code>python3 head.py\n</code></pre> <p>output</p> <pre><code>url is https://10.73.1.105:6020/restconf/data/openconfig-interfaces:interfaces/interface=Ethernet1/state\nstatus_code is 200\nheaders are {'Content-Type': 'application/yang.data+json', 'Date': 'Sun, 18 Jul 2021 08:49:52 GMT'}\ncontent is b''\n</code></pre>"},{"location":"examples/restconf/python/#delete","title":"DELETE","text":"<p>Execute the python script delete_lo100.py</p> <pre><code>python3 delete_lo100.py\n</code></pre> <p>output (note the following has been formatted for readability.)</p> <pre><code>get int lo100\nstatus_code is 200\ncontent is\n{'openconfig-interfaces:config': {'description': '222', 'enabled': True, 'arista-intf-augments:load-interval': 300,\n'loopback-mode': True, 'name': 'Loopback100', 'openconfig-vlan:tpid': 'openconfig-vlan-types:TPID_0X8100', 'type':\n'iana-if-type:softwareLoopback'}, 'openconfig-interfaces:hold-time': {'config': {'down': 0, 'up': 0}, 'state': {'down':\n0, 'up': 0}}, 'openconfig-interfaces:name': 'Loopback100', 'openconfig-interfaces:state': {'enabled': True,\n'loopback-mode': False, 'openconfig-vlan:tpid': 'openconfig-vlan-types:TPID_0X8100'},\n'openconfig-interfaces:subinterfaces': {'subinterface': [{'config': {'description': '222', 'enabled': True, 'index': 0},\n'index': 0, 'openconfig-if-ip:ipv4': {'config': {'dhcp-client': False, 'enabled': True, 'mtu': 1500}, 'state':\n{'dhcp-client': False, 'enabled': True, 'mtu': 1500}}, 'openconfig-if-ip:ipv6': {'config': {'dhcp-client': False,\n'enabled': False, 'mtu': 1500}, 'state': {'dhcp-client': False, 'enabled': False, 'mtu': 1500}}, 'state': {'enabled':\nTrue, 'index': 0}}]}}\ndeleting int lo100\nstatus_code is 200\n</code></pre>"},{"location":"examples/ygot/","title":"ygot","text":""},{"location":"examples/ygot/#overview","title":"Overview","text":"<p>ygot is a collection of Go utilities that can generate Go structures based off of YANG modules. In the demo we are going to generate go code based off of the openconfig-system model using ygot.</p>"},{"location":"examples/ygot/#demo-actions","title":"Demo Actions","text":"<ul> <li>Import the necessary YANG files for openconfig-system to create a hostname.</li> <li>The hostname will be printed out and stored within the system.json file.</li> <li>Using the Arista gNMI binary we will configure a   device with the ceos1 hostname.</li> </ul>"},{"location":"examples/ygot/#clone-this-repo","title":"Clone this repo","text":"<pre><code>git clone https://github.com/aristanetworks/openmgmt &amp;&amp; cd openmgmt/src/ygot\n</code></pre>"},{"location":"examples/ygot/#install-ygot","title":"Install ygot","text":"<pre><code>go get github.com/openconfig/ygot\n</code></pre>"},{"location":"examples/ygot/#check-to-see-if-all-of-the-current-yang-files-are-accurate","title":"Check to see if all of the current YANG files are accurate","text":"<pre><code>tree -f yang/\n</code></pre>  Reveal output <p> <pre><code>\u251c\u2500\u2500 yang/openconfig-aaa-radius.yang\n\u251c\u2500\u2500 yang/openconfig-aaa-tacacs.yang\n\u251c\u2500\u2500 yang/openconfig-aaa-types.yang\n\u251c\u2500\u2500 yang/openconfig-aaa.yang\n\u251c\u2500\u2500 yang/openconfig-alarms.yang\n\u251c\u2500\u2500 yang/openconfig-alarm-types.yang\n\u251c\u2500\u2500 yang/openconfig-extensions.yang\n\u251c\u2500\u2500 yang/openconfig-inet-types.yang\n\u251c\u2500\u2500 yang/openconfig-license.yang\n\u251c\u2500\u2500 yang/openconfig-messages.yang\n\u251c\u2500\u2500 yang/openconfig-platform-types.yang\n\u251c\u2500\u2500 yang/openconfig-platform.yang\n\u251c\u2500\u2500 yang/openconfig-procmon.yang\n\u251c\u2500\u2500 yang/openconfig-system-logging.yang\n\u251c\u2500\u2500 yang/openconfig-system-management.yang\n\u251c\u2500\u2500 yang/openconfig-system-terminal.yang\n\u251c\u2500\u2500 yang/openconfig-system.yang\n\u251c\u2500\u2500 yang/openconfig-types.yang\n\u2514\u2500\u2500 yang/openconfig-yang-types.yang\n</code></pre> </p>"},{"location":"examples/ygot/#run-ygot","title":"Run ygot","text":"<pre><code>go run $GOPATH/src/github.com/openconfig/ygot/generator/generator.go      \\\n-path=yang -output_file=pkg/oc.go -package_name=oc -generate_fakeroot   \\\n-fakeroot_name=device -compress_paths=true  yang/openconfig-system.yang\n</code></pre>"},{"location":"examples/ygot/#check-the-contents-of-pkgocgo","title":"Check the contents of pkg/oc.go","text":"<pre><code>pkg\n\u2514\u2500\u2500 oc.go\n</code></pre> <p><code>oc.go</code> is the necessary go import / package for openconfig-system. Looking at the Device struct within <code>pkg/oc.go</code></p> <pre><code>type Device struct {\nComponent map[string]*Component `path:\"components/component\" module:\"openconfig-platform\"`\nMessages  *Messages `path:\"messages\" module:\"openconfig-messages\"`\nSystem *System `path:\"system\" module:\"openconfig-system\"`\n}\n</code></pre> <p>Looking at the <code>System</code> struct we can see the <code>Hostname</code> field.</p> <pre><code>type System struct {\nHostname *string `path:\"config/hostname\" module:\"openconfig-system\"`\n}\n</code></pre> <p>We need to fill in the Hostname field and pass it through the EmitJSON function so we can render this model with the correct information which can be found in <code>main.go</code>.</p>"},{"location":"examples/ygot/#run-the-go-code","title":"Run the go code","text":"<pre><code>go run main.go\n</code></pre> <p>Output:</p> Reveal output <p> <pre><code>{\n\"openconfig-system:system\": {\n\"config\": {\n\"hostname\": \"ceos1\"\n}\n}\n}\n</code></pre>  The output is also within `config/hostname.json` which is the same as the printed version.  </p>"},{"location":"examples/ygot/#change-the-hostname-on-a-device","title":"Change the hostname on a device","text":"<pre><code>gnmi -addr ${DEVICEIP}:6030 -username admin -password admin update '/' config/hostname.json\n</code></pre> <p>The device should now have the ceos1 hostname.</p>"},{"location":"models/","title":"Device Models","text":""},{"location":"models/#overview","title":"Overview","text":"<p>What are YANG models and why should I care?</p> <p>Models are structured representations of network elements and their associated configured and operational state.</p> <p>YANG (Yet Another Next Generation - RFC6020) is a data modeling language. YANG is used to describe the configured and operational state of network elements. This allows for the consistent and structured representation of device and protocol attributes. The model definition typically includes the low level data types used to represent operational attributes as well as constraints that should be enforced in configuration.</p> <p>These modeled representations provide a consistent mechanism for device configuration as well as validating the device state through streaming telemetry or other device interrogation methods. These modeled device representations can also be transformed into data structures that can be used by configuration systems to dynamically control device configuration or state.</p> <p>YANG has been adopted as the official modeling language of the IETF and the OpenConfig group.</p>"},{"location":"models/#ietf-models","title":"IETF models","text":"<p>The for the past few years the IETF has been providing models for previously standardized technologies as well as protocols and technologies which are under active standardization. These models are commonly used with complementary IETF standardized network management protocols (for example, NETCONF and RESTCONF) and have been selectively incorporated into other modeling initiatives.</p>"},{"location":"models/#openconfig-models","title":"OpenConfig models","text":"<p>OpenConfig is an operator led group defining models for network devices. Their models have been widely adopted by a number of vendors including Arista and an ecosystem of open source tooling has emerged to utilize these models for telemetry and configuration applications.</p> <p>In addition to defining device and protocol models the OpenConfig group has defined complementary network management protocols which leverage these models for telemetry (gNMI), configuration (gNMI), operational activities (gNOI) and RIB manipulation (gRIBI).  Though it bears noting that OpenConfig models can also be used with NETCONF and RESTCONF protocols as well.</p> <p>Details regarding the OpenConfig model support within Arista's EOS software can be found online.</p>"},{"location":"models/#vendor-specific-models","title":"Vendor-Specific Models","text":"<p>While standard models provide a wide range of feature coverage there is commonly a need to model vendor-specific device or feature operation. Examples of this may include device specific behaviors (hardware configuration details) or pre-standard functionality that is deployed in operator networks that needs to be managed using the same tooling.</p> <p>Vendors may opt to define all new models which are published independently. Alternately, vendors may choose to leverage an existing standardized model and add vendor-specific elements to the standard models these are known as model augments. These augments are commonly published to allow integration into operator tooling.</p> <p>Arista publishes augments associated with a given EOS release on GitHub.</p>"},{"location":"models/#references-resources","title":"References / Resources","text":"<ul> <li>YANG RFC</li> <li>Repository of OpenConfig YANG models</li> <li>Arista Networks YANG Repository</li> </ul>"},{"location":"protocols/","title":"Management Protocols","text":""},{"location":"protocols/#overview","title":"Overview","text":""},{"location":"protocols/#ssh-cli","title":"ssh (CLI)","text":""},{"location":"protocols/#eapi","title":"eAPI","text":""},{"location":"protocols/#grpc","title":"gRPC","text":"<p>gRPC is a Remote Procedure Call (RPC) framework that OpenConfig utilizes as a transport. Services built with gRPC are defined in <code>.proto</code> files. They describe the RPCs supported by the service and the data types exchanged in those RPCs.</p> <p>The OpenConfig group originally published openconfig.proto, but have since deprecated it in favor of gnmi.proto. The current EOS versions supports gnmi.proto v0.7 and includes support for Get, Subscribe, Set, and Capabilities RPCs.</p> <p>Note: Support for openconfig.proto was dropped in EOS-4.23.0F+.</p> <p>A client application is required to communicate with a gRPC service. A sample application can be found on the Arista GitHub account: gnmi. <code>gnmi</code> is a simple command-line client for gNMI written in Go that can be used for testing and prototyping.</p> <p>Another popular gnmi client is gnmic.</p>"},{"location":"protocols/#netconf","title":"NETCONF","text":"<p>NETCONF provides mechanisms to install, manipulate and delete the configuration of network devices. It uses eXtensible Markup Language (XML) based data encoding for the configuration data as well as protocol messages. The NETCONF protocol operations are realized as RPCs over ssh transport.</p>"},{"location":"protocols/#restconf","title":"RESTCONF","text":""},{"location":"protocols/#references-resources","title":"References / Resources","text":"<ul> <li>NETCONF RFC: https://tools.ietf.org/html/rfc6241</li> <li>RESTCONF RFC: https://tools.ietf.org/html/rfc8040</li> </ul>"},{"location":"telemetry/","title":"Device Telemetry","text":""},{"location":"telemetry/#overview","title":"overview","text":""},{"location":"telemetry/#gnmi","title":"gNMI","text":""},{"location":"telemetry/#eos-native-streaming-terminattr","title":"EOS native streaming (TerminAttr)","text":""},{"location":"telemetry/#openconfig","title":"OpenConfig","text":""},{"location":"telemetry/#openconfig-terminattr-octa","title":"OpenConfig + TerminAttr (Octa)","text":""},{"location":"telemetry/#rpcs","title":"RPCs","text":""},{"location":"telemetry/#subscription-types","title":"subscription types","text":""},{"location":"telemetry/#once","title":"ONCE","text":""},{"location":"telemetry/#stream","title":"STREAM","text":""},{"location":"telemetry/#poll","title":"POLL","text":""},{"location":"telemetry/#references-resources","title":"References / Resources","text":""},{"location":"telemetry/adapters/gnmireverse/","title":"gNMIReverse Examples","text":""},{"location":"telemetry/adapters/gnmireverse/#introduction","title":"Introduction","text":"<p>gNMIReverse is a Dial-Out gRPC service (available on our Github page) that reverses the direction of the dial for gNMI Subscriptions. The gNMIReverse client (running along with gNMI target) on the switch sends data to the gNMIReverse Server.</p> <p>This article contains steps on how to build the gNMIReverse client and server binaries and examples on how to configure, the daemon to run the gNMIReverse client on EOS.</p>"},{"location":"telemetry/adapters/gnmireverse/#prerequisite","title":"Prerequisite","text":"<p>The following tools are required to proceed with this setup including cloning the repository and compiling client binary for EOS.</p> <ul> <li>Go</li> <li>Git</li> </ul>"},{"location":"telemetry/adapters/gnmireverse/#installing-and-configuring-gnmireverse-client","title":"Installing and configuring gNMIReverse client","text":""},{"location":"telemetry/adapters/gnmireverse/#building-the-client-and-server-binaries","title":"Building the client and server binaries","text":"<p>Pull the repository from GitHub (or you can use git clone)</p> <pre><code>go get -u github.com/aristanetworks/goarista/gnmireverse\n</code></pre> <p>Go to the gNMIReverse directory (or the directory to which you have cloned the repo using git clone)</p> <pre><code>cd $GOPATH/src/github.com/aristanetworks/goarista/gnmireverse/\n</code></pre> <p>Compile the package for both server and client</p> <pre><code>cd $GOPATH/src/github.com/aristanetworks/goarista/gnmireverse/client\nGOOS=linux GOARCH=386 go build\n\ncd $GOPATH/src/github.com/aristanetworks/goarista/gnmireverse/server\nGOOS=linux GOARCH=386 go build\n</code></pre> <p>NOTE: For EOS with x86_64 architecture, compile the package as follows for the client:</p> <pre><code>\ncd $GOPATH/src/github.com/aristanetworks/goarista/gnmireverse/client\nGOOS=linux GOARCH=amd64 go build\n\ncd $GOPATH/src/github.com/aristanetworks/goarista/gnmireverse/server\nGOOS=linux GOARCH=amd64 go build\n</code></pre> <p>Copy the client binary file to switch /mnt/flash/ directory</p> <pre><code>scp $GOPATH/src/github.com/aristanetworks/goarista/gnmireverse/client/client admin@&lt;switch-MGMT-IP&gt;:/mnt/flash/\n</code></pre>"},{"location":"telemetry/adapters/gnmireverse/#gnmireverse-client-daemon-configuration","title":"gNMIReverse client daemon Configuration","text":"<p>First enable gNMI server on the switch (Octa can be enabled if required, as discussed later in this article)</p>"},{"location":"telemetry/adapters/gnmireverse/#non-default-vrf","title":"Non-default VRF","text":"<pre><code>!\nmanagement api gnmi\n   transport grpc def\n       vrf management\n   provider eos-native\n!</code></pre> <p>In the above example, we have the gNMI server running on default port 6030 in VRF management on the switch.</p> <pre><code># show management api gnmi\nOcta:               enabled\nEnabled:            Yes\nServer:             running on port 6030, in management VRF\nSSL Profile:        none\nQoS DSCP:           none\nAuthorization Required:No\n</code></pre> <p>gNMIReverse client daemon configuration (non-default VRF):</p> <p>Note: The <code>\\</code> elements have been added to aid readability, these should be removed when entering the configuration.</p> <pre><code>daemon gnmi_reverse_client_1\n   exec /mnt/flash/client -username cvpadmin -password arista         \\\n     -target_addr=management/127.0.0.1:6030                           \\\n     -collector_addr=management/198.51.100.115:6000                    \\\n     -collector_tls=false                                             \\\n     -target_value=gb421                                              \\\n     -sample /system/processes/process[pid=*]/state@15s\n   no shutdown\n</code></pre>"},{"location":"telemetry/adapters/gnmireverse/#default-vrf","title":"Default VRF","text":"<pre><code>!\nmanagement api gnmi\n   transport grpc def\n   provider eos-native\n!\n</code></pre> <p>gNMI server running on default port 6030 in default VRF on the switch.</p> <pre><code># show management api gnmi\nOcta:               enabled\nEnabled:            Yes\nServer:             running on port 6030, in default VRF\nSSL Profile:        none\nQoS DSCP:           none\nAuthorization Required:No\n</code></pre> <p>gNMIReverse client daemon configuration (default VRF):</p> <p>Note: The <code>\\</code> elements have been added to aid readability, these should be removed when entering the configuration.</p> <pre><code>daemon gnmi_reverse_client_1\n   exec /mnt/flash/client -username cvpadmin -password arista \\\n     -target_addr=127.0.0.1:6030                              \\\n     -collector_addr=198.51.100.115:6000 -collector_tls=false  \\\n     -target_value=gb421 -sample /system/processes/process[pid=*]/state@15s\n   no shutdown\n</code></pre> <p>The gNMIReverse client flags are explained below.</p> flag description username Username to authenticate with the target (gNMI server) password Password to authenticate with the target (gNMI server) target_addr Address of the gNMI server running on the switch. <code>[&lt;vrf-name&gt;/]address:port</code> collector_addr Address of the gNMIReverse server. <code>[&lt;vrf-name&gt;/]host:port</code> collector_tls use TLS in connection with collector (default true) target_value To include the device name sample Path to subscribe with SAMPLE subscription mode. <code>&lt;path&gt;@&lt;time-interval&gt;</code>  Ex. <code>-sample /interfaces/interface/state/counters@30s</code> subscribe Path to subscribe with TARGET_DEFINED subscription mode if there are any changes on the subscribe path"},{"location":"telemetry/adapters/gnmireverse/#running-the-gnmireverse-server","title":"Running the gNMIReverse Server","text":"<pre><code>$ ./server -tls=false -addr=198.51.100.115:6000\n\n[2020-12-28T10:52:17.990029143Z] (gb421) /system/processes/process[pid=1919]/state/cpu-usage-system = 89538\n[2020-12-28T10:52:27.990635976Z] (gb421) /system/processes/process[pid=1919]/state/cpu-usage-user = 312674\n[2020-12-28T10:52:27.990681209Z] (gb421) /system/processes/process[pid=1919]/state/cpu-utilization = 0\n[2020-12-28T10:52:07.990565267Z] (gb421) /system/processes/process[pid=1919]/state/memory-usage = 403599360\n[2020-12-28T09:28:37.99397Z] (gb421) /system/processes/process[pid=1919]/state/name = ConfigAgent\n[2020-12-28T09:28:27.975545302Z] (gb421) /system/processes/process[pid=1919]/state/pid = 1919\n[2020-12-28T09:28:38.058955133Z] (gb421) /system/processes/process[pid=1919]/state/start-time = 1608564420584540928\n</code></pre> <p>We can see samples from switch gb421 (gNMIReverse client) for the path \u201c/system/processes/process[pid=*]/state\u201d which will be updated every 15 seconds based on the client daemon configuration.</p>"},{"location":"telemetry/adapters/gnmireverse/#subscribing-to-eos_native-paths","title":"Subscribing to eos_native paths","text":"<p>Enable Octa</p> <pre><code>!\nmanagement api gnmi\n   transport grpc def\n      vrf management\n   provider eos-native\n!\n</code></pre> <p>Configure the daemon to subscribe to the eos_native path as in following example:</p> <p>Note: The <code>\\</code> elements have been added to aid readability, these should be removed when entering the configuration.</p> <pre><code>daemon gnmi_reverse_client_1\n   exec /mnt/flash/client -username cvpadmin -password arista \\\n     -target_addr=management/127.0.0.1:6030                   \\\n     -collector_addr=management/198.51.100.115:6000            \\\n     -collector_tls=false -target_value=gb421                 \\\n     -sample /system/processes/process[pid=*]/state@30s       \\\n     -origin eos_native                                       \\\n     -subscribe /Kernel/proc/meminfo/\n   no shutdown\n</code></pre> <p>On the server side we can see the updates from the same subscription path:</p> <pre><code>$ ./server -tls=false -addr=198.51.100.115:6000\n\n[2020-12-29T06:55:15.29120758Z] (gb421) /Kernel/proc/meminfo/memFree = 2482671616\n[2020-12-29T06:55:15.29121703Z] (gb421) /Kernel/proc/meminfo/memAvailable = 6465200128\n[2020-12-29T06:55:15.29122834Z] (gb421) /Kernel/proc/meminfo/active = 3750023168\n[2020-12-29T06:55:15.291235635Z] (gb421) /Kernel/proc/meminfo/activeAnon = 1048485888\n[2020-12-29T06:55:15.291254147Z] (gb421) /Kernel/proc/meminfo/anonPages = 991825920\n[2020-12-29T06:55:15.291261051Z] (gb421) /Kernel/proc/meminfo/slab = 398680064\n[2020-12-29T06:55:15.291265299Z] (gb421) /Kernel/proc/meminfo/sUnreclaim = 218755072\n[2020-12-29T06:55:15.291275563Z] (gb421) /Kernel/proc/meminfo/committedAS = 3991588864\n[2020-12-29T06:55:25.290455551Z] (gb421) /Kernel/proc/meminfo/memFree = 2482679808\n[2020-12-29T06:55:25.29046483Z] (gb421) /Kernel/proc/meminfo/memAvailable = 6465232896\n[2020-12-29T06:55:25.290476436Z] (gb421) /Kernel/proc/meminfo/active = 3750035456\n[2020-12-29T06:55:25.290486217Z] (gb421) /Kernel/proc/meminfo/activeAnon = 1048498176\n[2020-12-29T06:55:25.290507211Z] (gb421) /Kernel/proc/meminfo/anonPages = 991838208\n[2020-12-29T06:55:25.290517806Z] (gb421) /Kernel/proc/meminfo/sReclaimable = 179949568\n[2020-12-29T06:55:25.290523744Z] (gb421) /Kernel/proc/meminfo/sUnreclaim = 218730496\n</code></pre>"},{"location":"telemetry/adapters/gnmireverse/#subscribing-to-smash-paths","title":"Subscribing to Smash paths","text":"<p>Enable Smash paths for Octa under management api models as follows:</p> <pre><code>!\nmanagement api models\n   provider smash\n      path routing/status\n!\n</code></pre> <p>Configure the gNMIReverse client daemon:</p> <p>Note: The <code>\\</code> elements have been added to aid readability, these should be removed when entering the configuration.</p> <pre><code>daemon gnmi_reverse_client_1\n   exec /mnt/flash/client -username cvpadmin -password arista           \\\n     -target_addr=management/127.0.0.1:6030                             \\\n     -collector_addr=management/198.51.100.115:6000                      \\\n     -collector_tls=false -target_value=gb421                           \\\n     -sample /system/processes/process[pid=*]/state@30s                 \\\n     -origin eos_native                                                 \\\n     -subscribe /Kernel/proc/meminfo/                                   \\\n     -subscribe /Smash/routing/status/\n   no shutdown\n</code></pre> <p>On server side we can see updates as follows:</p> <pre><code>$ ./server -tls=false -addr=198.51.100.115:6000\n\n[2020-12-29T07:39:33.857345257Z] (gb421) /Smash/routing/status/route/1.1.1.1\\/32/storage = 4294967240\n[2020-12-29T07:39:33.857345257Z] (gb421) /Smash/routing/status/route/1.1.1.1\\/32/routeType = ebgp\n[2020-12-29T07:39:33.857345257Z] (gb421) /Smash/routing/status/route/1.1.1.1\\/32/fecId = {\"value\":12884901894}\n[2020-12-29T07:39:33.857345257Z] (gb421) /Smash/routing/status/route/1.1.1.1\\/32/key = \"1.1.1.1/32\"\n[2020-12-29T07:39:33.857345257Z] (gb421) /Smash/routing/status/route/1.1.1.1\\/32/metric = {\"value\":0}\n</code></pre>"},{"location":"telemetry/adapters/gnmireverse/#references","title":"References","text":"<p>Github</p>"},{"location":"telemetry/adapters/kafka/","title":"kafka-telegraf","text":""},{"location":"telemetry/adapters/kafka/#introduction","title":"Introduction","text":"<p>Kafka is a popular message bus system that allows applications to communicate over a pub/sub bus as either a publisher or a consumer. A popular method of distributing streaming telemetry is to take the telemetry data and output it to a Kafka topic so it can be further reacted upon.</p> <p>This lab will leverage the Telegraf container to take streaming telemetry from two cEOS lab devices from their gNMI interfaces and output the data to a Kafka topic.</p>"},{"location":"telemetry/adapters/kafka/#prerequisite","title":"Prerequisite","text":"<ul> <li>Containerlab</li> <li>Docker</li> <li>cEOS</li> </ul> <p>cEOS lab will need to be downloaded from the arista software downloads and imported via docker with a tag of 4.29.2F</p>"},{"location":"telemetry/adapters/kafka/#environment","title":"Environment","text":"<p>The Containerlab file</p> Reveal output <p> <pre><code>name: kafka\ntopology:\ndefaults:\nenv:\nETBA: 4\nnodes:\nceos1:\nkind: ceos\nimage: ceoslab:4.29.2F\nports:\n- 4001:6030\n- 4444:443\n- 888:80\n- 6040:6040\nstartup-config: configs/ceos1.conf\nmgmt_ipv4: 172.20.20.101\npublish:\n- tcp/4001\nceos2:\nkind: ceos\nimage: ceoslab:4.29.2F\nports:\n- 4002:6030\n- 4445:443\n- 889:80\n- 6041:6040\nstartup-config: configs/ceos2.conf\nmgmt_ipv4: 172.20.20.102\npublish:\n- tcp/4002\nkafka-server:\nkind: linux\nimage: bitnami/kafka:latest\nmgmt_ipv4: 172.20.20.103\nports:\n- 9092:9092\n- 9000:9000\nenv:\nKAFKA_CFG_ADVERTISED_LISTENERS: PLAINTEXT://clab-kafka-kafka-server:9092\nALLOW_PLAINTEXT_LISTENER: \"yes\"\nJMX_PORT: 9000\nKAFKA_ADVERTISED_HOST_NAME: localhost\nKAFKA_ZOOKEEPER_CONNECT: clab-kafka-zookeeper-server:2181\nzookeeper-server:\nkind: linux\nimage: wurstmeister/zookeeper\nmgmt_ipv4: 172.20.20.104\nports:\n- 2181:2181\nenv:\nKAFKA_CFG_ADVERTISED_LISTENERS: PLAINTEXT://clab-kafka-kafka-server:9092\nALLOW_PLAINTEXT_LISTENER: \"yes\"\nJMX_PORT: 9000\ntelegraf-server:\nkind: linux\nimage: telegraf:latest\nmgmt_ipv4: 172.20.20.105\nbinds:\n- telegraf.conf:/etc/telegraf/telegraf.conf\nlinks:\n- endpoints: [\"ceos1:eth1\", \"ceos2:eth1\"]\n</code></pre> </p> <p>Looking at the telegraf.conf file</p> Reveal output <p> <pre><code>[[inputs.gnmi]]\n## Address and port of the GNMI GRPC server\naddresses = [\"clab-kafka-ceos1:6030\", \"clab-kafka-ceos2:6030\"]\n## credentials\nusername = \"admin\"\npassword = \"admin\"\n## redial in case of failures after\nredial = \"10s\"\n[[inputs.gnmi.subscription]]\n## Name of the measurement\nname = \"ifcounters\"\norigin = \"openconfig\"\npath = \"/interfaces/interface/state/counters\"\nsubscription_mode = \"sample\"\nsample_interval = \"10s\"\n[[inputs.gnmi.subscription]]\n## Name of the measurement\nname = \"openconfig_bgp\"\norigin = \"openconfig\"\npath = \"/network-instances/network-instance/protocols/protocol/bgp/\"\nsubscription_mode = \"sample\"\nsample_interval = \"10s\"\n[[outputs.kafka]]\n## URLs of kafka brokers\n## The brokers listed here are used to connect to collect metadata about a\n## cluster. However, once the initial metadata collect is completed, telegraf\n## will communicate solely with the kafka leader and not all defined brokers.\nbrokers = [\"172.20.20.103:9092\"]\n## Kafka topic for producer messages\ntopic = \"telegraf\"\n</code></pre> </p> <p>We can see that we are going to have Telegraf use the gnmi input plugin which will simply connect to the two cEOS nodes and start to stream their interface counters and BGP statistics. On the outputs portion we can see that we are going to take this gNMI data and send it to the Kafka broker on the subject of Telegraf. So any application that connects to the same Kafka broker will also be able to see this data. This Containerlab file will consist of the following Docker containers</p> <ul> <li>cEOS (2) each running gNMI interface</li> <li>Kafka container</li> <li>Zookeeper</li> <li>Telegraf</li> <li>Binary for testing purposes</li> </ul>"},{"location":"telemetry/adapters/kafka/#running-the-lab","title":"Running the lab","text":"<pre><code>cd src/kafka-telegraf/\ncontainerlab -t initial.yaml deploy\n</code></pre> <p>Our environment should look as the following</p> <pre><code>+---+-----------------------------+--------------+------------------------+-------+---------+------------------+----------------------+\n| # |            Name             | Container ID |         Image          | Kind  |  State  |   IPv4 Address   |     IPv6 Address     |\n+---+-----------------------------+--------------+------------------------+-------+---------+------------------+----------------------+\n| 1 | clab-kafka-ceos1            | 81405697c609 | ceoslab:4.29.2F        | ceos  | running | 172.20.20.101/24 | 2001:172:20:20::6/64 |\n| 2 | clab-kafka-ceos2            | 3b3cb2b23537 | ceoslab:4.29.2F        | ceos  | running | 172.20.20.102/24 | 2001:172:20:20::5/64 |\n| 3 | clab-kafka-kafka-server     | 25205108237e | bitnami/kafka:latest   | linux | running | 172.20.20.103/24 | 2001:172:20:20::3/64 |\n| 4 | clab-kafka-telegraf-server  | 4c5c7e173a55 | telegraf:latest        | linux | running | 172.20.20.105/24 | 2001:172:20:20::4/64 |\n| 5 | clab-kafka-zookeeper-server | 9feea244597e | wurstmeister/zookeeper | linux | running | 172.20.20.104/24 | 2001:172:20:20::7/64 |\n+---+-----------------------------+--------------+------------------------+-------+---------+------------------+----------------------+\n</code></pre>"},{"location":"telemetry/adapters/kafka/#checking-telegraf","title":"Checking Telegraf","text":"<pre><code>docker logs clab-kafka-telegraf-server\n</code></pre> Reveal output <p> <pre><code>2023-02-01T17:16:24Z I! Using config file: /etc/telegraf/telegraf.conf\n2023-02-01T17:16:24Z I! Starting Telegraf 1.25.0\n2023-02-01T17:16:24Z I! Available plugins: 228 inputs, 9 aggregators, 26 processors, 21 parsers, 57 outputs, 2 secret-stores\n2023-02-01T17:16:24Z I! Loaded inputs: gnmi\n2023-02-01T17:16:24Z I! Loaded aggregators:\n2023-02-01T17:16:24Z I! Loaded processors:\n2023-02-01T17:16:24Z I! Loaded secretstores:\n2023-02-01T17:16:24Z I! Loaded outputs: kafka\n2023-02-01T17:16:24Z I! Tags enabled: host=telegraf-server\n2023-02-01T17:16:24Z I! [agent] Config: Interval:10s, Quiet:false, Hostname:\"telegraf-server\", Flush Interval:10s\n2023-02-01T17:16:29Z E! [inputs.gnmi] Error in plugin: failed to setup subscription: rpc error: code = Unavailable desc\n2023-02-01T17:16:29Z E! [inputs.gnmi] Error in plugin: failed to setup subscription: rpc error: code = Unavailable desc\n</code></pre> </p> <p>This is okay it reconnects but never tells you it is reconnecting.</p>"},{"location":"telemetry/adapters/kafka/#binary-for-testing","title":"Binary for testing","text":"<p>Since all of our devices are accessible within the same machine there is a small binary that can subscribe to the same Telegraf topic and display information. Within the <code>/bin</code> directory it is compiled for either darwin or linux/amd64.</p> <pre><code>cd /bin\n./kafakconsumer --kafka-brokers 172.20.20.103:9092 -kafka-topic telegraf\n</code></pre> Reveal output <p> <pre><code>ifcounters,host=telegraf-server,name=Management0,path=openconfig:/interfaces/interface/state/counters,source=clab-kafka-ceos1\nin_broadcast_pkts=0i,in_discards=0i,in_errors=0i,in_fcs_errors=0i,\nin_multicast_pkts=0i,out_broadcast_pkts=0i,out_discards=0i,out_errors=0i,out_multicast_pkts=0i 1675272643699038728\nifcounters,host=telegraf-server,name=Management0,path=openconfig:/interfaces/interface/state/counters,source=clab-kafka-ceos1\nin_octets=6886i,in_pkts=65i,in_unicast_pkts=65i,out_octets=2273i,out_pkts=25i,out_unicast_pkts=25i 1675272646690338017\nopenconfig_bgp,/network-instances/network-instance/protocols/protocol/name=BGP,host=telegraf-server,identifier=BGP,\nname=default,source=clab-kafka-ceos2 global/state/router_id=\"2.2.2.2\" 1675271796987568362\nopenconfig_bgp,/network-instances/network-instance/protocols/protocol/name=BGP,afi_safi_name=IPV4_UNICAST,host=telegraf-server,\nidentifier=BGP,name=default,neighbor_address=10.0.0.1,source=clab-kafka-ceos2\nneighbors/neighbor/afi_safis/afi_safi/afi_safi_name=\"openconfig-bgp-types:IPV4_UNICAST\" 1675271796630909428\nopenconfig_bgp,/network-instances/network-instance/protocols/protocol/name=BGP,afi_safi_name=IPV4_UNICAST,host=telegraf-server,\nidentifier=BGP,name=default,neighbor_address=10.0.0.1,source=clab-kafka-ceos2\nneighbors/neighbor/afi_safis/afi_safi/config/afi_safi_name=\"openconfig-bgp-types:IPV4_UNICAST\" 1675271796630909428\n</code></pre> </p>"},{"location":"telemetry/adapters/kafka/#lab-cleanup","title":"Lab Cleanup","text":"<pre><code>containerlab -t initial.yaml destroy\n</code></pre> Reveal output <p> <pre><code>INFO[0000] Parsing &amp; checking topology file: initial.yaml\nINFO[0000] Destroying lab: kafka\nINFO[0000] Removed container: clab-kafka-telegraf-server\nINFO[0000] Removed container: clab-kafka-zookeeper-server\nINFO[0001] Removed container: clab-kafka-kafka-server\nINFO[0001] Removed container: clab-kafka-ceos2\nINFO[0001] Removed container: clab-kafka-ceos1\nINFO[0001] Removing containerlab host entries from /etc/hosts file\n</code></pre> </p> <p>The environment should be back to the way it was previously after deletion.</p>"},{"location":"telemetry/adapters/ocprometheus/","title":"Streaming EOS telemetry states to Prometheus","text":""},{"location":"telemetry/adapters/ocprometheus/#introduction","title":"Introduction","text":"<p>Prometheus is one of the most popular open-source monitoring and alerting systems, which scrapes and stores numeric time series data over HTTP. It has a very flexible query language, can send alerts via alertmanager to various platform  and can be integrated easily with many open-source tools. For more details and use cases, please visit https://prometheus.io/docs/introduction/overview/.</p> <p>The purpose of this article is to show how easy it is to deploy and configure Prometheus and Grafana and configure Arista switches to send telemetry states to Prometheus using TerminAttr ( EOS streaming telemetry agent ) and one of the OpenConfig connectors that you can find on our official github page.</p> <p>Please note, that these apps were written as proof-of-concept and are supported on a best-effort basis. The projects can be forked and modified to suit your needs. Feedbacks are always welcomed and issues can be filed like for any other projects on github.</p>"},{"location":"telemetry/adapters/ocprometheus/#prerequisites","title":"Prerequisites","text":"<p>The following tools will be necessary to be able to install Prometheus and Grafana, clone our project from github and compile ocprometheus.</p> <ul> <li>Homebrew (for macOS users)</li> <li>Go</li> <li>Git</li> <li>docker</li> </ul>"},{"location":"telemetry/adapters/ocprometheus/#installing-prometheus-and-grafana","title":"Installing Prometheus and Grafana","text":"<p>There are several ways to install Prometheus and Grafana, the docker approach being the most popular and easiest.</p>"},{"location":"telemetry/adapters/ocprometheus/#installing-prometheus","title":"Installing Prometheus","text":"<p>First, create a minimal Prometheus configuration file on the host filesystem at <code>~/prometheus.yml</code>:</p> <p><code>vi ~/prometheus.yml</code></p> <p>Add your targets (network devices IP/hostname + port number) to the \u2018scrape configs\u2019 session</p> <p>Example<code>prometheus.yml</code></p> <pre><code># my global config\nglobal:\nscrape_interval:     15s # Set the scrape interval to every 15 seconds. Default is every 1 minute.\nevaluation_interval: 15s # Evaluate rules every 15 seconds. The default is every 1 minute.\n# scrape_timeout is set to the global default (10s).\n# Alertmanager configuration\nalerting:\nalertmanagers:\n- static_configs:\n- targets:\n# - alertmanager:9093\n# Load rules once and periodically evaluate them according to the global 'evaluation_interval'.\nrule_files:\n# - \"first_rules.yml\"\n# - \"second_rules.yml\"\n# A scrape configuration containing exactly one endpoint to scrape:\n# Here it's Prometheus itself.\nscrape_configs:\n# The job name is added as a label `job=&lt;job_name&gt;` to any timeseries scraped from this config.\n- job_name: 'prometheus'\n# metrics_path defaults to '/metrics'\n# scheme defaults to 'http'.\nstatic_configs:\n- targets: ['localhost:9090']\n- job_name: 'arista'\nstatic_configs:\n- targets: ['192.0.2.139:8080']\n</code></pre> <p>Start the Prometheus Docker container with an external configuration file:</p> <pre><code>docker run -d \\\n-p 9090:9090 -v ~/prometheus.yml:/etc/prometheus/prometheus.yml \\\nprom/prometheus \\\n-config.file=/etc/prometheus/prometheus.yml\n</code></pre> <p>If the above doesn\u2019t work, check the latest docker command on the official Prometheus website.</p> <pre><code>docker run \\\n-p 9090:9090 \\\n-v /tmp/prometheus.yml:/etc/prometheus/prometheus.yml \\\nprom/prometheus\n</code></pre>"},{"location":"telemetry/adapters/ocprometheus/#add-new-targets","title":"Add new targets","text":"<p>In our case, targets are switches, but a target can be any type of device. By default if you are adding new targets by editing the <code>prometheus.yml</code> file on the host, it won\u2019t update the config file in the Docker VM, that is because every time you insert new characters with VIM and save the file, the inode will change.</p>"},{"location":"telemetry/adapters/ocprometheus/#option-1","title":"Option 1","text":"<p>Change the file permission to <code>664</code> (<code>rw-rw-r\u2013</code>)</p> <p><code>chmod 664 prometheus.yml</code></p> <p>Check if the permissions have been changed</p> <pre><code>ls -l prometheus.yml\n\n-rw-rw-r--  1 root root 1076 May 14 12:25 prometheus.yml\n</code></pre> <p>This will modify the file in your docker VM as well, but the configuration won\u2019t be updated until you restart the service, which you can do with a one-liner:</p> <pre><code>sudo docker exec -i -t eager_kapitsa kill -HUP 1\n</code></pre> <p>Where eager_kapitsa is the name of the container, which you can find out with the docker ps command:</p> <pre><code>root@tac-prometheus-ire:~# docker ps\n\nCONTAINER ID        IMAGE COMMAND                  CREATED STATUS PORTS                    NAMES\n\n47f52778b492        prom/prometheus \"/bin/prometheus --c\u2026\"   13 days ago Up 6 minutes 0.0.0.0:9090-&gt;9090/tcp   eager_kapitsa\n3e880f9a951e        grafana/grafana \"/run.sh\"                3 weeks ago Up 3 weeks 0.0.0.0:3000-&gt;3000/tcp   grafana\n</code></pre> <p>You can always check if the configuration has been updated with the following curl command:</p> <pre><code>root@tac-prometheus-ire:~# curl localhost:9090/config\n\n&lt;ommited&gt;\n  static_configs:\n  - targets:\n    - 192.0.2.132:8080\n    - 192.0.2.139:8080\n    - 10.83.12.109:8080\n    - 192.0.2.138:8080\n&lt;ommited&gt;\n</code></pre> <p>Forum that explains this behavior.</p>"},{"location":"telemetry/adapters/ocprometheus/#option-2","title":"Option 2","text":"<p>NOTE If you don\u2019t want to change the file permission, you can use the <code>:set backupcopy=yes</code> option in VIM, which will make sure to not change the inode of the file when saving it.</p> <p>And restart the service again:</p> <pre><code>sudo docker exec -i -t eager_kapitsa kill -HUP 1\n</code></pre>"},{"location":"telemetry/adapters/ocprometheus/#option-3","title":"Option 3","text":"<p>Use the <code>\u2013web.enable-lifecycle</code> flag when running the container.</p>"},{"location":"telemetry/adapters/ocprometheus/#installing-grafana","title":"Installing Grafana","text":"<p>You can use the following docker command to deploy Grafana in couple of seconds:</p> <pre><code>$ docker run \\\n-d \\\n-p 3000:3000 \\\n--name=grafana \\\n-e \"GF_SERVER_ROOT_URL=http://grafana.server.name\" \\\n-e \"GF_SECURITY_ADMIN_PASSWORD=secret\" \\\ngrafana/grafana\n</code></pre> <p>Note: In newer versions of Grafana there are no more implicit volumes for</p> <ul> <li>/var/lib/grafana</li> <li>/var/log/grafana</li> <li>/etc/grafana</li> </ul> <p>For more details see what\u2019s new in Grafana 5.1 and later  and recommended steps to migrate from older releases.</p> <p>There\u2019s also a ready-to-go combo of Prometheus/Grafana/docker-stack which you can find at https://github.com/vegasbrianc/prometheus (credit to Brian Christner)</p> <p>Now that we have Prometheus and Grafana running, we\u2019re ready to configure our switches and start drawing nice graphs from  the queried data.</p>"},{"location":"telemetry/adapters/ocprometheus/#installing-and-configuring-ocprometheus","title":"Installing and configuring ocprometheus","text":"<p>There are a couple of ways to install ocprometheus, and all require for you to compile it with GO.</p>"},{"location":"telemetry/adapters/ocprometheus/#git-clone-the-arista-go-library","title":"Git Clone the Arista GO library","text":"<p>First you\u2019ll need to git clone the goarista repository.</p> <pre><code>tamas:~ tamas$ git clone https://github.com/aristanetworks/goarista.git\n\nCloning into 'goarista'...\nremote: Counting objects: 2584, done.\nremote: Compressing objects: 100% (10/10), done.\nremote: Total 2584 (delta 1), reused 2 (delta 0), pack-reused 2574\nReceiving objects: 100% (2584/2584), 945.38 KiB | 767.00 KiB/s, done.\nResolving deltas: 100% (1529/1529), done.\nChecking connectivity... done.\n</code></pre> <p>This will download all the files from that github page and we can then go ahead and compile ocprometheus.</p> <p>LPT In case the project you\u2019ve cloned has dependencies on other git project you can use the <code>\u2013recurse-submodules</code> flag while cloning which will also clone the submodules.</p> <p>E.g.:</p> <pre><code>git clone --recurse-submodules -j8 git://github.com/foo/bar.git\n</code></pre>"},{"location":"telemetry/adapters/ocprometheus/#compile-ocprometheus-in-go","title":"Compile ocprometheus in GO","text":"<p>1. Go to your ocprometheus folder on your PC/laptop/server</p> <pre><code>cd git/goarista/cmd/ocprometheus\n</code></pre> <p>2. Compile ocprometheus with the following paramethers:</p> <pre><code>GOOS=linux GOARCH=386 go build\n</code></pre> <p>3. Copy the binary with SCP to the switch</p> <pre><code>scp ocprometheus admin@192.0.2.139://mnt/flash\n</code></pre> <p>Since EOS has a linux kernel, the OS has to be set to linux and the architecture to 32 bit (386) with GOOS and GOARCH variables respectively. Starting 4.22.0 we\u2019ve introduced a 64-bit EOS () and you can also compile ocprometheus for 64-bit architecture with the following command:</p> <pre><code>GOOS=linux GOARCH=amd64 go build\n</code></pre>"},{"location":"telemetry/adapters/ocprometheus/#option-1-using-the-binary","title":"Option 1) Using the binary","text":"<p>From this point you can just SCP the binary to a persistent storage on the switch (for example, <code>/mnt/flash/</code>) and just configure the daemon and point it to <code>/mnt/flash/ocprometheus</code></p>"},{"location":"telemetry/adapters/ocprometheus/#option-2-install-it-as-a-swix","title":"Option 2) Install it as a swix","text":"<p>You can also install it as a swix, which requires a bit more effort, however it\u2019s easier to manage swix packages, and you\u2019ll be able to see the ocprometheus extension in the <code>show extensions</code> output.</p> <p>In order to create a swix file, we first have to compile this binary as an RPM. Building RPMs can be tedious, especially for networking guys, who are not used to doing things like this. There are various tutorials online on how to use rpmbuild, but instead of wasting half an hour to create all the necessary folders and your spec file, etc we can create RPMs with just one line, using FPM (Effing Package Management).</p> <p>You can download FPM from the following github page:</p> <p>https://github.com/jordansissel/fpm (credit to Jordan and all who contributed to this project\u2014you\u2019ve made  our lives easier, Thank you)</p> <p>The following was done on a Devuan VM (which is basically a lightweight Debian without systemd) using the following steps:</p> <p>1. Create a new folder:</p> <pre><code>mkdir fpmbuild\n</code></pre> <p>2. Copy the compiled <code>ocprometheus</code> and the <code>sampleconfig.yml</code> (in this example it was renamed to <code>ocprometheus.yml</code>) downloaded from github:</p> <pre><code>cp ~/git/goarista/cmd/ocprometheus/ocprometheus /backup/fpmbuild/\ncp ~/git/goarista/cmd/ocprometheus/sampleconfig_above_4.20.yml /backup/fpmbuild/ocprometheus.yml\n</code></pre> <p>3. Compile it with fpm:</p> <p>This one liner will create the RPM package without the need to create all the folders and specs that you\u2019d need to do with the usual rpmbuild:</p> <pre><code>sudo fpm -s dir -t rpm -a all -n \"ocprometheus-$(date +%m_%d.%H%M)\" \\\n-v1.5.6 --prefix /usr/bin/ \\\n-C /backup/fpmbuild/ ocprometheus ocprometheus.yml\n</code></pre>"},{"location":"telemetry/adapters/ocprometheus/#flags-cheat-sheet","title":"Flags cheat sheet","text":"Flag Description -s dir Source is a directory -t rpm Target is an RPM file -a all User noarch instead of x86_64 -n \u201cocprometheus-$(date +%m_%d.%H%M)\u201c the name of the RPM -v 1.5.5 the version of the RPM will be 1.0 --prefix /usr/bin/ The files will be installed in this directory -C /backup/fpmbuild/ ocprometheus ocprometheus.yml Change directory to here before searching for files <p>4. Copy the generated file to the switch and install it as a swix:</p> <pre><code>root@devuan:/backup# ls -al ocpr*\n\n-rw-r--r--  1 root root 6462872 Jun 17 22:55 oocprometheus-06_17.2255-1.5.6-1.noarch.rpm\n\nroot@devuan:/backup# scp ocprom* admin@ats323://mnt/flash/\n</code></pre> <p>4.1. SSH to the switch and create the swix, e.g.:</p> <pre><code>ssh admin@ats323\n\nats323...16:13:36# bash\n\nArista Networks EOS shell\n\n[admin@ats323 ~]$ cd /mnt/flash\n\n[admin@ats323 flash]$ swix create ocprometheus-1.5.6.swix ocprometheus-06_17.2255-1.5.6-1.noarch.rpm\n\nadding: manifest.txt (stored 0%)\nadding: ocprometheus-06_17.2255-1.5.6-1.noarch.rpm (stored 0%)\n</code></pre> <p>4.2. Install it as a swix extension</p> <pre><code>copy flash:ocprometheus-1.5.6.swix extension:\n\nextension ocprometheus-1.5.6.swix\n</code></pre> <p>4.3. Make it persistent across reloads</p> <pre><code>copy installed-extensions boot-extensions\n</code></pre> <p>4.4. Check your extensions</p> <pre><code>show extensions\n\nName                            Version/Release Status Extension\n------------------------------- -------------------- ----------- ---------\n\nTerminAttr-1.5.5-1.swix         v1.5.5/1 A, I 25\nocprometheus-1.5.6.swix         1.5.6/1 A, I 1\nA: available | NA: not available | I: installed | NI: not installed | F: forced\n</code></pre> <p>Finally you\u2019ll need to copy the configuration file, which contains the subscription paths. You\u2019ll find the yaml file on our github page. You can find more details about subscriptions/metrics and how they are constructed in https://eos.arista.com/understanding-subscription-paths-for-open-source-telemetry-streaming</p> <p>For macOS it\u2019ll be similar with few modifications (tested on macOS Mojave and newer):</p> <p>1. Install FPM and RPM</p> <pre><code>brew install gnu-tar\ngem install --no-ri --no-rdoc fpm\nbrew install rpm\n</code></pre> <p>Note: on macOS Catalina you might need to use <code>\u2013user-install</code> when installing gem packages, and instead of <code>\u2013no-rdoc</code> use <code>\u2013no-document</code> .</p> <p>Xcode might need to be reinstalled if you\u2019ve upgraded from Mojave.</p> <p>e.g.</p> <pre><code>gem install --no-document fpm --user-install\n</code></pre> <p>2. Similarly as before, create a folder from where you\u2019ll build your package and copy the compiled binary there</p> <pre><code>mkdir fpmbuild\n\ncp ~/git/goarista/cmd/ocprometheus/ocprometheus ~/backup/fpmbuild/\n\ncp ~/git/goarista/cmd/ocprometheus/sampleconfig_above_4.20.yml ~/backup/fpmbuild/ocprometheus.yml\n</code></pre> <p>3. Build the rpm with fpm using the following command</p> <pre><code>sudo fpm -s dir -t rpm -a noarch --rpm-os linux \\\n-n \"ocprometheus-$(date +%m_%d.%H%M)\" -v1.5.6 \\\n--prefix /usr/bin/ -C ~/backup/fpmbuild/ ocprometheus ocprometheus.yml\n</code></pre> <p>The only difference when using macOS to build your rpm using fpm is that you\u2019ll need to add the <code>\u2013rpm-os</code> linux flag, otherwise it\u2019ll build the rpm for OSX.</p> <p>Note: If you are using CVP and maintain your images and extensions with Image bundles, you\u2019ll have to add your ocprometheus.swix to Image bundles, otherwise they\u2019ll get removed during an image push operation.</p> <p>Now it\u2019s time to configure TerminAttr and ocprometheus.</p>"},{"location":"telemetry/adapters/ocprometheus/#sample-eos-configuration","title":"Sample EOS Configuration","text":"<p>Here\u2019s a sample config for pre EOS-4.19 and post EOS-4.20.7M (CP-ACL) when using VRF MGMT</p> <pre><code>!\n\nvrf instance MGMT\n!\ninterface Management1\n   vrf forwarding MGMT\n   ip address 192.168.58.16/24\n!\nsystem control-plane\n   ip access-group def2 in\nip access-group def2 vrf MGMT in\n!\ndaemon TerminAttr\n   exec /usr/bin/TerminAttr -disableaaa -grpcaddr MGMT/0.0.0.0:6042\n   no shutdown\n!\ndaemon ocprometheus\n   exec /sbin/ip netns exec ns-MGMT /usr/bin/ocprometheus -config /usr/bin/ocprometheus.yml -addr localhost:6042\n   no shutdown\n!\n</code></pre> <p>You\u2019ll need at least 3 things to configure ocprometheus:</p> <ul> <li>Location of the binary</li> <li>Location of the config file, configured by the -config flag</li> <li>gNMI socket of TerminAttr, which can be specified by the <code>-addr</code> flag</li> </ul> <p>TerminAttr is running a gRPC server locally on TCP <code>6042</code>, which you can check by looking at the logs:</p> <pre><code>bash cat /var/log/agents/TerminAttr-`pidof TerminAttr`\n</code></pre> <p>NOTE: when installing ocprometheus as a swix file, the binary will be put in <code>/usr/bin</code> directory by default (you can change that in the RPM making process).</p> <p>If you compile it in go and copy it to flash you can just change that daemon config to refer to that path (this way it won\u2019t be installed as a swix).</p> <p>e.g.</p> <pre><code>daemon ocprometheus\n   exec /sbin/ip netns exec ns-MGMT /usr/bin/ocprometheus -config /usr/bin/ocprometheus.yml -addr localhost:6042\n   no shutdown\n</code></pre> <p>By default in EOS versions that have control-plane ACL we need to permit TCP port 8080 (default), or whichever port you decide to use to send data to the Prometheus server (defined in the targets list in <code>prometheus.yml</code>)</p> <pre><code> ip access-list def2\n\n9 permit tcp any any eq 8080\n10 permit icmp any any\n  20 permit ip any any tracked\n  30 permit udp any any eq bfd ttl eq 255\n40 permit udp any any eq bfd-echo ttl eq 254\n50 permit udp any any eq multihop-bfd\n  60 permit udp any any eq micro-bfd\n  70 permit ospf any any\n  80 permit tcp any any eq ssh telnet www snmp bgp https msdp ldp netconf-ssh gnmi\n  90 permit udp any any eq bootps bootpc snmp rip ntp ldp\n  100 permit tcp any any eq mlag ttl eq 255\n110 permit udp any any eq mlag ttl eq 255\n120 permit vrrp any any\n  130 permit ahp any any\n  140 permit pim any any\n  150 permit igmp any any\n  160 permit tcp any any range 5900 5910\n170 permit tcp any any range 50000 50100\n180 permit udp any any range 51000 51100\n190 permit tcp any any eq 3333\n200 permit tcp any any eq nat ttl eq 255\n210 permit tcp any eq bgp any\n  220 permit rsvp any any\n</code></pre> <p>To check if the port is open you can use <code>netstat</code>, e.g.:</p> <pre><code>netstat -an | grep :8080\n</code></pre> <p>Or the network namespace command if VRF is used</p> <pre><code>sudo ip netns exec ns-MGMT netstat -an | grep :8080\n</code></pre> <p>You should see a similar output as below:</p> <pre><code>$ sudo netstat -tulnap | grep :8080\n\ntcp6       0 0 :::8080                 :::* LISTEN   17200/ocprometheus\ntcp6       0 0 172.28.160.232:8080     192.0.2.78:48956 ESTABLISHED 17200/ocprometheus\n</code></pre> <p>Or in case of using a VRF:</p> <pre><code>$ sudo ip netns exec ns-management netstat -tulnap | grep :8080\n\ntcp6       0 0 :::8080                 :::* LISTEN   12344/ocprometheus\ntcp6       0 0 192.0.2.139:8080       192.0.2.78:40820 ESTABLISHED 12344/ocprometheus\n</code></pre> <p>Don\u2019t be confused if you see tcp6 in the output, that\u2019s expected, as AF_INET6 works for both IPv4 and IPv6 as per RFC 3493.</p> <p>Note: The same configuration is used but no control-plane ACL for 4.20.7M &gt; EOS &gt;4.19 or in newer releases where EOS-PDP.swi is used, and you\u2019ll need to allow the Prometheus server IP using <code>-allowed_ips=&lt;IP/subnet&gt;</code></p> <p>Here are some of the configuration combinations that you might have:</p>"},{"location":"telemetry/adapters/ocprometheus/#no-vrf-and-streaming-to-both-cvp-and-prometheus","title":"No VRF and streaming to both CVP and Prometheus","text":"<pre><code>!\ndaemon TerminAttr\n  exec /usr/bin/TerminAttr -ingestgrpcurl=192.0.2.33:9910 -cvcompression=gzip -taillogs -ingestauth=key,mysecretkey -smashexcludes=ale,flexCounter,hardware,kni,pulse,strata -ingestexclude=/Sysdb/cell/1/agent,/Sysdb/cell/2/agent -disableaaa\n  no shutdown\n!\ndaemon ocprometheus\n  exec /usr/bin/ocprometheus -config /usr/bin/ocprometheus.yml -addr localhost:6042\n  no shutdown\n!\n</code></pre>"},{"location":"telemetry/adapters/ocprometheus/#no-vrf-and-only-prometheus","title":"No VRF and only Prometheus","text":"<pre><code>!\ndaemon TerminAttr\n  exec /usr/bin/TerminAttr -disableaaa\n  no shutdown\n!\ndaemon ocprometheus\n  exec /usr/bin/ocprometheus -config /usr/bin/ocprometheus.yml -addr localhost:6042\n  no shutdown\n!\n</code></pre>"},{"location":"telemetry/adapters/ocprometheus/#vrf-management-and-streaming-to-both-cvp-and-prometheus","title":"VRF management and streaming to both CVP and Prometheus","text":"<pre><code>!\ndaemon TerminAttr\n  exec /usr/bin/TerminAttr -ingestgrpcurl=192.0.2.79:9910 -cvcompression=gzip -taillogs -ingestvrf=management -ingestauth=key,mysecretkey -smashexcludes=ale,flexCounter,hardware,kni,pulse,strata -ingestexclude=/Sysdb/cell/1/agent,/Sysdb/cell/2/agent -disableaaa -grpcaddr management/0.0.0.0:6042\n  no shutdown\n!\ndaemon ocprometheus\n  exec /sbin/ip netns exec ns-management /usr/bin/ocprometheus -config /usr/bin/ocprometheus.yml -addr localhost:6042\n  no shutdown\n!\n</code></pre>"},{"location":"telemetry/adapters/ocprometheus/#vrf-and-only-prometheus","title":"VRF and only Prometheus","text":"<pre><code>!\ndaemon TerminAttr\n  exec /usr/bin/TerminAttr -disableaaa -grpcaddr management/0.0.0.0:6042\n  no shutdown\n!\ndaemon ocprometheus\n  exec /sbin/ip netns exec ns-management /usr/bin/ocprometheus -config /usr/bin/ocprometheus.yml -addr localhost:6042\n  no shutdown\n!\n</code></pre>"},{"location":"telemetry/adapters/ocprometheus/#vrf-and-only-prometheus-using-authentication","title":"VRF and only Prometheus using authentication","text":"<pre><code>!\ndaemon TerminAttr\n  exec /usr/bin/TerminAttr -grpcaddr management/0.0.0.0:6042\n  no shutdown\n!\ndaemon ocprometheus\n  exec /sbin/ip netns exec ns-management /usr/bin/ocprometheus -config /usr/bin/ocprometheus.yml -addr localhost:6042 -username=cvpadmin -password=arista\n  no shutdown\n!\n</code></pre>"},{"location":"telemetry/adapters/ocprometheus/#pdp-vrf-and-only-prometheus","title":"PDP: VRF and only Prometheus","text":"<pre><code>!\ndaemon TerminAttr\n  exec /usr/bin/TerminAttr -disableaaa -grpcaddr management/0.0.0.0:6042 -allowed_ips=192.0.2.78/32\n  no shutdown\n!\ndaemon ocprometheus\n  exec /sbin/ip netns exec ns-management /usr/bin/ocprometheus -config /usr/bin/ocprometheus.yml -addr localhost:6042\n  no shutdown\n!\n</code></pre> <p>The minimum required flags for TerminAttr are:</p> <ul> <li><code>disableaaa</code>: Disable AAA checking\u2014all AAA requests pass (in case username/password is not used in ocprometheus)</li> <li>grpcaddr string      VRF and address to listen on to serve data using the gNMI interface.      The expected form is <code>[&lt;vrf-name&gt;/]address:port</code> (default <code>127.0.0.1:6042</code>)</li> </ul> <p>After configuring our switches we can head over to Grafana and start drawing our graphs.</p>"},{"location":"telemetry/adapters/ocprometheus/#fix-for-multilane-interfaces-eos-native-paths","title":"Fix for multilane interfaces (EOS-native paths)","text":"<p>If interface statistics streamed using eos-native paths, then backslash would be part of the interface names: </p> <p>Use the following metric_relabel_configs configuration to remove the backslash in interface names:</p> <pre><code>scrape_configs:\n  # The job name is added as a label `job=&lt;job_name&gt;` to any timeseries scraped from this config.\n- job_name: 'prometheus'\n# metrics_path defaults to '/metrics'\n# scheme defaults to 'http'.\nstatic_configs:\n      - targets: ['localhost:9090']\n- job_name: 'arista'\nstatic_configs:\n    - targets: ['172.28.161.187:8080']\nmetric_relabel_configs:\n    - action: replace\n      source_labels: [intf]\ntarget_label: intf\n      regex: '(.*)\\\\(.*)'\nreplacement: '${1}${2}'\n- action: replace\n      source_labels: [intf]\ntarget_label: intf\n      regex: '(.*)\\\\(.*)\\\\(.*)'\nreplacement: '${1}${2}${3}'\n</code></pre> <p>Applying this configuration will result in:</p> <p></p>"},{"location":"telemetry/adapters/ocprometheus/#creating-dashboards-in-grafana","title":"Creating dashboards in Grafana","text":"<p>First you\u2019ll need to add Prometheus as a data source, to be able to graph streamed data to Prometheus. You can do this by using the following steps:</p> <p>1. Go to Configuration (gear icon) / Data Sources</p> <p></p> <p>2. Add data source and select Prometheus</p> <p></p> <p></p> <p>3. Fill out the form (add the URL for the Prometheus server e.g.: <code>http://myprometheus.com:9090/</code></p> <p>It should look like this:</p> <p></p> <p>4. Save &amp; Test</p> <p>5. Now we can create our dashboard ( + button on the left)</p> <p></p> <p>6. Add query</p> <p></p> <p>7. Make sure you have \u2018Prometheus\u2019 selected as Data Source</p> <p></p> <p>After selecting \u2018prometheus\u2019 you will be able to add expressions like \u2018intfCounter\u2019 , \u2018tempSensor\u2019, etc. defined in the ocprometheus config yaml file.</p> <p></p> <p>8. After adding \u2018intfCounter\u2019 to the query, it\u2019ll start plotting the counters for all the interfaces and all the devices  that Prometheus is polling</p> <p></p> <p>9. Save the dashboard</p> <p></p> <p>Finally:</p> <ul> <li>you can add as many dashboards you want</li> <li>you can add more expression on a single graph</li> <li>you can choose one line on the graph and it will show the graph for only that line (for example, in interface counters, you can choose a specific interface to look at the counters for)</li> </ul>"},{"location":"telemetry/adapters/ocprometheus/#how-to-graph-data-only-for-specific-interface","title":"How to graph data only for specific interface?","text":"<p>We can add filters to the queries in both Prometheus console or in grafana, for example, if I want to see data for interface Ethernet24 I\u2019d use the following filter:</p> <p><code>intfCounter{intf=\u201dEthernet24\u2033}</code></p> <p></p> <p></p> <p>You can filter based on any of the labels defined in the config file (some of them are unnamed, but you can add a name to those capturing/non-capturing groups inside the config file on EOS).</p> <p>Some of the paths contains capturing groups that are not named, and Prometheus will give them a name in the following format: <code>unnamedLabelX</code></p> <p>For example, for interface counters on a 7160 device I have the following path:</p> <p><code>/Smash/counters/ethIntf/XpCounters/current/(counter)/(?P&lt;intf&gt;.+)/statistics/(?P&lt;direction&gt;(?:in|out))(Octets|Errors|Discards)</code></p> <p>From the above path you can see for example that the direction of the packets is captured in a named capturing group that also contains a non-capturing group: <code>(?P&lt;direction&gt;(?:in|out))</code></p> <p>Named capturing groups can be created with <code>?P&lt;name&gt;</code>.</p> <p>We don\u2019t need to capture a separate group for in|out as we already do it with the named capturing group of direction, so we can use a non-capturing group with ?:</p> <p>Explanation:</p> <ul> <li>Named Capture Group: direction <code>(?P&lt;direction&gt;(?:in|out))</code></li> <li>Non-capturing group <code>(?:in|out)</code><ul> <li>first Alternative in</li> <li>in matches the characters in literally (case sensitive)</li> <li>second Alternative out</li> <li>out matches the characters out literally (case sensitive)</li> </ul> </li> </ul> <p>Match for inOctets will be divided like this:</p> <pre><code>Match 1\nFull match            0-8 inOctets\nGroup `direction`     0-2   in\nGroup 2.              2-8 Octets\n</code></pre> <p>If we wouldn\u2019t use non-capturing group for in|out the result will be the following</p> <pre><code>Match 1\nFull match         0-8 inOctets\nGroup `direction`  0-2 in\nGroup 2.           0-2 in\nGroup 3.           2-8 Octets\n</code></pre> <p>Notice the extra group for matching <code>in</code>.</p> <p>Now for <code>(Octets|Errors|Discards)</code> there is no name defined, so the result will be</p> <pre><code>Match 1\nFull match   2-8 Octets\nGroup 1.     2-8 Octets\n</code></pre> <p>In this case since we used a capturing group by putting our strings/expression in a parenthesis, Prometheus will know that it needs to treat it as a separate label, so it gives it a name.</p> <p>If you don\u2019t want to see unnamedLabels you can add a group name similarly to the direction group.</p> <p>For example, you can use the following expression: <code>(?P&lt;packetType&gt;(?:Octets|Errors|Discards))</code></p> <p>Result:</p> <pre><code>Match 1\nFull match          2-8 Octets\nGroup `packetType`  2-8 Octets\n</code></pre>"},{"location":"telemetry/adapters/ocprometheus/#pre-defined-dashboard","title":"Pre-defined dashboard","text":"<p>The open-source community is really helpful and thanks to Be Smart Be Open and Vista Technology we have a pre-defined grafana dashboard for Arista devices which you can find here:</p> <p>https://grafana.com/dashboards/10222</p> <p>You can download the dashboard as a JSON file and then import it in Grafana.</p> <p>Some of the graphs that you\u2019ll find in this dashboard:</p> <ul> <li>Aggregated traffic</li> <li>Traffic by interface</li> <li>CPU &amp; Temperature</li> <li>Power levels</li> <li>Voltage levels</li> <li>Interface counters for individual interfaces</li> </ul> <p></p> <p>Beware of https://github.com/grafana/grafana/issues/6888</p> <p>In case you have modular devices or multilane interfaces, you cannot use a variable to match those interfaces for example with <code>intf=\"$interface\"</code> because Grafana will escape special characters, even if they were already escaped by Prometheus (it\u2019ll escape it again). So instead of <code>Ethernet3\\\\/2</code> you\u2019ll have <code>Ethernet3\\\\\\\\/2</code> and no data will be plotted.</p> <p>The workaround is to use regex matching by putting the tilda (<code>~</code>) character after the equal sign.</p> <p><code>rate(intfCounter{job=\"$deviceType\",instance=\"$device\",intf=~\"$interface\",type=\"Octets\"}[1m])*8</code></p> <p>You can also use regex matching like below</p> <p><code>rate(intfCounter{job=\"$deviceType\",instance=\"$device\",intf=~\"Ethernet(.*\\\\/.*)?(.*)?\",type=\"Octets\"}[1m])*8</code></p>"},{"location":"telemetry/adapters/ocprometheus/#using-rule-records-in-prometheus-for-eos-paths","title":"Using rule records in Prometheus for EOS paths","text":"<p>Rule records allow you to precompute frequently needed expressions and save the result as a new set of time series. Querying this result will be much faster then executing the original expression and very useful for dashboards, which need to query the same expression repeatedly. One example would be to use the <code>/Kernel/proc/stat/&lt;pid&gt;/comm</code> as a value label and store the metrics in a new time series for the other items under that path.</p> <p>For more details on rule records, please visit the best practices and the configuration section on the official Prometheus website.</p> <p>In my example I\u2019ve recorded a rule for the <code>rss</code> key under <code>/Kernel/proc/stat/&lt;pid&gt;/</code></p> <p>Here\u2019s what TerminAttr is streaming under <code>/Kernel/proc/stat</code></p> <p><code>curl localhost:6060/rest/Kernel/proc/stat/1</code></p> <p>Output:</p> <pre><code>{\n\"cguestTime\": 0,\n    \"cmajflt\": 4399,\n    \"cmdline\": \"/sbin/init\",\n    \"cminflt\": 511393,\n    \"comm\": \"systemd\",\n    \"cstime\": 3802,\n    \"cutime\": 10380,\n    \"delayacctBlkioTicks\": 0,\n    \"endcode\": 135520894,\n    \"exitSignal\": 17,\n    \"flags\": 4219136,\n    \"guestTime\": 0,\n    \"kstkeip\": 4151638626,\n    \"kstkesp\": 4292454672,\n    \"majflt\": 31,\n    \"minflt\": 10592,\n    \"name\": \"1\",\n    \"nice\": 0,\n    \"numThreads\": 1,\n    \"pgrp\": 1,\n    \"policy\": 0,\n    \"ppid\": 0,\n    \"priority\": 20,\n    \"processor\": 3,\n    \"rlim\": 18446744073709551615,\n    \"rss\": 1553,\n    \"rtPriority\": 0,\n    \"session\": 1,\n    \"startcode\": 134512640,\n    \"startstack\": 4292456144,\n    \"starttime\": 2,\n    \"state\": 83,\n    \"stime\": 374,\n    \"tpgid\": -1,\n    \"ttyNr\": 0,\n    \"utime\": 601,\n    \"vsize\": 8925184,\n    \"wchan\": 18446744071580351996\n}\n</code></pre> <p>In my example I\u2019ve used the \u2018rss\u2019 key and similarly you can create a record for each key.</p> <p>Here\u2019s how the sample config looks like:</p>"},{"location":"telemetry/adapters/ocprometheus/#ocprometheusyml-on-eos","title":"Ocprometheus.yml on EOS","text":"<p>On the switch, the yml file should look like this (note that I\u2019ve deleted the other paths just for testing purposes).</p> <pre><code># Subscriptions to OpenConfig paths.\nsubscriptions:\n        - /Kernel/proc\n# Prometheus metrics configuration.\n# If you use named capture groups in the path, they will be extracted into labels with the same name.\n# All fields are mandatory.\nmetrics:\n        - name: kernelprocrss\n          path: /Kernel/proc/stat/(?P&lt;pid&gt;.+)/rss\n          help: KernelProcRSS\n        - name: kernelproc\n          path: /Kernel/proc/stat/(?P&lt;pid&gt;.+)/comm\n          help: KernelProcStat\n          valuelabel: command\ndefaultvalue: 1\n</code></pre> <p>On the Prometheus server, you\u2019ll need to add a rules file and edit your prometheus.yml to specify the path to that file.</p>"},{"location":"telemetry/adapters/ocprometheus/#prometheusyml-on-the-server","title":"Prometheus.yml on the server","text":"<p>You\u2019ll need to create another yml file for the rules and mention it in the prometheus.yml file under the rule_files key.</p> <p><code>cat prometheus.yml</code></p> <p>Output:</p> <pre><code># my global config\nglobal:\n  scrape_interval:     15s # Set the scrape interval to every 15 seconds. Default is every 1 minute.\nevaluation_interval: 15s # Evaluate rules every 15 seconds. The default is every 1 minute.\n# scrape_timeout is set to the global default (10s).\n# Alertmanager configuration\nalerting:\n  alertmanagers:\n  - static_configs:\n    - targets:\n      # - alertmanager:9093\n# Load rules once and periodically evaluate them according to the\n# global 'evaluation_interval'.\nrule_files:\n  # - \"first_rules.yml\"\n# - \"second_rules.yml\"\n- \"kernel_rules.yml\"\n# A scrape configuration containing exactly one endpoint to scrape:\n# Here it's Prometheus itself.\nscrape_configs:\n  # The job name is added as a label `job=&lt;job_name&gt;` to any\n# timeseries scraped from this config.\n- job_name: 'prometheus'\n# metrics_path defaults to '/metrics'\n# scheme defaults to 'http'.\nstatic_configs:\n      - targets: ['localhost:9090']\n- job_name: 'arista'\nstatic_configs:\n      - targets: ['192.0.2.140:8080','198.51.100.21:8080','192.0.2.132:8080','192.0.2.139:8080','192.0.2.138:8080']\n</code></pre>"},{"location":"telemetry/adapters/ocprometheus/#kernel_rulesyml-on-the-server","title":"Kernel_rules.yml on the server","text":"<pre><code>groups:\n - name: test\nrules:\n    - record: kernelprocrsswithcommand\n      expr: kernelprocrss * on(pid) group_right kernelproc\n</code></pre> <p>Note, if you did not mount the kernel_rules.yml file when creating your docker container (as I did) you\u2019ll need to copy the file over to your container with the following command</p> <pre><code>docker cp kernel_rules.yml eager_kapitsa:/etc/prometheus/\n</code></pre> <p>Checking on the GUI, it will give you the following results</p> <p></p> <p>You can also use the expression from the <code>kernel_rules.yml</code> directly on the GUI</p> <p></p> <p>After you create the records and update the yml files on the server, make sure you can see the rule created in the Status\u2014Rules submenu</p> <p></p>"},{"location":"telemetry/adapters/ocprometheus/#using-ocprometheus-with-the-openconfigocta-agent-management-api-gnmi","title":"Using ocprometheus with the OpenConfig/OCTA agent (management api gnmi)","text":"<p>While ocprometheus can subscribe to EOS native paths provided by TerminAttr\u2019s gNMI server on TCP <code>6042</code> (default, can be changed), it can also subscribe to OpenConfig paths provided by the OpenConfig/OCTA agent\u2019s gnmi server on TCP <code>6030</code> (default, can be changed). For example to subscribe to interface counters the subscription and the metric path would look like below:</p> <pre><code>subscriptions:\n- /interfaces/interface\nmetrics:\n- name: intfCounter\npath: /interfaces/interface\\[name=(?P&lt;intf&gt;[^\\]]+)\\]/state/counters/(?P&lt;countertype&gt;.+)\n</code></pre> <p>OpenConfig and EOS native paths can be mixed when using OCTA and in that case the origin must be specified. Since the default origin is openconfig, the origin has to be only specified for EOS native paths under the subscriptions key, e.g.:</p> <pre><code>subscriptions:\n- /interfaces/interface\n- eos_native:/Kernel/proc\n</code></pre> <p>Note On EOS 4.23+ it's highly recommended to use OCTA with ocprometheus and only use <code>eos-native</code> paths where an openconfig model does not exist.</p>"},{"location":"telemetry/adapters/ocprometheus/#example-configurations","title":"Example configurations","text":""},{"location":"telemetry/adapters/ocprometheus/#no-vrf-gnmiocta-ocprometheus","title":"No VRF - gnmi/OCTA + ocprometheus","text":"<pre><code>   management api gnmi\n      transport grpc def\n      provider eos-native\n   !\n   daemon ocprometheus\n      exec /mnt/flash/ocprometheus -config /mnt/flash/ocprometheus.yml -addr localhost:6030 -username arista -password arista\n       no shutdown\n</code></pre>"},{"location":"telemetry/adapters/ocprometheus/#vrf-gnmiocta-ocprometheus","title":"VRF - gnmi/OCTA + ocprometheus","text":"<pre><code>   management api gnmi\n      transport grpc def\n         vrf management\n      provider eos-native\n      !\n   daemon ocprometheus\n      exec /sbin/ip netns exec ns-management /mnt/flash/ocprometheus -config /mnt/flash/ocprometheus.yml -addr localhost:6030 -username arista -password arista\n      no shutdown\n</code></pre> <p>Note it's recommended to use certificate based authentication in production.</p>"},{"location":"telemetry/adapters/ocprometheus/#cert-based-authentification-with-ocprometheus","title":"Cert-based authentification with ocprometheus","text":"<ol> <li>Follow the steps mentioned in Certificate Authentification Configuration    page.</li> <li>Copy the client certificate and client key to the <code>/persist/secure/ssl</code> and <code>/persist/secure/keys</code> directory    respectively.</li> <li>The EOS configuration should look like the following:</li> </ol> <pre><code>management api gnmi\n   transport grpc def\n      ssl profile test-arista\n      vrf MGMT\n   provider eos-native\n!\nmanagement security\n   ssl profile server\n      certificate v1.crt key v1.key\n      trust certificate demo-ca.crt\n!\ndaemon ocprometheus\n   exec /sbin/ip netns exec ns-MGMT /usr/bin/ocprometheus -config /usr/bin/ocprometheus.yml -addr localhost:6030 -certfile /persist/secure/ssl/certs/gnmi-client.crt -keyfile /persist/secure/ssl/keys/gnmi-client.key -cafile /persist/secure/ssl/certs/demo-ca.crt\n   no shutdown\n!\n</code></pre>"},{"location":"telemetry/adapters/ocprometheus/#troubleshooting-tips","title":"Troubleshooting tips","text":""},{"location":"telemetry/adapters/ocprometheus/#checking-logs-and-troubleshooting","title":"Checking Logs and troubleshooting","text":"<p>As any daemon/agent, logs are saved in /var/log/agents/ so we can either read those in bash with cat/more/less/vi/nano or from the CLI using the show agent  logs command."},{"location":"telemetry/adapters/ocprometheus/#common-issues","title":"Common issues","text":""},{"location":"telemetry/adapters/ocprometheus/#context_deadline_exceeded","title":"Context_deadline_exceeded","text":"<p>Seeing context_deadline_exceeded in the Targets section of the Prometheus GUI. This means connectivity is not established between the switch and the Prometheus server, which can be due to several reasons:</p> <ul> <li>TerminAttr and/or ocprometheus is not running</li> <li>TerminAttr and/or prometheus are not configured in the correct namespace/vrf</li> <li>Port 8080, which is used by default is not open on the switch (please check with <code>netstat -an | grep 8080</code>   or <code>sudo ip netns exec ns-&lt;vrf_name&gt; netstat -an | grep 8080</code> if using a vrf; make sure the control plane ACL is   updated and applied to vrf default or the specific vrf when using EOS version with CoPP</li> <li>Make sure TerminAttr is communicating with ocprometheus</li> <li>TerminAttr should have the -disableaaa flag added</li> </ul>"},{"location":"telemetry/adapters/ocprometheus/#not-seeing-any-streams-on-prometheus","title":"Not seeing any streams on Prometheus","text":"<p>Check TerminAttr version (After TerminAttr 1.5.1 we replaced the deprecated <code>gnmi.Value</code> with <code>gnmi.TypedValue</code>). This was only changed on our OpenConfig connectors (ockafka, ocprometheus, octsdb, ocredis, etc.) after March, 2019, thus older ocprometheus versions will ignore the updates.</p> <p>The version of ocprometheus that uses TypedValue as well was pushed to github on March 19, 2019. A newer commit was done in the beginning of June to deal with coalesced deletes, and it\u2019s recommended to use the latest version.</p> <p>The best way to check if you are hitting any issues is to enable verbosity for ocprometheus with <code>-v 9</code></p> <pre><code>!\ndaemon ocprometheus\n   exec /sbin/ip netns exec ns-management /mnt/flash/ocprometheus -config /mnt/flash/ocprometheus20190319.yml -addr localhost:6042 -v 9\nno shutdown\n!\n</code></pre> <p>In <code>/var/log/agents/ocprometheus-&lt;pid&gt;</code> you\u2019ll see error messages like below  ( Ignoring incompatible update value ) :</p> <pre><code>I0319 13:41:11.899488    5386 collector.go:77] Ignoring incompatible update value in path:&lt;elem:&lt;name:\"vsize\" &gt; &gt; val:&lt;json_val:\"4505600\" &gt;\nI0319 13:41:11.899518    5386 collector.go:77] Ignoring incompatible update value in path:&lt;elem:&lt;name:\"startstack\" &gt; &gt; val:&lt;json_val:\"4289154048\" &gt;\nI0319 13:41:11.899548    5386 collector.go:77] Ignoring incompatible update value in path:&lt;elem:&lt;name:\"kstkesp\" &gt; &gt; val:&lt;json_val:\"0\" &gt;\nI0319 13:41:11.899578    5386 collector.go:77] Ignoring incompatible update value in path:&lt;elem:&lt;name:\"exitSignal\" &gt; &gt; val:&lt;json_val:\"17\" &gt;\nI0319 13:41:11.899608    5386 collector.go:77] Ignoring incompatible update value in path:&lt;elem:&lt;name:\"state\" &gt; &gt; val:&lt;json_val:\"83\" &gt;\nI0319 13:41:11.899638    5386 collector.go:77] Ignoring incompatible update value in path:&lt;elem:&lt;name:\"cmajflt\" &gt; &gt; val:&lt;json_val:\"0\" &gt;\nI0319 13:41:11.899668    5386 collector.go:77] Ignoring incompatible update value in path:&lt;elem:&lt;name:\"priority\" &gt; &gt; val:&lt;json_val:\"20\" &gt;\nI0319 13:41:11.899698    5386 collector.go:77] Ignoring incompatible update value in path:&lt;elem:&lt;name:\"delayacctBlkioTicks\" &gt; &gt; val:&lt;json_val:\"0\" &gt;\n</code></pre> <p>Make sure you\u2019re running the latest ocprometheus and TerminAttr versions.</p>"},{"location":"telemetry/adapters/ocprometheus/#broken-paths-due-to-incorrect-regex","title":"Broken paths due to incorrect regex","text":"<p>Some of the subscription paths in the sample config file might not work on all type of devices. In case of broken paths, unfortunately we won\u2019t stream anything, and you might encounter a similar error as below when checking the metrics URL (http://x.x.x.x:8080/metrics) of a modular device:</p> <pre><code>An error has occurred during metrics gathering:\n\n17 error(s) occurred:\n\n* collected metric voltageSensor label:&lt;name:\"sensor\" value:\"21\" &gt; label:&lt;name:\"unnamedLabel2\" value:\"voltage\" &gt; gauge:&lt;value:1.040771484375 &gt;  was collected before with the same name and label values\n\n* collected metric voltageSensor label:&lt;name:\"sensor\" value:\"22\" &gt; label:&lt;name:\"unnamedLabel2\" value:\"voltage\" &gt; gauge:&lt;value:0.996826171875 &gt;  was collected before with the same name and label values\n\n* collected metric voltageSensor label:&lt;name:\"sensor\" value:\"12\" &gt; label:&lt;name:\"unnamedLabel2\" value:\"voltage\" &gt; gauge:&lt;value:11.93359375 &gt;  was collected before with the same name and label values\n</code></pre> <p>This can happen if the regexp matching is incorrect. The regexp path in question is:</p> <p><code>/Sysdb/environment/archer/power/status/voltageSensor/(?:cell/.+|system)/(?P&lt;sensor&gt;.+)/(voltage)</code></p> <p>This would match on <code>VoltageSensorX</code>, however if you check the list of voltage sensors using curl, you\u2019ll see that the sensors have the following format: <code>VoltageSensorX/Y</code></p> <pre><code>$ curl localhost:6060/rest/Sysdb/environment/archer/power/status/voltageSensor/cell/1/\n\n{\n\"VoltageSensor1/12\": {\n\"_ptr\": \"/Sysdb/environment/archer/power/status/voltageSensor/cell/1/VoltageSensor1/12\"\n},\n    \"VoltageSensor1/13\": {\n\"_ptr\": \"/Sysdb/environment/archer/power/status/voltageSensor/cell/1/VoltageSensor1/13\"\n},\n    \"VoltageSensor1/14\": {\n\"_ptr\": \"/Sysdb/environment/archer/power/status/voltageSensor/cell/1/VoltageSensor1/14\"\n},\n</code></pre> <p>You can validate your regular expression using a regexp app (e.g regex101):</p> <p>As you can see we are only matching <code>VoltageSensorX</code></p> <p></p> <p>To correct the issue, we can use the following path instead:</p> <p><code>/Sysdb/environment/archer/power/status/voltageSensor/(?:cell/.+|system)/(?P&lt;sensor&gt;VoltageSensor.+)/(voltage)</code></p> <p>As you can see, we are able to match on both VoltageSensorX and VoltageSensorX/Y .</p> <p></p>"},{"location":"telemetry/adapters/ocprometheus/#authentication-failed","title":"Authentication failed","text":"<p>When you see the following message, it means that ocprometheus is not able to connect to the gRPC server that TerminAttr/OpenConfig/OCTA is serving, either because the <code>disableaaa</code> flag is not specified in the TerminAttr config (in case of using TerminAttr) or the username and password strings are incorrect in the ocprometheus config.</p> <pre><code>cat ocprometheus-11069\n\n===== Output from /sbin/ip ['netns', 'exec', 'ns-management', '/mnt/flash/ocprometheus', '-config', '/mnt/flash/ocprometheus.yml', '-addr', 'localhost:6042'] (PID=11069) started Jun 17 11:27:35.313690 ===\nF0617 11:27:35.449652   11069 main.go:90] rpc error: code = Unauthenticated desc = Authentication failed\n</code></pre>"},{"location":"telemetry/adapters/ocprometheus/#connection-refused","title":"Connection refused","text":"<p>You might see the following error:</p> <pre><code>cat ocprometheus-10314\n\n===== Output from /sbin/ip ['netns', 'exec', 'ns-management', '/mnt/flash/ocprometheus', '-config', '/mnt/flash/ocprometheus.yml', '-addr', 'localhost:6042'] (PID=10314) started Jun 17 11:21:05.494319 ===\nF0617 11:21:05.533516   10314 main.go:90] rpc error: code = Unavailable desc = all SubConns are in TransientFailure, latest connection error: connection error: desc = \"transport: Error while dialing dial tcp 127.0.0.1:6042: connect: connection refused\"\n</code></pre> <p>When you get connection refused, it means that the gRPC server is not reachable. In this case ocprometheus is executed in the management VRF, however TerminAttr is running in the default VRF and the gRPC server by default is running in the default VRF too. To fix it you can configure the gRPC server in the correct VRF:</p> <ul> <li>in case of TerminAttr using <code>-grpcaddr &lt;vrf&gt;/&lt;IP&gt;:&lt;port&gt;</code>:</li> </ul> <pre><code>-grpcaddr management/0.0.0.0:6042\n</code></pre> <ul> <li>in case of using OpenConfig/OCTA:</li> </ul> <pre><code>management api gnmi\n  transport grpc management\n     vrf management\n  provider eos-native\n</code></pre>"},{"location":"telemetry/adapters/ocprometheus/#subscription-paths","title":"Subscription paths","text":"<p>You can find sample configuration files on our github page in the sample_configs directory, which contains per-platform EOS-native path examples but also OpenConfig path examples which are standard across all platforms in the ocprometheus_gnmi_4.23.yaml</p> <p>In this file, which is referred with the <code>-config /mnt/flash/ocprometheus.yml</code> flag and config file in the daemon ocprometheus configuration, you can add your desired Sysdb paths</p> <p>More examples (per platform + gnmi paths) can be found in the sample_configs folder.</p> <p>Commonly used paths:</p> <ul> <li>MAC table: <code>/Smash/bridging/status/smashFdbStatus</code></li> <li>ARP table: <code>/Smash/arp/status/arpEntry</code></li> <li>Neighbor table: <code>/Smash/arp/status/neighborEntry</code></li> <li>IPv4 RIB: <code>/Smash/routing/status/route</code></li> <li>IPv6 RIB: <code>/Smash/routing6/status/route</code></li> <li>IPv4 next-hop table: <code>/Smash/routing/status/nexthop</code></li> <li>IPv6 next-hop table: <code>/Smash/routing6/status/nexthop</code></li> <li>CPU info: <code>/Kernel/proc/cpu</code></li> <li>Process statistics: <code>/Kernel/proc/stat</code></li> <li>System info: <code>/Kernel/sysinfo</code></li> <li>Interface counters: <code>/Smash/counters/ethIntf/&lt;agent&gt;/current/counter</code></li> </ul> <p>For details about subscription paths and metric path structures please visit: https://eos.arista.com/understanding-subscription-paths-for-open-source-telemetry-streaming</p>"},{"location":"telemetry/adapters/ocprometheus/#useful-links","title":"Useful links","text":"<ul> <li>https://prometheus.io/docs/prometheus/</li> <li>https://grafana.com/docs/</li> <li>http://docs.grafana.org/installation/docker/</li> <li>https://grafana.com/dashboards</li> <li>https://fpm.readthedocs.io/en/latest/installing.html</li> <li>https://regex101.com/</li> </ul>"},{"location":"videos/","title":"OpenMgmt Videos","text":""},{"location":"videos/#overview","title":"Overview","text":"<p>For folks that enjoy videos, you will likely find the following videos informative.</p>"},{"location":"videos/#openconfig-video-series","title":"OpenConfig video series","text":"<p>follow the playlist.</p>"},{"location":"videos/#introduction-to-openconfig-and-gnmi","title":"Introduction to OpenConfig and gNMI","text":""},{"location":"videos/#introduction-to-the-yang-modeling-language","title":"Introduction to the YANG modeling language","text":""},{"location":"videos/#introduction-to-yang-part-2","title":"Introduction to YANG part 2","text":""},{"location":"videos/#netconf-and-restconf","title":"NETCONF and RESTCONF","text":""},{"location":"videos/#grpc","title":"gRPC","text":""},{"location":"videos/#automating-peering-with-openconfig","title":"Automating Peering with OpenConfig","text":""}]}